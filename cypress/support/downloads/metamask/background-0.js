LavaPack.loadBundle([[6265,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.REJECT_NOTFICIATION_CLOSE_SIG=r.REJECT_NOTFICIATION_CLOSE=r.METAMETRICS_BACKGROUND_PAGE_OBJECT=r.METAMETRICS_ANONYMOUS_ID=void 0;r.METAMETRICS_ANONYMOUS_ID="0x0000000000000000";r.METAMETRICS_BACKGROUND_PAGE_OBJECT={path:"/background-process",title:"Background Process",url:"/background-process"};r.REJECT_NOTFICIATION_CLOSE="Cancel Via Notification Close";r.REJECT_NOTFICIATION_CLOSE_SIG="Cancel Sig Request Via Notification Close"}}},{package:"<root>",file:"/home/circleci/project/shared/constants/metametrics.js"}],[38,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s={config:{},PreferencesController:{frequentRpcListDetail:[{rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}]}};r.default=s}}},{package:"<root>",file:"/home/circleci/project/app/scripts/first-time-state.js"}],[57,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return n((0,s.cloneDeep)(e),(e=>null===e?"null":typeof e))};var s=e("lodash");function n(e={},t){return Object.entries(e).forEach((([r,s])=>{e[r]="object"==typeof s&&null!==s?n(s,t):t(s)})),e}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/getObjStructure.js"}],[2326,{debounce:2327,duplexer:2390,through:6011},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("through"),n=e("duplexer"),a=e("debounce");t.exports=function(e,t){var r=s(a((function(e){o.queue(e)}),e||100,t)),o=s();return n(r,o)}}}},{package:"debounce-stream",file:"/home/circleci/project/node_modules/debounce-stream/index.js"}],[58,{"./util":81,"@babel/runtime/helpers/interopRequireDefault":195,extensionizer:2663,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("extensionizer")),a=s(e("loglevel")),o=e("./util");r.default=class{constructor(){this.isSupported=Boolean(n.default.storage.local),this.isSupported||a.default.error("Storage local API not available.")}async get(){if(!this.isSupported)return undefined;const e=await this._get();return t=e,0===Object.keys(t).length?undefined:e;var t}async set(e){return this._set(e)}_get(){const{local:e}=n.default.storage;return new Promise(((t,r)=>{e.get(null,(e=>{const s=(0,o.checkForError)();s?r(s):t(e)}))}))}_set(e){const{local:t}=n.default.storage;return new Promise(((r,s)=>{t.set(e,(()=>{const e=(0,o.checkForError)();e?s(e):r()}))}))}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/local-store.js"}],[62,{"../../../shared/constants/time":6269,"../../../shared/modules/fetch-with-timeout":6274,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("loglevel")),o=e("../../../shared/constants/time");const i=(0,s(e("../../../shared/modules/fetch-with-timeout")).default)(30*o.SECOND);r.default=class{constructor(){(0,n.default)(this,"isSupported",!0),this._initialized=!1,this._initializing=this._init(),this._state=undefined}async _init(){try{const e=await i("http://localhost:12345/state.json");e.ok&&(this._state=await e.json())}catch(e){a.default.debug(`Error loading network state: '${e.message}'`)}finally{this._initialized=!0}}async get(){return this._initialized||await this._initializing,this._state}async set(e){this._initialized||await this._initializing,this._state=e}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/network-store.js"}],[47,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"promise-to-callback":5500,"readable-stream":5778},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){return new c(e,t)};var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("readable-stream"),o=s(e("promise-to-callback"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}class c extends a.Writable{constructor(e,t){const r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({objectMode:!0},t);super(r),this._asyncWriteFn=e}_write(e,t,r){(0,o.default)(this._asyncWriteFn(e,t))(r)}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/createStreamSink.js"}],[63,{"../platforms/extension":153,"@babel/runtime/helpers/interopRequireDefault":195,"safe-event-emitter":5818},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.NOTIFICATION_MANAGER_EVENTS=void 0;var n=s(e("safe-event-emitter")),a=s(e("../platforms/extension"));const o={POPUP_CLOSED:"onPopupClosed"};r.NOTIFICATION_MANAGER_EVENTS=o;class i extends n.default{constructor(){super(),this.platform=new a.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(){const e=await this._getPopup();if(e)await this.platform.focusWindow(e.id);else{let e=0,t=0;try{const r=await this.platform.getLastFocusedWindow();t=r.top,e=r.left+(r.width-360)}catch(r){const{screenX:s,screenY:n,outerWidth:a}=window;t=Math.max(n,0),e=Math.max(s+(a-360),0)}const r=await this.platform.openWindow({url:"notification.html",type:"popup",width:360,height:620,left:e,top:t});r.left!==e&&"fullscreen"!==r.state&&await this.platform.updateWindowPosition(r.id,e,t),this._popupId=r.id}}_onWindowClosed(e){e===this._popupId&&(this._popupId=undefined,this.emit(o.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}r.default=i}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/notification-manager.js"}],[56,{"../../_locales/index.json":1,"@babel/runtime/helpers/interopRequireDefault":195,extensionizer:2663,pify:5492},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function(){let e;try{e=await i()}catch(t){e=[]}e||(e=[]);let t=e.map((e=>e.toLowerCase().replace("_","-"))).find((e=>c[e]!==undefined||c[e.split("-")[0]]!==undefined));t!==undefined&&c[t]===undefined&&(t=t.split("-")[0]);return c[t]||"en"};var n=s(e("extensionizer")),a=s(e("pify")),o=s(e("../../_locales/index.json"));const i=n.default.i18n?(0,a.default)(n.default.i18n.getAcceptLanguages,{errorFirst:!1}):async()=>[],c={};o.default.forEach((e=>{e&&e.code&&(c[e.code.toLowerCase().replace("_","-")]=e.code)}))}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/get-first-preferred-lang-code.js"}],[1193,{"./ComposedStore":1188,"./LocalStorageStore":1189,"./MergedStore":1190,"./ObservableStore":1191,"./asStream":1192,"./transform":1194},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./asStream"),r),n(e("./ComposedStore"),r),n(e("./LocalStorageStore"),r),n(e("./MergedStore"),r),n(e("./ObservableStore"),r),n(e("./transform"),r)}}},{package:"@metamask/obs-store",file:"/home/circleci/project/node_modules/@metamask/obs-store/dist/index.js"}],[61,{"@babel/runtime/helpers/interopRequireDefault":195,events:2158},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events"));class a extends n.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const r=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||r&&r.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const r of t)try{const t=await r.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==r.version)throw new Error("Migrator - Migration did not update version number correctly");e=t}catch(t){const s=t.message;return t.message=`MetaMask Migration Error #${r.version}: ${s}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/migrator/index.js"}],[152,{"./002":83,"./003":84,"./004":85,"./005":86,"./006":87,"./007":88,"./008":89,"./009":90,"./010":91,"./011":92,"./012":93,"./013":94,"./014":95,"./015":96,"./016":97,"./017":98,"./018":99,"./019":100,"./020":101,"./021":102,"./022":103,"./023":104,"./024":105,"./025":106,"./026":107,"./027":108,"./028":109,"./029":110,"./030":111,"./031":112,"./032":113,"./033":114,"./034":115,"./035":116,"./036":117,"./037":118,"./038":119,"./039":120,"./040":121,"./041":122,"./042":123,"./043":124,"./044":125,"./045":126,"./046":127,"./047":128,"./048":129,"./049":130,"./050":131,"./051":132,"./052":133,"./053":134,"./054":135,"./055":136,"./056":137,"./057":138,"./058":139,"./059":140,"./060":141,"./061":142,"./062":143,"./063":144,"./064":145,"./065":146,"./066":147,"./067":148,"./068":149,"./069":150,"@babel/runtime/helpers/interopRequireDefault":195},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("./002")),a=s(e("./003")),o=s(e("./004")),i=s(e("./005")),c=s(e("./006")),l=s(e("./007")),d=s(e("./008")),u=s(e("./009")),h=s(e("./010")),p=s(e("./011")),f=s(e("./012")),g=s(e("./013")),m=s(e("./014")),b=s(e("./015")),v=s(e("./016")),y=s(e("./017")),w=s(e("./018")),S=s(e("./019")),T=s(e("./020")),k=s(e("./021")),P=s(e("./022")),C=s(e("./023")),E=s(e("./024")),_=s(e("./025")),M=s(e("./026")),O=s(e("./027")),A=s(e("./028")),I=s(e("./029")),x=s(e("./030")),j=s(e("./031")),D=s(e("./032")),N=s(e("./033")),R=s(e("./034")),F=s(e("./035")),L=s(e("./036")),B=s(e("./037")),U=s(e("./038")),G=s(e("./039")),H=s(e("./040")),q=s(e("./041")),K=s(e("./042")),$=s(e("./043")),V=s(e("./044")),W=s(e("./045")),Y=s(e("./046")),z=s(e("./047")),Q=s(e("./048")),J=s(e("./049")),Z=s(e("./050")),X=s(e("./051")),ee=s(e("./052")),te=s(e("./053")),re=s(e("./054")),se=s(e("./055")),ne=s(e("./056")),ae=s(e("./057")),oe=s(e("./058")),ie=s(e("./059")),ce=s(e("./060")),le=s(e("./061")),de=s(e("./062")),ue=s(e("./063")),he=s(e("./064")),pe=s(e("./065")),fe=s(e("./066")),ge=s(e("./067")),me=s(e("./068")),be=s(e("./069"));var ve=[n.default,a.default,o.default,i.default,c.default,l.default,d.default,u.default,h.default,p.default,f.default,g.default,m.default,b.default,v.default,y.default,w.default,S.default,T.default,k.default,P.default,C.default,E.default,_.default,M.default,O.default,A.default,I.default,x.default,j.default,D.default,N.default,R.default,F.default,L.default,B.default,U.default,G.default,H.default,q.default,K.default,$.default,V.default,W.default,Y.default,z.default,Q.default,J.default,Z.default,X.default,ee.default,te.default,re.default,se.default,ne.default,ae.default,oe.default,ie.default,ce.default,le.default,de.default,ue.default,he.default,pe.default,fe.default,ge.default,me.default,be.default];r.default=ve}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/index.js"}],[54,{"../../../../shared/constants/time":6269,"../../../../shared/modules/fetch-with-timeout":6274,"./resolver":53,"@babel/runtime/helpers/interopRequireDefault":195,"base32-encode":2027,"base64-js":2030,extensionizer:2663},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:r}){const s=u.map((e=>`*://*.${e}/*`));return o.default.webRequest.onErrorOccurred.addListener(i,{urls:s,types:["main_frame"]}),{remove(){o.default.webRequest.onErrorOccurred.removeListener(i)}};async function i(s){const{tabId:i,url:c}=s;if(-1===i||"0x1"!==t())return;const{hostname:h,pathname:p,search:f,hash:g}=new URL(c),m=h.split("."),b=m[m.length-1];u.includes(b)&&async function({tabId:t,name:s,pathname:i,search:c,fragment:u}){const h=r();o.default.tabs.update(t,{url:"loading.html"});let p=`https://app.ens.domains/name/${s}`;try{const{type:r,hash:f}=await(0,l.default)({provider:e,name:s});if("ipfs-ns"===r||"ipns-ns"===r){const e=`https://${f}.${r.slice(0,4)}.${h}${i}${c||""}${u||""}`;try{200===(await d(e,{method:"HEAD"})).status&&(p=e)}catch(e){console.warn(e)}}else if("swarm-ns"===r)p=`https://swarm-gateways.net/bzz:/${f}${i}${c||""}${u||""}`;else if("onion"===r||"onion3"===r)p=`http://${f}.onion${i}${c||""}${u||""}`;else if("zeronet"===r)p=`http://127.0.0.1:43110/${f}${i}${c||""}${u||""}`;else if("skynet-ns"===r){const e=f.padEnd(f.length+4-f.length%4,"="),t=a.default.toByteArray(e),r={padding:!1};p=`https://${(0,n.default)(t,"RFC4648-HEX",r).toLowerCase()}.siasky.net${i}${c||""}${u||""}`}}catch(e){console.warn(e)}finally{o.default.tabs.update(t,{url:p})}}({tabId:i,name:h,pathname:p,search:f,fragment:g})}};var n=s(e("base32-encode")),a=s(e("base64-js")),o=s(e("extensionizer")),i=e("../../../../shared/constants/time"),c=s(e("../../../../shared/modules/fetch-with-timeout")),l=s(e("./resolver"));const d=(0,c.default)(30*i.SECOND),u=["eth"]}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/ens-ipfs/setup.js"}],[82,{"../../shared/constants/app":6261,"../../shared/constants/hardware-wallets":6263,"../../shared/constants/network":6266,"../../shared/constants/permissions":6267,"../../shared/constants/swaps":6268,"../../shared/constants/time":6269,"../../shared/constants/transaction":6270,"../../shared/modules/hexstring-utils":6276,"../../shared/modules/string-utils":6280,"../../shared/notifications":6283,"../../ui/helpers/utils/conversions.util":6797,"../../ui/helpers/utils/token-util":6811,"../../ui/helpers/utils/transactions.util":6812,"./account-import-strategies":2,"./controllers/alert":6,"./controllers/app-state":7,"./controllers/cached-balances":8,"./controllers/detect-tokens":9,"./controllers/ens":11,"./controllers/incoming-transactions":12,"./controllers/metametrics":13,"./controllers/network":17,"./controllers/onboarding":21,"./controllers/permissions":25,"./controllers/preferences":29,"./controllers/swaps":30,"./controllers/threebox":31,"./controllers/transactions":32,"./lib/ComposableObservableStore":39,"./lib/account-tracker":40,"./lib/createLoggerMiddleware":43,"./lib/createMetaRPCHandler":44,"./lib/createOnboardingMiddleware":45,"./lib/createOriginMiddleware":46,"./lib/createTabIdMiddleware":48,"./lib/decrypt-message-manager":49,"./lib/encryption-public-key-manager":50,"./lib/message-manager":59,"./lib/personal-message-manager":64,"./lib/rpc-method-middleware":75,"./lib/seed-phrase-verifier":76,"./lib/segment":77,"./lib/stream-utils":79,"./lib/typed-message-manager":80,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@keystonehq/metamask-airgapped-keyring":572,"@metamask/controllers":1042,"@metamask/eth-ledger-bridge-keyring":1093,"@metamask/obs-store":1193,"@metamask/obs-store/dist/asStream":1192,"@metamask/smart-transactions-controller":1319,"@sentry/browser":1556,_process:5498,"await-semaphore":1857,buffer:2157,"eth-json-rpc-filters":2458,"eth-json-rpc-filters/subscriptionManager":2464,"eth-json-rpc-middleware":2482,"eth-keyring-controller":2518,"eth-lattice-keyring":2519,"eth-query":2527,"eth-rpc-errors":2531,"eth-trezor-keyring":2555,"ethereumjs-util":2597,events:2158,"json-rpc-engine":4805,"json-rpc-middleware-stream/engineStream":4807,lodash:5250,loglevel:5260,nanoid:5335,pump:5597},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,s){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.METAMASK_CONTROLLER_EVENTS=void 0;var a=n(e("@babel/runtime/helpers/defineProperty")),o=n(e("events")),i=n(e("pump")),c=e("@metamask/obs-store"),l=e("@metamask/obs-store/dist/asStream"),d=e("json-rpc-engine"),u=e("lodash"),h=n(e("json-rpc-middleware-stream/engineStream")),p=n(e("eth-json-rpc-filters")),f=n(e("eth-json-rpc-filters/subscriptionManager")),g=e("eth-json-rpc-middleware"),m=n(e("eth-keyring-controller")),b=e("eth-rpc-errors"),v=e("await-semaphore"),y=e("ethereumjs-util"),w=n(e("loglevel")),S=n(e("eth-trezor-keyring")),T=n(e("@metamask/eth-ledger-bridge-keyring")),k=n(e("eth-lattice-keyring")),P=e("@keystonehq/metamask-airgapped-keyring"),C=n(e("eth-query")),E=n(e("nanoid")),_=e("@sentry/browser"),M=e("@metamask/controllers"),O=n(e("@metamask/smart-transactions-controller")),A=e("../../shared/constants/transaction"),I=e("../../shared/constants/swaps"),x=e("../../shared/constants/network"),j=e("../../shared/constants/hardware-wallets"),D=e("../../shared/constants/permissions"),N=e("../../shared/notifications"),R=e("../../shared/modules/hexstring-utils"),F=e("../../shared/constants/time"),L=e("../../shared/constants/app"),B=e("../../ui/helpers/utils/conversions.util"),U=e("../../ui/helpers/utils/token-util"),G=e("../../ui/helpers/utils/transactions.util"),H=e("../../shared/modules/string-utils"),q=n(e("./lib/ComposableObservableStore")),K=n(e("./lib/account-tracker")),$=n(e("./lib/createLoggerMiddleware")),V=e("./lib/rpc-method-middleware"),W=n(e("./lib/createOriginMiddleware")),Y=n(e("./lib/createTabIdMiddleware")),z=n(e("./lib/createOnboardingMiddleware")),Q=e("./lib/stream-utils"),J=n(e("./controllers/ens")),Z=Se(e("./controllers/network")),X=n(e("./controllers/preferences")),ee=n(e("./controllers/app-state")),te=n(e("./controllers/cached-balances")),re=n(e("./controllers/alert")),se=n(e("./controllers/onboarding")),ne=n(e("./controllers/threebox")),ae=n(e("./controllers/incoming-transactions")),oe=Se(e("./lib/message-manager")),ie=n(e("./lib/decrypt-message-manager")),ce=n(e("./lib/encryption-public-key-manager")),le=n(e("./lib/personal-message-manager")),de=n(e("./lib/typed-message-manager")),ue=n(e("./controllers/transactions")),he=n(e("./controllers/detect-tokens")),pe=n(e("./controllers/swaps")),fe=n(e("./account-import-strategies")),ge=n(e("./lib/seed-phrase-verifier")),me=n(e("./controllers/metametrics")),be=e("./lib/segment"),ve=n(e("./lib/createMetaRPCHandler")),ye=e("./controllers/permissions");function we(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(we=function(e){return e?r:t})(e)}function Se(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=we(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.METAMASK_CONTROLLER_EVENTS={UPDATE_BADGE:"updateBadge",APPROVAL_STATE_CHANGE:"ApprovalController:stateChange"};class Pe extends o.default{constructor(e){var r;super(),this.defaultMaxListeners=20,this.sendUpdate=(0,u.debounce)(this.privateSendUpdate.bind(this),200*F.MILLISECOND),this.opts=e,this.extension=e.extension,this.platform=e.platform,this.notificationManager=e.notificationManager;const s=e.initState||{},n=this.platform.getVersion();this.recordFirstTimeInfo(s),this.activeControllerConnections=0,this.getRequestAccountTabIds=e.getRequestAccountTabIds,this.getOpenMetamaskTabsIds=e.getOpenMetamaskTabsIds,this.controllerMessenger=new M.ControllerMessenger,this.store=new q.default({state:s,controllerMessenger:this.controllerMessenger,persist:!0}),this.connections={},this.createVaultMutex=new v.Mutex,this.extension.runtime.onInstalled.addListener((e=>{"update"===e.reason&&"8.1.0"===n&&this.platform.openExtensionInBrowser()})),this.approvalController=new M.ApprovalController({messenger:this.controllerMessenger.getRestricted({name:"ApprovalController"}),showApprovalRequest:e.showUserConfirmation}),this.networkController=new Z.default(s.NetworkController),this.networkController.setInfuraProjectId(e.infuraProjectId),this.initializeProvider(),this.provider=this.networkController.getProviderAndBlockTracker().provider,this.blockTracker=this.networkController.getProviderAndBlockTracker().blockTracker,this.preferencesController=new X.default({initState:s.PreferencesController,initLangCode:e.initLangCode,openPopup:e.openPopup,network:this.networkController,provider:this.provider,migrateAddressBookState:this.migrateAddressBookState.bind(this)}),this.tokensController=new M.TokensController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),config:{provider:this.provider},state:s.TokensController}),this.assetsContractController=new M.AssetsContractController({onPreferencesStateChange:e=>this.preferencesController.store.subscribe(e)},{provider:this.provider}),this.collectiblesController=new M.CollectiblesController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getERC721AssetName:this.assetsContractController.getERC721AssetName.bind(this.assetsContractController),getERC721AssetSymbol:this.assetsContractController.getERC721AssetSymbol.bind(this.assetsContractController),getERC721TokenURI:this.assetsContractController.getERC721TokenURI.bind(this.assetsContractController),getERC721OwnerOf:this.assetsContractController.getERC721OwnerOf.bind(this.assetsContractController),getERC1155BalanceOf:this.assetsContractController.getERC1155BalanceOf.bind(this.assetsContractController),getERC1155TokenURI:this.assetsContractController.getERC1155TokenURI.bind(this.assetsContractController)},{},s.CollectiblesController),this.collectiblesController.setApiKey(t.env.OPENSEA_KEY),this.metaMetricsController=new me.default({segment:be.segment,preferencesStore:this.preferencesController.store,onNetworkDidChange:this.networkController.on.bind(this.networkController,Z.NETWORK_EVENTS.NETWORK_DID_CHANGE),getNetworkIdentifier:this.networkController.getNetworkIdentifier.bind(this.networkController),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),version:this.platform.getVersion(),environment:"production",initState:s.MetaMetricsController,captureException:_.captureException});const a=this.controllerMessenger.getRestricted({name:"GasFeeController"}),o=I.GAS_API_BASE_URL;this.gasFeeController=new M.GasFeeController({interval:1e4,messenger:a,clientId:I.SWAPS_CLIENT_ID,getProvider:()=>this.networkController.getProviderAndBlockTracker().provider,onNetworkStateChange:this.networkController.on.bind(this.networkController,Z.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),legacyAPIEndpoint:`${o}/networks/<chain_id>/gasPrices`,EIP1559APIEndpoint:`${o}/networks/<chain_id>/suggestedGasFees`,getCurrentNetworkLegacyGasAPICompatibility:()=>{const e=this.networkController.getCurrentChainId();return t.env.IN_TEST||e===x.MAINNET_CHAIN_ID},getChainId:()=>t.env.IN_TEST?x.MAINNET_CHAIN_ID:this.networkController.getCurrentChainId()}),this.qrHardwareKeyring=new P.MetaMaskKeyring,this.appStateController=new ee.default({addUnlockListener:this.on.bind(this,"unlock"),isUnlocked:this.isUnlocked.bind(this),initState:s.AppStateController,onInactiveTimeout:()=>this.setLocked(),showUnlockRequest:e.showUserConfirmation,preferencesStore:this.preferencesController.store,qrHardwareStore:this.qrHardwareKeyring.getMemStore()});const i=this.controllerMessenger.getRestricted({name:"CurrencyRateController"});this.currencyRateController=new M.CurrencyRateController({includeUSDRate:!0,messenger:i,state:s.CurrencyController});const c=this.controllerMessenger.getRestricted({name:"TokenListController"});this.tokenListController=new M.TokenListController({chainId:(0,B.hexToDecimal)(this.networkController.getCurrentChainId()),useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection,onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=ke(ke({},t),{},{provider:ke(ke({},t.provider),{},{chainId:(0,B.hexToDecimal)(t.provider.chainId)})});return e(r)})),onPreferencesStateChange:e=>this.preferencesController.store.subscribe((t=>{const r=ke(ke({},t),{},{useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection});return e(r)})),messenger:c,state:s.TokenListController}),this.phishingController=new M.PhishingController,this.notificationController=new M.NotificationController({allNotifications:N.UI_NOTIFICATIONS},s.NotificationController),this.tokenRatesController=new M.TokenRatesController({onTokensStateChange:e=>this.tokensController.subscribe(e),onCurrencyRateStateChange:e=>this.controllerMessenger.subscribe(`${this.currencyRateController.name}:stateChange`,e),onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=ke(ke({},t),{},{provider:ke(ke({},t.provider),{},{chainId:(0,B.hexToDecimal)(t.provider.chainId)})});return e(r)}))}),this.ensController=new J.default({provider:this.provider,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),onNetworkDidChange:this.networkController.on.bind(this.networkController,Z.NETWORK_EVENTS.NETWORK_DID_CHANGE)}),this.incomingTransactionsController=new ae.default({blockTracker:this.blockTracker,onNetworkDidChange:this.networkController.on.bind(this.networkController,Z.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesController:this.preferencesController,initState:s.IncomingTransactionsController}),this.accountTracker=new K.default({provider:this.provider,blockTracker:this.blockTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController)}),this.on("controllerConnectionChanged",(e=>{e>0?(this.accountTracker.start(),this.incomingTransactionsController.start(),this.currencyRateController.start(),this.tokenListController.start()):(this.accountTracker.stop(),this.incomingTransactionsController.stop(),this.currencyRateController.stop(),this.tokenListController.stop())})),this.cachedBalancesController=new te.default({accountTracker:this.accountTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),initState:s.CachedBalancesController}),this.onboardingController=new se.default({initState:s.OnboardingController}),this.tokensController.hub.on("pendingSuggestedAsset",(async()=>{await e.openPopup()}));const l=[S.default,T.default,k.default,P.MetaMaskKeyring];this.keyringController=new m.default({keyringTypes:l,initState:s.KeyringController,encryptor:e.encryptor||undefined}),this.keyringController.memStore.subscribe((e=>this._onKeyringControllerUpdate(e))),this.keyringController.on("unlock",(()=>this._onUnlock())),this.keyringController.on("lock",(()=>this._onLock()));const d=()=>this.preferencesController.store.getState().identities;this.permissionController=new M.PermissionController({messenger:this.controllerMessenger.getRestricted({name:"PermissionController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:hasRequest`,`${this.approvalController.name}:acceptRequest`,`${this.approvalController.name}:rejectRequest`]}),state:s.PermissionController,caveatSpecifications:(0,ye.getCaveatSpecifications)({getIdentities:d}),permissionSpecifications:ke({},(0,ye.getPermissionSpecifications)({getIdentities:d,getAllAccounts:this.keyringController.getAccounts.bind(this.keyringController),captureKeyringTypesWithMissingIdentities:(e={},t=[])=>{const r=t.filter((t=>!e[t])).map((e=>{var t;return null===(t=this.keyringController.getKeyringForAccount(e))||void 0===t?void 0:t.type})),s=Object.keys(e||{}).length,n=Object.keys(this.accountTracker.store.getState().accounts||{}).length;(0,_.captureException)(new Error(`Attempt to get permission specifications failed because their were ${t.length} accounts, but ${s} identities, and the ${r} keyrings included accounts with missing identities. Meanwhile, there are ${n} accounts in the account tracker.`))}})),unrestrictedMethods:ye.unrestrictedMethods}),this.permissionLogController=new ye.PermissionLogController({restrictedMethods:new Set(Object.keys(D.RestrictedMethods)),initState:s.PermissionLogController}),this.subjectMetadataController=new M.SubjectMetadataController({messenger:this.controllerMessenger.getRestricted({name:"SubjectMetadataController",allowedActions:[`${this.permissionController.name}:hasPermissions`]}),state:s.SubjectMetadataController,subjectCacheLimit:100}),this.detectTokensController=new he.default({preferences:this.preferencesController,tokensController:this.tokensController,network:this.networkController,keyringMemStore:this.keyringController.memStore,tokenList:this.tokenListController}),this.addressBookController=new M.AddressBookController(undefined,s.AddressBookController),this.alertController=new re.default({initState:s.AlertController,preferencesStore:this.preferencesController.store}),this.threeBoxController=new ne.default({preferencesController:this.preferencesController,addressBookController:this.addressBookController,keyringController:this.keyringController,initState:s.ThreeBoxController,getKeyringControllerState:this.keyringController.memStore.getState.bind(this.keyringController.memStore),version:n,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.txController=new ue.default({initState:s.TransactionController||s.TransactionManager,getPermittedAccounts:this.getPermittedAccounts.bind(this),getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),networkStore:this.networkController.networkStore,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesStore:this.preferencesController.store,txHistoryLimit:60,signTransaction:this.keyringController.signTransaction.bind(this.keyringController),provider:this.provider,blockTracker:this.blockTracker,createEventFragment:this.metaMetricsController.createEventFragment.bind(this.metaMetricsController),updateEventFragment:this.metaMetricsController.updateEventFragment.bind(this.metaMetricsController),finalizeEventFragment:this.metaMetricsController.finalizeEventFragment.bind(this.metaMetricsController),getEventFragmentById:this.metaMetricsController.getEventFragmentById.bind(this.metaMetricsController),trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getParticipateInMetrics:()=>this.metaMetricsController.state.participateInMetaMetrics,getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),getExternalPendingTransactions:this.getExternalPendingTransactions.bind(this),getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this)}),this.txController.on("newUnapprovedTx",(()=>e.showUserConfirmation())),this.txController.on("tx:status-update",(async(e,t)=>{if(t===A.TRANSACTION_STATUSES.CONFIRMED||t===A.TRANSACTION_STATUSES.FAILED){const t=this.txController.txStateManager.getTransaction(e),a=this.preferencesController.getFrequentRpcListDetail();let o={};if(t.chainId){var r;const e=a.find((e=>t.chainId===e.chainId));o=null!==(r=null==e?void 0:e.rpcPrefs)&&void 0!==r?r:{}}this.platform.showTransactionNotification(t,o);const{txReceipt:i}=t;if(t.type===A.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER_FROM&&t.txParams!==undefined){var s;const{data:e,to:r,from:n}=t.txParams,{chainId:a}=t,o=(0,G.getTransactionData)(e),i=(0,U.getTokenValueParam)(o),{allCollectibles:c}=this.collectiblesController.state,l=null==c||null===(s=c[n])||void 0===s?void 0:s[a].find((({address:e,tokenId:t})=>(0,H.isEqualCaseInsensitive)(e,r)&&t===i));l&&this.collectiblesController.checkAndUpdateSingleCollectibleOwnershipStatus(l,!1,{userAddress:n,chainId:a})}const c=await this.getState();var n;if(i&&"0x0"===i.status)this.metaMetricsController.trackEvent({event:"Tx Status Update: On-Chain Failure",category:"Background",properties:{action:"Transactions",errorMessage:null===(n=t.simulationFails)||void 0===n?void 0:n.reason,numberOfTokens:c.tokens.length,numberOfAccounts:Object.keys(c.accounts).length}},{matomoEvent:!0})}})),this.networkController.on(Z.NETWORK_EVENTS.NETWORK_DID_CHANGE,(async()=>{const{ticker:e}=this.networkController.getProviderConfig();try{await this.currencyRateController.setNativeCurrency(e)}catch(e){console.error(e)}})),this.networkController.lookupNetwork(),this.messageManager=new oe.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.personalMessageManager=new le.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.decryptMessageManager=new ie.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.encryptionPublicKeyManager=new ce.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.typedMessageManager=new de.default({getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.swapsController=new pe.default({getBufferedGasLimit:this.txController.txGasUtil.getBufferedGasLimit.bind(this.txController.txGasUtil),networkController:this.networkController,provider:this.provider,getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getTokenRatesState:()=>this.tokenRatesController.state,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController)}),this.smartTransactionsController=new O.default({onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getNetwork:this.networkController.getNetworkState.bind(this.networkController),getNonceLock:this.txController.nonceTracker.getNonceLock.bind(this.txController.nonceTracker),confirmExternalTransaction:this.txController.confirmExternalTransaction.bind(this.txController),provider:this.provider,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)},undefined,s.SmartTransactionsController),this.networkController.on(Z.NETWORK_EVENTS.NETWORK_DID_CHANGE,(()=>{this.accountTracker._updateAccounts()})),this.networkController.on(Z.NETWORK_EVENTS.NETWORK_WILL_CHANGE,(()=>{this.txController.txStateManager.clearUnapprovedTxs(),this.encryptionPublicKeyManager.clearUnapproved(),this.personalMessageManager.clearUnapproved(),this.typedMessageManager.clearUnapproved(),this.decryptMessageManager.clearUnapproved(),this.messageManager.clearUnapproved()})),this.on("update",(e=>this._onStateUpdate(e))),this.store.updateStructure({AppStateController:this.appStateController.store,TransactionController:this.txController.store,KeyringController:this.keyringController.store,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,NetworkController:this.networkController.store,CachedBalancesController:this.cachedBalancesController.store,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,ThreeBoxController:this.threeBoxController.store,NotificationController:this.notificationController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,CollectiblesController:this.collectiblesController}),this.memStore=new q.default({config:{AppStateController:this.appStateController.store,NetworkController:this.networkController.store,AccountTracker:this.accountTracker.store,TxController:this.txController.memStore,CachedBalancesController:this.cachedBalancesController.store,TokenRatesController:this.tokenRatesController,MessageManager:this.messageManager.memStore,PersonalMessageManager:this.personalMessageManager.memStore,DecryptMessageManager:this.decryptMessageManager.memStore,EncryptionPublicKeyManager:this.encryptionPublicKeyManager.memStore,TypesMessageManager:this.typedMessageManager.memStore,KeyringController:this.keyringController.memStore,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,ThreeBoxController:this.threeBoxController.store,SwapsController:this.swapsController.store,EnsController:this.ensController.store,ApprovalController:this.approvalController,NotificationController:this.notificationController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,CollectiblesController:this.collectiblesController},controllerMessenger:this.controllerMessenger}),this.memStore.subscribe(this.sendUpdate.bind(this));const h=null===(r={})||void 0===r?void 0:r.PASSWORD;h&&!this.isUnlocked()&&this.onboardingController.store.getState().completedOnboarding&&this.submitPassword(h),this.extension.runtime.getPlatformInfo((({os:e})=>{this.appStateController.setBrowserEnvironment(e,this.extension.runtime.getBrowserInfo===undefined?"chrome":"firefox")})),this.setupControllerEventSubscriptions(),this.publicConfigStore=this.createPublicConfigStore()}setupControllerEventSubscriptions(){const e=async(e,t)=>{this.isUnlocked()&&this.notifyConnections(e,{method:ye.NOTIFICATION_NAMES.accountsChanged,params:t.length<2?t:await this.getPermittedAccounts(e)}),this.permissionLogController.updateAccountsHistory(e,t)};let t;this.preferencesController.store.subscribe((async({selectedAddress:r})=>{if(r&&r!==t){t=r;const s=(0,ye.getPermittedAccountsByOrigin)(this.permissionController.state);for(const[t,n]of s.entries())n.includes(r)&&e(t,n)}})),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,(async(t,r)=>{const s=(0,ye.getChangedAccounts)(t,r);for(const[t,r]of s.entries())e(t,r)}),ye.getPermittedAccountsByOrigin)}initializeProvider(){const e=this.platform.getVersion(),t={static:{eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`},version:e,getAccounts:async({origin:e})=>{if("metamask"===e){const e=this.preferencesController.getSelectedAddress();return e?[e]:[]}return this.isUnlocked()?await this.getPermittedAccounts(e):[]},processTransaction:this.newUnapprovedTransaction.bind(this),processEthSignMessage:this.newUnsignedMessage.bind(this),processTypedMessage:this.newUnsignedTypedMessage.bind(this),processTypedMessageV3:this.newUnsignedTypedMessage.bind(this),processTypedMessageV4:this.newUnsignedTypedMessage.bind(this),processPersonalMessage:this.newUnsignedPersonalMessage.bind(this),processDecryptMessage:this.newRequestDecryptMessage.bind(this),processEncryptionPublicKey:this.newRequestEncryptionPublicKey.bind(this),getPendingNonce:this.getPendingNonce.bind(this),getPendingTransactionByHash:e=>this.txController.getTransactions({searchCriteria:{hash:e,status:A.TRANSACTION_STATUSES.SUBMITTED}})[0]};return this.networkController.initializeProvider(t)}createPublicConfigStore(){const e=new c.ObservableStore,{networkController:t}=this;function r(r){const s=t.getCurrentChainId();"loading"!==r.network&&e.putState(function(e,{isUnlocked:t,network:r}){return{isUnlocked:t,chainId:e,networkVersion:r}}(s,r))}return this.on("update",r),r(this.getState()),e}async getProviderState(e){return ke(ke({isUnlocked:this.isUnlocked()},this.getProviderNetworkState()),{},{accounts:await this.getPermittedAccounts(e)})}getProviderNetworkState(e){const{network:t}=e||this.getState();return{chainId:this.networkController.getCurrentChainId(),networkVersion:t}}getState(){const{vault:e}=this.keyringController.store.getState();return ke({isInitialized:Boolean(e)},this.memStore.getFlatState())}getApi(){const{addressBookController:e,alertController:t,approvalController:r,appStateController:s,collectiblesController:n,collectibleDetectionController:a,currencyRateController:o,detectTokensController:i,ensController:c,gasFeeController:l,keyringController:d,metaMetricsController:u,networkController:h,notificationController:p,onboardingController:f,permissionController:g,preferencesController:m,qrHardwareKeyring:v,swapsController:y,threeBoxController:w,tokensController:S,smartTransactionsController:T,txController:k}=this;return ke(ke({getState:this.getState.bind(this),setCurrentCurrency:o.setCurrentCurrency.bind(o),setUseBlockie:m.setUseBlockie.bind(m),setUseNonceField:m.setUseNonceField.bind(m),setUsePhishDetect:m.setUsePhishDetect.bind(m),setUseTokenDetection:m.setUseTokenDetection.bind(m),setUseCollectibleDetection:m.setUseCollectibleDetection.bind(m),setOpenSeaEnabled:m.setOpenSeaEnabled.bind(m),setIpfsGateway:m.setIpfsGateway.bind(m),setParticipateInMetaMetrics:u.setParticipateInMetaMetrics.bind(u),setCurrentLocale:m.setCurrentLocale.bind(m),markPasswordForgotten:this.markPasswordForgotten.bind(this),unMarkPasswordForgotten:this.unMarkPasswordForgotten.bind(this),safelistPhishingDomain:this.safelistPhishingDomain.bind(this),getRequestAccountTabIds:this.getRequestAccountTabIds,getOpenMetamaskTabsIds:this.getOpenMetamaskTabsIds,markNotificationPopupAsAutomaticallyClosed:()=>this.notificationManager.markAsAutomaticallyClosed(),addNewAccount:this.addNewAccount.bind(this),verifySeedPhrase:this.verifySeedPhrase.bind(this),resetAccount:this.resetAccount.bind(this),removeAccount:this.removeAccount.bind(this),importAccountWithStrategy:this.importAccountWithStrategy.bind(this),connectHardware:this.connectHardware.bind(this),forgetDevice:this.forgetDevice.bind(this),checkHardwareStatus:this.checkHardwareStatus.bind(this),unlockHardwareWalletAccount:this.unlockHardwareWalletAccount.bind(this),setLedgerTransportPreference:this.setLedgerTransportPreference.bind(this),attemptLedgerTransportCreation:this.attemptLedgerTransportCreation.bind(this),establishLedgerTransportPreference:this.establishLedgerTransportPreference.bind(this),submitQRHardwareCryptoHDKey:v.submitCryptoHDKey.bind(v),submitQRHardwareCryptoAccount:v.submitCryptoAccount.bind(v),cancelSyncQRHardware:v.cancelSync.bind(v),submitQRHardwareSignature:v.submitSignature.bind(v),cancelQRHardwareSignRequest:v.cancelSignRequest.bind(v),fetchInfoToSync:this.fetchInfoToSync.bind(this),submitPassword:this.submitPassword.bind(this),verifyPassword:this.verifyPassword.bind(this),setProviderType:h.setProviderType.bind(h),rollbackToPreviousProvider:h.rollbackToPreviousProvider.bind(h),setCustomRpc:this.setCustomRpc.bind(this),updateAndSetCustomRpc:this.updateAndSetCustomRpc.bind(this),delCustomRpc:this.delCustomRpc.bind(this),setSelectedAddress:m.setSelectedAddress.bind(m),addToken:S.addToken.bind(S),rejectWatchAsset:S.rejectWatchAsset.bind(S),acceptWatchAsset:S.acceptWatchAsset.bind(S),updateTokenType:S.updateTokenType.bind(S),removeToken:S.removeAndIgnoreToken.bind(S),setAccountLabel:m.setAccountLabel.bind(m),setFeatureFlag:m.setFeatureFlag.bind(m),setPreference:m.setPreference.bind(m),addKnownMethodData:m.addKnownMethodData.bind(m),setDismissSeedBackUpReminder:m.setDismissSeedBackUpReminder.bind(m),setAdvancedGasFee:m.setAdvancedGasFee.bind(m),setEIP1559V2Enabled:m.setEIP1559V2Enabled.bind(m),setTheme:m.setTheme.bind(m),getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),addCollectible:n.addCollectible.bind(n),addCollectibleVerifyOwnership:n.addCollectibleVerifyOwnership.bind(n),removeAndIgnoreCollectible:n.removeAndIgnoreCollectible.bind(n),removeCollectible:n.removeCollectible.bind(n),checkAndUpdateAllCollectiblesOwnershipStatus:n.checkAndUpdateAllCollectiblesOwnershipStatus.bind(n),checkAndUpdateSingleCollectibleOwnershipStatus:n.checkAndUpdateSingleCollectibleOwnershipStatus.bind(n),isCollectibleOwner:n.isCollectibleOwner.bind(n),setAddressBook:e.set.bind(e),removeFromAddressBook:e.delete.bind(e),setLastActiveTime:s.setLastActiveTime.bind(s),setDefaultHomeActiveTabName:s.setDefaultHomeActiveTabName.bind(s),setConnectedStatusPopoverHasBeenShown:s.setConnectedStatusPopoverHasBeenShown.bind(s),setRecoveryPhraseReminderHasBeenShown:s.setRecoveryPhraseReminderHasBeenShown.bind(s),setRecoveryPhraseReminderLastShown:s.setRecoveryPhraseReminderLastShown.bind(s),setShowTestnetMessageInDropdown:s.setShowTestnetMessageInDropdown.bind(s),setCollectiblesDetectionNoticeDismissed:s.setCollectiblesDetectionNoticeDismissed.bind(s),setEnableEIP1559V2NoticeDismissed:s.setEnableEIP1559V2NoticeDismissed.bind(s),updateCollectibleDropDownState:s.updateCollectibleDropDownState.bind(s),tryReverseResolveAddress:c.reverseResolveAddress.bind(c),setLocked:this.setLocked.bind(this),createNewVaultAndKeychain:this.createNewVaultAndKeychain.bind(this),createNewVaultAndRestore:this.createNewVaultAndRestore.bind(this),exportAccount:d.exportAccount.bind(d),cancelTransaction:k.cancelTransaction.bind(k),updateTransaction:k.updateTransaction.bind(k),updateAndApproveTransaction:k.updateAndApproveTransaction.bind(k),approveTransactionsWithSameNonce:k.approveTransactionsWithSameNonce.bind(k),createCancelTransaction:this.createCancelTransaction.bind(this),createSpeedUpTransaction:this.createSpeedUpTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getNextNonce:this.getNextNonce.bind(this),addUnapprovedTransaction:k.addUnapprovedTransaction.bind(k),createTransactionEventFragment:k.createTransactionEventFragment.bind(k),getTransactions:k.getTransactions.bind(k),updateEditableParams:k.updateEditableParams.bind(k),updateTransactionGasFees:k.updateTransactionGasFees.bind(k),updateSwapApprovalTransaction:k.updateSwapApprovalTransaction.bind(k),updateSwapTransaction:k.updateSwapTransaction.bind(k),signMessage:this.signMessage.bind(this),cancelMessage:this.cancelMessage.bind(this),signPersonalMessage:this.signPersonalMessage.bind(this),cancelPersonalMessage:this.cancelPersonalMessage.bind(this),signTypedMessage:this.signTypedMessage.bind(this),cancelTypedMessage:this.cancelTypedMessage.bind(this),decryptMessage:this.decryptMessage.bind(this),decryptMessageInline:this.decryptMessageInline.bind(this),cancelDecryptMessage:this.cancelDecryptMessage.bind(this),encryptionPublicKey:this.encryptionPublicKey.bind(this),cancelEncryptionPublicKey:this.cancelEncryptionPublicKey.bind(this),setSeedPhraseBackedUp:f.setSeedPhraseBackedUp.bind(f),completeOnboarding:f.completeOnboarding.bind(f),setFirstTimeFlowType:f.setFirstTimeFlowType.bind(f),setAlertEnabledness:t.setAlertEnabledness.bind(t),setUnconnectedAccountAlertShown:t.setUnconnectedAccountAlertShown.bind(t),setWeb3ShimUsageAlertDismissed:t.setWeb3ShimUsageAlertDismissed.bind(t),setThreeBoxSyncingPermission:w.setThreeBoxSyncingPermission.bind(w),restoreFromThreeBox:w.restoreFromThreeBox.bind(w),setShowRestorePromptToFalse:w.setShowRestorePromptToFalse.bind(w),getThreeBoxLastUpdated:w.getLastUpdated.bind(w),turnThreeBoxSyncingOn:w.turnThreeBoxSyncingOn.bind(w),initializeThreeBox:this.initializeThreeBox.bind(this),removePermissionsFor:g.revokePermissions.bind(g),approvePermissionsRequest:g.acceptPermissionsRequest.bind(g),rejectPermissionsRequest:g.rejectPermissionsRequest.bind(g)},(0,ye.getPermissionBackgroundApiMethods)(g)),{},{fetchAndSetQuotes:y.fetchAndSetQuotes.bind(y),setSelectedQuoteAggId:y.setSelectedQuoteAggId.bind(y),resetSwapsState:y.resetSwapsState.bind(y),setSwapsTokens:y.setSwapsTokens.bind(y),clearSwapsQuotes:y.clearSwapsQuotes.bind(y),setApproveTxId:y.setApproveTxId.bind(y),setTradeTxId:y.setTradeTxId.bind(y),setSwapsTxGasPrice:y.setSwapsTxGasPrice.bind(y),setSwapsTxGasLimit:y.setSwapsTxGasLimit.bind(y),setSwapsTxMaxFeePerGas:y.setSwapsTxMaxFeePerGas.bind(y),setSwapsTxMaxFeePriorityPerGas:y.setSwapsTxMaxFeePriorityPerGas.bind(y),safeRefetchQuotes:y.safeRefetchQuotes.bind(y),stopPollingForQuotes:y.stopPollingForQuotes.bind(y),setBackgroundSwapRouteState:y.setBackgroundSwapRouteState.bind(y),resetPostFetchState:y.resetPostFetchState.bind(y),setSwapsErrorKey:y.setSwapsErrorKey.bind(y),setInitialGasEstimate:y.setInitialGasEstimate.bind(y),setCustomApproveTxData:y.setCustomApproveTxData.bind(y),setSwapsLiveness:y.setSwapsLiveness.bind(y),setSwapsFeatureFlags:y.setSwapsFeatureFlags.bind(y),setSwapsUserFeeLevel:y.setSwapsUserFeeLevel.bind(y),setSwapsQuotesPollingLimitEnabled:y.setSwapsQuotesPollingLimitEnabled.bind(y),setSmartTransactionsOptInStatus:T.setOptInState.bind(T),fetchSmartTransactionFees:T.getFees.bind(T),estimateSmartTransactionsGas:T.estimateGas.bind(T),submitSignedTransactions:T.submitSignedTransactions.bind(T),cancelSmartTransaction:T.cancelSmartTransaction.bind(T),fetchSmartTransactionsLiveness:T.fetchLiveness.bind(T),updateSmartTransaction:T.updateSmartTransaction.bind(T),setStatusRefreshInterval:T.setStatusRefreshInterval.bind(T),trackMetaMetricsEvent:u.trackEvent.bind(u),trackMetaMetricsPage:u.trackPage.bind(u),createEventFragment:u.createEventFragment.bind(u),updateEventFragment:u.updateEventFragment.bind(u),finalizeEventFragment:u.finalizeEventFragment.bind(u),resolvePendingApproval:r.accept.bind(r),rejectPendingApproval:async(e,t)=>{r.reject(e,new b.EthereumRpcError(t.code,t.message,t.data))},updateViewedNotifications:p.updateViewed.bind(p),getGasFeeEstimatesAndStartPolling:l.getGasFeeEstimatesAndStartPolling.bind(l),disconnectGasFeeEstimatePoller:l.disconnectPoller.bind(l),getGasFeeTimeEstimate:l.getTimeEstimate.bind(l),addPollingTokenToAppState:s.addPollingToken.bind(s),removePollingTokenFromAppState:s.removePollingToken.bind(s),detectNewTokens:i.detectNewTokens.bind(i),detectCollectibles:null})}async getTokenStandardAndDetails(e,t,r){var s,n;const a=await this.assetsContractController.getTokenStandardAndDetails(e,t,r);return ke(ke({},a),{},{decimals:null==a||null===(s=a.decimals)||void 0===s?void 0:s.toString(10),balance:null==a||null===(n=a.balance)||void 0===n?void 0:n.toString(10)})}async createNewVaultAndKeychain(e){const t=await this.createVaultMutex.acquire();try{let r;if((await this.keyringController.getAccounts()).length>0)r=await this.keyringController.fullUpdate();else{r=await this.keyringController.createNewVaultAndKeychain(e);const t=await this.keyringController.getAccounts();this.preferencesController.setAddresses(t),this.selectFirstIdentity()}return r}finally{t()}}async createNewVaultAndRestore(e,t){const r=await this.createVaultMutex.acquire();try{let n,a;const o=s.from(t),{keyringController:i}=this;this.preferencesController.setAddresses([]),this.permissionController.clearState(),this.accountTracker.clearAccounts(),this.cachedBalancesController.clearCachedBalances(),this.txController.txStateManager.clearUnapprovedTxs();const c=await i.createNewVaultAndRestore(e,o),l=new C.default(this.provider);n=await i.getAccounts(),a=await this.getBalance(n[n.length-1],l);const d=i.getKeyringsByType("HD Key Tree")[0];if(!d)throw new Error("MetamaskController - No HD Key Tree found");for(;"0x0"!==a;)await i.addNewAccount(d),n=await i.getAccounts(),a=await this.getBalance(n[n.length-1],l);n.length>1&&"0x0"===a&&(await this.removeAccount(n[n.length-1]),n=await i.getAccounts());const u=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(u),this.preferencesController.setAddresses(n),this.selectFirstIdentity(),c}finally{r()}}getBalance(e,t){return new Promise(((r,s)=>{const n=this.accountTracker.store.getState().accounts[e];n&&n.balance?r(n.balance):t.getBalance(e,((e,t)=>{e?(s(e),w.default.error(e)):r(t||"0x0")}))}))}async fetchInfoToSync(){const{currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:s,useTokenDetection:n}=this.preferencesController.store.getState(),{tokenList:a}=this.tokenListController.state,o={currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:s},{allTokens:i,allIgnoredTokens:c}=this.tokensController.state,l={};Object.keys(i).forEach((e=>{l[e]={},Object.keys(i[e]).forEach((t=>{const r=(0,R.toChecksumHexAddress)(t);l[e][r]=i[e][r].filter((e=>{if(e.isERC721===undefined){const t=n?e.address.toLowerCase():e.address;if(a[t]!==undefined)return!0}else if(!1===e.isERC721)return!0;return!1}))}))}));const d=this.keyringController.getKeyringsByType("HD Key Tree")[0],u=this.keyringController.getKeyringsByType("Simple Key Pair"),h=await d.getAccounts(),p=(await Promise.all(u.map((e=>e.getAccounts())))).reduce(((e,t)=>[...e,...t]),[]),f={hd:h.filter(((e,t)=>h.indexOf(e)===t)).map((e=>(0,R.toChecksumHexAddress)(e))),simpleKeyPair:p.filter(((e,t)=>p.indexOf(e)===t)).map((e=>(0,R.toChecksumHexAddress)(e))),ledger:[],trezor:[],lattice:[]};let{transactions:g}=this.txController.store.getState();return g=Object.values(g).filter((e=>{const t=(0,R.toChecksumHexAddress)(e.txParams.from);return f.hd.includes(t)})),{accounts:f,preferences:o,transactions:g,tokens:{allTokens:l,allIgnoredTokens:c},network:this.networkController.store.getState()}}async submitPassword(e){await this.keyringController.submitPassword(e);try{await this.blockTracker.checkForLatestBlock()}catch(e){w.default.error("Error while unlocking extension.",e)}try{const e=this.threeBoxController.getThreeBoxSyncingState();e&&!this.threeBoxController.box?(this.threeBoxController.init(),this.threeBoxController.turnThreeBoxSyncingOn()):e&&this.threeBoxController.box&&this.threeBoxController.turnThreeBoxSyncingOn()}catch(e){w.default.error("Error while unlocking extension.",e)}const t=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(t),this.keyringController.fullUpdate()}async verifyPassword(e){await this.keyringController.verifyPassword(e)}selectFirstIdentity(){const{identities:e}=this.preferencesController.store.getState(),t=Object.keys(e)[0];this.preferencesController.setSelectedAddress(t)}getPrimaryKeyringMnemonic(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return e.mnemonic}async getKeyringForDevice(e,t=null){let r=null;switch(e){case j.DEVICE_NAMES.TREZOR:r=S.default.type;break;case j.DEVICE_NAMES.LEDGER:r=T.default.type;break;case j.DEVICE_NAMES.QR:r=P.MetaMaskKeyring.type;break;case j.DEVICE_NAMES.LATTICE:r=k.default.type;break;default:throw new Error("MetamaskController:getKeyringForDevice - Unknown device")}let s=await this.keyringController.getKeyringsByType(r)[0];if(s||(s=await this.keyringController.addNewKeyring(r)),t&&s.setHdPath&&s.setHdPath(t),e===j.DEVICE_NAMES.LATTICE&&(s.appName="MetaMask"),e===j.DEVICE_NAMES.TREZOR){const e=s.getModel();this.appStateController.setTrezorModel(e)}return s.network=this.networkController.getProviderConfig().type,s}async attemptLedgerTransportCreation(){const e=await this.getKeyringForDevice(j.DEVICE_NAMES.LEDGER);return await e.attemptMakeApp()}async establishLedgerTransportPreference(){const e=this.preferencesController.getLedgerTransportPreference();return await this.setLedgerTransportPreference(e)}async connectHardware(e,t,r){const s=await this.getKeyringForDevice(e,r);let n=[];switch(t){case-1:n=await s.getPreviousPage();break;case 1:n=await s.getNextPage();break;default:n=await s.getFirstPage()}const a=await this.keyringController.getAccounts(),o=[...new Set(a.concat(n.map((e=>e.address.toLowerCase()))))];return this.accountTracker.syncWithAddresses(o),n}async checkHardwareStatus(e,t){return(await this.getKeyringForDevice(e,t)).isUnlocked()}async forgetDevice(e){return(await this.getKeyringForDevice(e)).forgetDevice(),!0}async getAccountType(e){switch((await this.keyringController.getKeyringForAccount(e)).type){case j.KEYRING_TYPES.TREZOR:case j.KEYRING_TYPES.LATTICE:case j.KEYRING_TYPES.QR:case j.KEYRING_TYPES.LEDGER:return"hardware";case j.KEYRING_TYPES.IMPORTED:return"imported";default:return"MetaMask"}}async getDeviceModel(e){const t=await this.keyringController.getKeyringForAccount(e);switch(t.type){case j.KEYRING_TYPES.TREZOR:return t.getModel();case j.KEYRING_TYPES.QR:return t.getName();case j.KEYRING_TYPES.LEDGER:return j.DEVICE_NAMES.LEDGER;case j.KEYRING_TYPES.LATTICE:return j.DEVICE_NAMES.LATTICE;default:return"N/A"}}getAccountLabel(e,t,r){return`${e[0].toUpperCase()}${e.slice(1)} ${parseInt(t,10)+1} ${r||""}`.trim()}async unlockHardwareWalletAccount(e,t,r,s){const n=await this.getKeyringForDevice(t,r);n.setAccountToUnlock(e);const a=await this.keyringController.getAccounts(),o=await this.keyringController.addNewAccount(n),i=await this.keyringController.getAccounts();this.preferencesController.setAddresses(i),i.forEach((r=>{if(!a.includes(r)){const a=this.getAccountLabel(t===j.DEVICE_NAMES.QR?n.getName():t,e,s);this.preferencesController.setAccountLabel(r,a),this.preferencesController.setSelectedAddress(r)}}));const{identities:c}=this.preferencesController.store.getState();return ke(ke({},o),{},{identities:c})}async addNewAccount(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const{keyringController:t}=this,r=await t.getAccounts(),s=await t.addNewAccount(e),n=await t.getAccounts();await this.verifySeedPhrase(),this.preferencesController.setAddresses(n),n.forEach((e=>{r.includes(e)||this.preferencesController.setSelectedAddress(e)}));const{identities:a}=this.preferencesController.store.getState();return ke(ke({},s),{},{identities:a})}async verifySeedPhrase(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const t=await e.serialize(),r=s.from(t.mnemonic),n=await e.getAccounts();if(n.length<1)throw new Error("MetamaskController - No accounts found");try{return await ge.default.verifyAccounts(n,r),Array.from(r.values())}catch(e){throw w.default.error(e.message),e}}async resetAccount(){const e=this.preferencesController.getSelectedAddress();return this.txController.wipeTransactions(e),this.networkController.resetConnection(),e}async getPermittedAccounts(e){try{return await this.permissionController.executeRestrictedMethod(e,D.RestrictedMethods.eth_accounts)}catch(e){if(e.code===b.errorCodes.provider.unauthorized)return[];throw e}}removeAllAccountPermissions(e){this.permissionController.updatePermissionsByCaveat(D.CaveatTypes.restrictReturnedAccounts,(t=>ye.CaveatMutatorFactories[D.CaveatTypes.restrictReturnedAccounts].removeAccount(e,t)))}async removeAccount(e){return this.removeAllAccountPermissions(e),this.preferencesController.removeAddress(e),this.accountTracker.removeAccount([e]),await this.keyringController.removeAccount(e),e}async importAccountWithStrategy(e,t){const r=await fe.default.importAccount(e,t),s=await this.keyringController.addNewKeyring("Simple Key Pair",[r]),n=await s.getAccounts(),a=await this.keyringController.getAccounts();this.preferencesController.setAddresses(a),await this.preferencesController.setSelectedAddress(n[0])}async newUnapprovedTransaction(e,t){return await this.txController.newUnapprovedTransaction(e,t)}async newUnsignedMessage(e,t){const r=(0,oe.normalizeMsgData)(e.data);let s;if(66!==r.length&&67!==r.length)throw b.ethErrors.rpc.invalidParams("eth_sign requires 32 byte message hash");return s=this.messageManager.addUnapprovedMessageAsync(e,t),this.sendUpdate(),this.opts.showUserConfirmation(),await s}async signMessage(e){w.default.info("MetaMaskController - signMessage");const t=e.metamaskId;try{const r=await this.messageManager.approveMessage(e),s=await this.keyringController.signMessage(r);return this.messageManager.setMsgStatusSigned(t,s),this.getState()}catch(e){throw w.default.info("MetaMaskController - eth_sign failed",e),this.messageManager.errorMessage(t,e),e}}cancelMessage(e){const{messageManager:t}=this;return t.rejectMsg(e),this.getState()}async newUnsignedPersonalMessage(e,t){const r=this.personalMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async signPersonalMessage(e){w.default.info("MetaMaskController - signPersonalMessage");const t=e.metamaskId;try{const r=await this.personalMessageManager.approveMessage(e),s=await this.keyringController.signPersonalMessage(r);return this.personalMessageManager.setMsgStatusSigned(t,s),this.getState()}catch(e){throw w.default.info("MetaMaskController - eth_personalSign failed",e),this.personalMessageManager.errorMessage(t,e),e}}cancelPersonalMessage(e){return this.personalMessageManager.rejectMsg(e),this.getState()}async newRequestDecryptMessage(e,t){const r=this.decryptMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async decryptMessageInline(e){w.default.info("MetaMaskController - decryptMessageInline");const t=e.metamaskId,r=this.decryptMessageManager.getMsg(t);try{const t=(0,y.stripHexPrefix)(e.data),n=s.from(t,"hex");e.data=JSON.parse(n.toString("utf8")),r.rawData=await this.keyringController.decryptMessage(e)}catch(e){r.error=e.message}return this.decryptMessageManager._updateMsg(r),this.getState()}async decryptMessage(e){w.default.info("MetaMaskController - decryptMessage");const t=e.metamaskId;try{const r=await this.decryptMessageManager.approveMessage(e),n=(0,y.stripHexPrefix)(r.data),a=s.from(n,"hex");r.data=JSON.parse(a.toString("utf8"));const o=await this.keyringController.decryptMessage(r);this.decryptMessageManager.setMsgStatusDecrypted(t,o)}catch(e){w.default.info("MetaMaskController - eth_decrypt failed.",e),this.decryptMessageManager.errorMessage(t,e)}return this.getState()}cancelDecryptMessage(e){return this.decryptMessageManager.rejectMsg(e),this.getState()}async newRequestEncryptionPublicKey(e,t){const r=e;switch((await this.keyringController.getKeyringForAccount(r)).type){case j.KEYRING_TYPES.LEDGER:return new Promise(((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))}));case j.KEYRING_TYPES.TREZOR:return new Promise(((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))}));case j.KEYRING_TYPES.LATTICE:return new Promise(((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))}));case j.KEYRING_TYPES.QR:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:{const r=this.encryptionPublicKeyManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}}}async encryptionPublicKey(e){w.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const r=await this.encryptionPublicKeyManager.approveMessage(e),s=await this.keyringController.getEncryptionPublicKey(r.data);this.encryptionPublicKeyManager.setMsgStatusReceived(t,s)}catch(e){w.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this.encryptionPublicKeyManager.errorMessage(t,e)}return this.getState()}cancelEncryptionPublicKey(e){return this.encryptionPublicKeyManager.rejectMsg(e),this.getState()}newUnsignedTypedMessage(e,t,r){const s=this.typedMessageManager.addUnapprovedMessageAsync(e,t,r);return this.sendUpdate(),this.opts.showUserConfirmation(),s}async signTypedMessage(e){w.default.info("MetaMaskController - eth_signTypedData");const t=e.metamaskId,{version:r}=e;try{const s=await this.typedMessageManager.approveMessage(e);"V1"!==r&&"string"==typeof s.data&&(s.data=JSON.parse(s.data));const n=await this.keyringController.signTypedMessage(s,{version:r});return this.typedMessageManager.setMsgStatusSigned(t,n),this.getState()}catch(e){throw w.default.info("MetaMaskController - eth_signTypedData failed.",e),this.typedMessageManager.errorMessage(t,e),e}}cancelTypedMessage(e){return this.typedMessageManager.rejectMsg(e),this.getState()}async getCurrentAccountEIP1559Compatibility(){return!0}async createCancelTransaction(e,t,r){await this.txController.createCancelTransaction(e,t,r);return await this.getState()}async createSpeedUpTransaction(e,t,r){await this.txController.createSpeedUpTransaction(e,t,r);return await this.getState()}estimateGas(e){return new Promise(((t,r)=>this.txController.txGasUtil.query.estimateGas(e,((e,s)=>e?r(e):t(s.toString(16))))))}markPasswordForgotten(){this.preferencesController.setPasswordForgotten(!0),this.sendUpdate()}unMarkPasswordForgotten(){this.preferencesController.setPasswordForgotten(!1),this.sendUpdate()}setupUntrustedCommunication({connectionStream:e,sender:t,subjectType:r}){const{usePhishDetect:s}=this.preferencesController.store.getState();let n;if(n=r||(t.id&&t.id!==this.extension.runtime.id?L.SUBJECT_TYPES.EXTENSION:L.SUBJECT_TYPES.WEBSITE),t.url){const{hostname:r}=new URL(t.url);if(s&&this.phishingController.test(r))return w.default.debug("MetaMask - sending phishing warning for",r),void this.sendPhishingWarning(e,r)}const a=(0,Q.setupMultiplex)(e);this.setupProviderConnection(a.createStream("metamask-provider"),t,n),t.url&&this.setupPublicConfig(a.createStream("publicConfig"))}setupTrustedCommunication(e,t){const r=(0,Q.setupMultiplex)(e);this.setupControllerConnection(r.createStream("controller")),this.setupProviderConnection(r.createStream("provider"),t,L.SUBJECT_TYPES.INTERNAL)}sendPhishingWarning(e,t){(0,Q.setupMultiplex)(e).createStream("phishing").write({hostname:t})}setupControllerConnection(e){const t=this.getApi();this.activeControllerConnections+=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.on("data",(0,ve.default)(t,e));const r=t=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"sendUpdate",params:[t]})};this.on("update",r),e.on("end",(()=>{this.activeControllerConnections-=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),this.removeListener("update",r)}))}setupProviderConnection(e,t,r){let s,n;s=r===L.SUBJECT_TYPES.INTERNAL?"metamask":new URL(t.url).origin,t.id&&t.id!==this.extension.runtime.id&&this.subjectMetadataController.addSubjectMetadata({origin:s,extensionId:t.id,subjectType:L.SUBJECT_TYPES.EXTENSION}),t.tab&&t.tab.id&&(n=t.tab.id);const a=this.setupProviderEngine({origin:s,sender:t,subjectType:r,tabId:n}),o=(0,h.default)({engine:a}),c=this.addConnection(s,{engine:a});(0,i.default)(e,o,e,(e=>{a._middleware.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),c&&this.removeConnection(s,c),e&&w.default.error(e)}))}setupProviderEngine({origin:e,subjectType:t,sender:r,tabId:s}){const n=new d.JsonRpcEngine,{blockTracker:a,provider:o}=this,i=(0,p.default)({provider:o,blockTracker:a}),c=(0,f.default)({provider:o,blockTracker:a});return c.events.on("notification",(e=>n.emit("notification",e))),n.push((0,W.default)({origin:e})),s&&n.push((0,Y.default)({tabId:s})),n.push((0,$.default)({origin:e})),n.push(this.permissionLogController.createMiddleware()),t===L.SUBJECT_TYPES.WEBSITE&&n.push((0,z.default)({location:r.url,registerOnboarding:this.onboardingController.registerOnboarding})),n.push((0,V.createMethodMiddleware)({origin:e,subjectType:t,addSubjectMetadata:this.subjectMetadataController.addSubjectMetadata.bind(this.subjectMetadataController),getProviderState:this.getProviderState.bind(this),getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),handleWatchAssetRequest:this.tokensController.watchAsset.bind(this.tokensController),requestUserApproval:this.approvalController.addAndShowApprovalRequest.bind(this.approvalController),sendMetrics:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getAccounts:this.getPermittedAccounts.bind(this,e),getPermissionsForOrigin:this.permissionController.getPermissions.bind(this.permissionController,e),hasPermission:this.permissionController.hasPermission.bind(this.permissionController,e),requestAccountsPermission:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e},{eth_accounts:{}}),requestPermissionsForOrigin:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e}),addCustomRpc:async({chainId:e,blockExplorerUrl:t,ticker:r,chainName:s,rpcUrl:n}={})=>{await this.preferencesController.addToFrequentRpcList(n,e,r,s,{blockExplorerUrl:t})},findCustomRpcBy:this.findCustomRpcBy.bind(this),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),setProviderType:this.networkController.setProviderType.bind(this.networkController),updateRpcTarget:({rpcUrl:e,chainId:t,ticker:r,nickname:s})=>{this.networkController.setRpcTarget(e,t,r,s)},getWeb3ShimUsageState:this.alertController.getWeb3ShimUsageState.bind(this.alertController),setWeb3ShimUsageRecorded:this.alertController.setWeb3ShimUsageRecorded.bind(this.alertController)})),n.push(i),n.push(c.middleware),t!==L.SUBJECT_TYPES.INTERNAL&&n.push(this.permissionController.createPermissionMiddleware({origin:e})),n.push((0,g.providerAsMiddleware)(o)),n}setupPublicConfig(e){const t=(0,l.storeAsStream)(this.publicConfigStore);(0,i.default)(t,e,(e=>{t.destroy(),e&&w.default.error(e)}))}addConnection(e,{engine:t}){if("metamask"===e)return null;this.connections[e]||(this.connections[e]={});const r=(0,E.default)();return this.connections[e][r]={engine:t},r}removeConnection(e,t){const r=this.connections[e];r&&(delete r[t],0===Object.keys(r).length&&delete this.connections[e])}removeAllConnections(e){const t=this.connections[e];t&&Object.keys(t).forEach((t=>{this.removeConnection(e,t)}))}notifyConnections(e,t){const r=this.connections[e];r&&Object.values(r).forEach((e=>{e.engine&&e.engine.emit("notification",t)}))}notifyAllConnections(e){const t="function"==typeof e?t=>e(t):()=>e;Object.keys(this.connections).forEach((e=>{Object.values(this.connections[e]).forEach((async r=>{r.engine&&r.engine.emit("notification",await t(e))}))}))}async _onKeyringControllerUpdate(e){const{keyrings:t}=e,r=t.reduce(((e,{accounts:t})=>e.concat(t)),[]);r.length&&(this.preferencesController.syncAddresses(r),this.accountTracker.syncWithAddresses(r))}_onUnlock(){this.notifyAllConnections((async e=>({method:ye.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!0,accounts:await this.getPermittedAccounts(e)}}))),this.emit("unlock")}_onLock(){this.notifyAllConnections({method:ye.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!1}}),this.emit("lock")}_onStateUpdate(e){this.isClientOpenAndUnlocked=e.isUnlocked&&this._isClientOpen,this.notifyAllConnections({method:ye.NOTIFICATION_NAMES.chainChanged,params:this.getProviderNetworkState(e)})}privateSendUpdate(){this.emit("update",this.getState())}isUnlocked(){return this.keyringController.memStore.getState().isUnlocked}getExternalPendingTransactions(e){return this.smartTransactionsController.getTransactions({addressFrom:e,status:"pending"})}async getPendingNonce(e){const{nonceDetails:t,releaseLock:r}=await this.txController.nonceTracker.getNonceLock(e),s=t.params.highestSuggested;return r(),s}async getNextNonce(e){const t=await this.txController.nonceTracker.getNonceLock(e);return t.releaseLock(),t.nextNonce}async migrateAddressBookState(e,t,r=!1){const{addressBook:s}=this.addressBookController.state;if(s[e])for(const n of Object.keys(s[e])){const a=s[e][n];this.addressBookController.set(n,a.name,t,a.memo),r||this.addressBookController.delete(e,n)}}async updateAndSetCustomRpc(e,t,r="ETH",s,n){return this.networkController.setRpcTarget(e,t,r,s,n),await this.preferencesController.updateRpc({rpcUrl:e,chainId:t,ticker:r,nickname:s,rpcPrefs:n}),e}async setCustomRpc(e,t,r="ETH",s="",n={}){const a=this.preferencesController.getFrequentRpcListDetail().find((t=>e===t.rpcUrl));return a?this.networkController.setRpcTarget(a.rpcUrl,a.chainId,a.ticker,a.nickname,n):(this.networkController.setRpcTarget(e,t,r,s,n),await this.preferencesController.addToFrequentRpcList(e,t,r,s,n)),e}async delCustomRpc(e){await this.preferencesController.removeFromFrequentRpcList(e)}findCustomRpcBy(e){const t=this.preferencesController.getFrequentRpcListDetail();for(const r of t)for(const t of Object.keys(e))if(r[t]===e[t])return r;return null}async initializeThreeBox(){await this.threeBoxController.init()}async setLedgerTransportPreference(e){const t=this.preferencesController.getLedgerTransportPreference(),r=this.preferencesController.setLedgerTransportPreference(e),s=await this.getKeyringForDevice(j.DEVICE_NAMES.LEDGER);return null!=s&&s.updateTransportMethod?s.updateTransportMethod(r).catch((e=>{throw this.preferencesController.setLedgerTransportPreference(t),e})):undefined}recordFirstTimeInfo(e){if(!("firstTimeInfo"in e)){const t=this.platform.getVersion();e.firstTimeInfo={version:t,date:Date.now()}}}set isClientOpen(e){this._isClientOpen=e,this.detectTokensController.isOpen=e}onClientClosed(){try{this.gasFeeController.stopPolling(),this.appStateController.clearPollingTokens()}catch(e){console.error(e)}}onEnvironmentTypeClosed(e){const t=L.POLLING_TOKEN_ENVIRONMENT_TYPES[e];this.appStateController.store.getState()[t].forEach((e=>{this.gasFeeController.disconnectPoller(e),this.appStateController.removePollingToken(e,t)}))}safelistPhishingDomain(e){return this.phishingController.bypass(e)}setLocked(){const[e]=this.keyringController.getKeyringsByType(j.KEYRING_TYPES.TREZOR);return e&&e.dispose(),this.keyringController.setLocked()}}r.default=Pe}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"<root>",file:"/home/circleci/project/app/scripts/metamask-controller.js"}],[2327,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var s,n,a,o,i;function c(){var l=Date.now()-o;l<t&&l>=0?s=setTimeout(c,t-l):(s=null,r||(i=e.apply(a,n),a=n=null))}null==t&&(t=100);var l=function(){a=this,n=arguments,o=Date.now();var l=r&&!s;return s||(s=setTimeout(c,t)),l&&(i=e.apply(a,n),a=n=null),i};return l.clear=function(){s&&(clearTimeout(s),s=null)},l.flush=function(){s&&(i=e.apply(a,n),a=n=null,clearTimeout(s),s=null)},l}}}},{package:"debounce",file:"/home/circleci/project/node_modules/debounce/index.js"}],[6011,{_process:5498,stream:2160},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var s=e("stream");function n(e,t,n){e=e||function(e){this.queue(e)},t=t||function(){this.queue(null)};var a=!1,o=!1,i=[],c=!1,l=new s;function d(){for(;i.length&&!l.paused;){var e=i.shift();if(null===e)return l.emit("end");l.emit("data",e)}}function u(){l.writable=!1,t.call(l),!l.readable&&l.autoDestroy&&l.destroy()}return l.readable=l.writable=!0,l.paused=!1,l.autoDestroy=!(n&&!1===n.autoDestroy),l.write=function(t){return e.call(this,t),!l.paused},l.queue=l.push=function(e){return c||(null===e&&(c=!0),i.push(e),d()),l},l.on("end",(function(){l.readable=!1,!l.writable&&l.autoDestroy&&r.nextTick((function(){l.destroy()}))})),l.end=function(e){if(!a)return a=!0,arguments.length&&l.write(e),u(),l},l.destroy=function(){if(!o)return o=!0,a=!0,i.length=0,l.writable=l.readable=!1,l.emit("close"),l},l.pause=function(){if(!l.paused)return l.paused=!0,l},l.resume=function(){return l.paused&&(l.paused=!1,l.emit("resume")),d(),l.paused||l.emit("drain"),l},l}t.exports=n,n.through=n}).call(this)}).call(this,e("_process"))}}},{package:"through",file:"/home/circleci/project/node_modules/through/index.js"}],[2390,{stream:2160},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("stream"),n=["write","end","destroy"],a=["resume","pause"],o=["data","close"],i=Array.prototype.slice;function c(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r)}t.exports=function(e,t){var r=new s,l=!1;return c(n,(function(t){function s(){return e[t].apply(e,arguments)}r[t]=s})),c(a,(function(e){function s(){r.emit(e);var s=t[e];if(s)return s.apply(t,arguments);t.emit(e)}r[e]=s})),c(o,(function(e){function s(){var t=i.call(arguments);t.unshift(e),r.emit.apply(r,t)}t.on(e,s)})),t.on("end",(function(){if(l)return;l=!0;var e=i.call(arguments);e.unshift("end"),r.emit.apply(r,e)})),e.on("drain",(function(){r.emit("drain")})),e.on("error",d),t.on("error",d),r.writable=e.writable,r.readable=t.readable,r;function d(e){r.emit("error",e)}}}}},{package:"duplexer",file:"/home/circleci/project/node_modules/duplexer/index.js"}],[1192,{stream:2160},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const s=e("stream");class n extends s.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new n(e)}}}},{package:"@metamask/obs-store",file:"/home/circleci/project/node_modules/@metamask/obs-store/dist/asStream.js"}],[1188,{"./ObservableStore":1191},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ComposedStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e){super();this.getState()||this.putState({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const r=t=>{const r=this.getState();r[e]=t,this.putState(r)};t.subscribe(r),r(t.getState())}}r.ComposedStore=n}}},{package:"@metamask/obs-store",file:"/home/circleci/project/node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[1189,{"./ObservableStore":1191},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LocalStorageStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e={}){if(!global.localStorage)throw new Error("LocalStorageStore - can't find localStorage.");if(super(),!e.storageKey)throw new Error("LocalStorageStore - no storageKey specified.");this._storageKey=e.storageKey}_getState(){const e=global.localStorage.getItem(this._storageKey);return e?JSON.parse(e):undefined}_putState(e){const t=JSON.stringify(e);return global.localStorage.setItem(this._storageKey,t)}}r.LocalStorageStore=n}}},{package:"@metamask/obs-store",file:"/home/circleci/project/node_modules/@metamask/obs-store/dist/LocalStorageStore.js"}],[1190,{"./ObservableStore":1191},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MergedStore=void 0;const s=e("./ObservableStore");class n extends s.ObservableStore{constructor(e=[]){super();this.getState()||this.putState({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}r.MergedStore=n}}},{package:"@metamask/obs-store",file:"/home/circleci/project/node_modules/@metamask/obs-store/dist/MergedStore.js"}],[1191,{"@metamask/safe-event-emitter":1315},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObservableStore=void 0;const n=s(e("@metamask/safe-event-emitter"));class a extends n.default{constructor(e={}){super(),this._state=e}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState(),r=Object.assign({},t,e);this.putState(r)}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}r.ObservableStore=a}}},{package:"@metamask/obs-store",file:"/home/circleci/project/node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[1194,{through2:1195},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const s=e("through2");r.storeTransformStream=function(e){return s.obj(((t,r,s)=>{try{return s(null,e(t)),undefined}catch(e){return s(e),undefined}}))}}}},{package:"@metamask/obs-store",file:"/home/circleci/project/node_modules/@metamask/obs-store/dist/transform.js"}],[84,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:3,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=3;try{"https://rawtestrpc.metamask.io/"===t.data.config.provider.rpcTarget&&(t.data.config.provider.rpcTarget="https://testrpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/003.js"}],[83,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:2,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=2;try{"etherscan"===t.data.config.provider.type&&(t.data.config.provider.type="rpc",t.data.config.provider.rpcTarget="https://rpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/002.js"}],[90,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:9,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=9;try{const e=function(e){const t=(0,s.merge)({},e,{CurrencyController:{currentCurrency:e.currentFiat||e.fiatCurrency||"USD",conversionRate:e.conversionRate,conversionDate:e.conversionDate}});return delete t.currentFiat,delete t.fiatCurrency,delete t.conversionRate,delete t.conversionDate,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #9${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/009.js"}],[85,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:4,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=4;try{if("rpc"!==t.data.config.provider.type)return Promise.resolve(t);switch(t.data.config.provider.rpcTarget){case"https://testrpc.metamask.io/":t.data.config.provider={type:"testnet"};break;case"https://rpc.metamask.io/":t.data.config.provider={type:"mainnet"}}}catch(e){}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/004.js"}],[91,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:10,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=10;try{const e=function(e){const t=(0,s.merge)({},e,{ShapeShiftController:{shapeShiftTxList:e.shapeShiftTxList||[]}});return delete t.shapeShiftTxList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #10${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/010.js"}],[93,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:12,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=12;try{const e=function(e){const t=e;return t.NoticeController.noticesList.forEach((e=>{e.read&&(e.body="")})),t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #12${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/012.js"}],[94,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:13,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=13;try{const e=function(e){const t=e,{config:r}=t;r&&r.provider&&"testnet"===r.provider.type&&(t.config.provider.type="ropsten");return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #13${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/013.js"}],[92,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:11,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=11;try{const e=function(e){const t=e;return delete t.TOSHash,delete t.isDisclaimerConfirmed,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #11${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/011.js"}],[97,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:16,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=16;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>e.err?("transaction with the same hash was already imported."===e.err&&(e.status=n.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #16${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/016.js"}],[95,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:14,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=14;try{const e=function(e){const t=e;return t.NetworkController={},t.NetworkController.provider=t.config.provider,delete t.config.provider,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #14${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/014.js"}],[96,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:15,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=15;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=r;t.TransactionController.transactions=e.map((e=>e.err?("Gave up submitting tx."===e.err.message&&(e.status=n.TRANSACTION_STATUSES.FAILED),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #15${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/015.js"}],[100,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:19,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=19;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map(((e,t,r)=>{if(e.status!==n.TRANSACTION_STATUSES.SUBMITTED)return e;const s=function(e){const t=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t||"0x0",16)}));return Math.max.apply(null,t)}(r.filter((e=>e.status===n.TRANSACTION_STATUSES.CONFIRMED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from))),a=function(e,t){const r=e.map((e=>{const{nonce:t}=e.txParams;return parseInt(t,16)}));let s=t;for(;r.includes(s);)s+=1;return s}(r.filter((e=>e.status===n.TRANSACTION_STATUSES.SUBMITTED)).filter((t=>t.txParams.from===e.txParams.from)).filter((t=>t.metamaskNetworkId.from===e.metamaskNetworkId.from)),s),o=Math.max(a,s);return parseInt(e.txParams.nonce,16)>o+1&&(e.status=n.TRANSACTION_STATUSES.FAILED,e.err={message:"nonce too high",note:"migration 019 custom error"}),e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #19${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/019.js"}],[101,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:20,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=20;try{const e=function(e){const t=e;"metamask"in t&&!("firstTimeInfo"in t.metamask)&&(t.metamask.firstTimeInfo={version:"3.12.0",date:Date.now()});return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #20${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/020.js"}],[103,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:22,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=22;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==n.TRANSACTION_STATUSES.SUBMITTED||e.submittedTime||(e.submittedTime=(new Date).getTime()),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #22${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/022.js"}],[102,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:21,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=21;try{const e=function(e){const t=e;return delete t.BlacklistController,delete t.RecentBlocks,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #21${e.stack}`)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/021.js"}],[104,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:23,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=23;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;if(e.length<=40)return t;const r=e.reverse();let s=!0;for(;r.length>40&&s;){const e=r.findIndex((e=>e.status===n.TRANSACTION_STATUSES.FAILED||e.status===n.TRANSACTION_STATUSES.REJECTED||e.status===n.TRANSACTION_STATUSES.CONFIRMED||e.status===n.TRANSACTION_STATUSES.DROPPED));e<0?s=!1:r.splice(e,1)}t.TransactionController.transactions=r.reverse()}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #23${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/023.js"}],[106,{"../../../shared/constants/transaction":6270,"../lib/util":81,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../lib/util"),a=e("../../../shared/constants/transaction");var o={version:25,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=25;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(e.status!==a.TRANSACTION_STATUSES.UNAPPROVED||(e.txParams=function(e){const t={from:e=>(0,n.addHexPrefix)(e).toLowerCase(),to:()=>(0,n.addHexPrefix)(e.to).toLowerCase(),nonce:e=>(0,n.addHexPrefix)(e),value:e=>(0,n.addHexPrefix)(e),data:e=>(0,n.addHexPrefix)(e),gas:e=>(0,n.addHexPrefix)(e),gasPrice:e=>(0,n.addHexPrefix)(e)},r={};return Object.keys(t).forEach((s=>{e[s]&&(r[s]=t[s](e[s]))})),r}(e.txParams)),e)))}return t}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/025.js"}],[107,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:26,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=26;try{const e=t.data;t.data=function(e){if(!e.KeyringController||!e.PreferencesController)return e;if(!e.KeyringController.walletNicknames)return e;return e.PreferencesController.identities=Object.keys(e.KeyringController.walletNicknames).reduce(((t,r)=>(t[r]={name:e.KeyringController.walletNicknames[r],address:r},t)),{}),delete e.KeyringController.walletNicknames,e}(e)}catch(e){return console.warn(`MetaMask Migration #26${e.stack}`),Promise.reject(e)}return Promise.resolve(t)}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/026.js"}],[98,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:17,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=17;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>(!e.status===n.TRANSACTION_STATUSES.FAILED||e.retryCount>0&&e.retryCount<2&&(e.status=n.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e)))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #17${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/017.js"}],[105,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:24,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=24;const r=function(e){const t=e;if(!t.TransactionController)return t;const{transactions:r}=t.TransactionController;return t.TransactionController.transactions=r.map(((e,t)=>(e.status===n.TRANSACTION_STATUSES.UNAPPROVED&&e.txParams&&e.txParams.from&&(e.txParams.from=e.txParams.from.toLowerCase()),e))),t}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/024.js"}],[108,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:27,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=27;const r=function(e){const t=e;if(t.TransactionController&&t.TransactionController.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.filter((e=>e.status!==n.TRANSACTION_STATUSES.REJECTED))}return t}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/027.js"}],[109,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:28,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=28;const r=function(e){const t=e;if(t.PreferencesController&&t.PreferencesController.tokens&&t.PreferencesController.identities){const{identities:e,tokens:r}=t.PreferencesController;t.PreferencesController.accountTokens={},Object.keys(e).forEach((e=>{t.PreferencesController.accountTokens[e]={mainnet:r}})),t.PreferencesController.tokens=[]}return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/028.js"}],[112,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:31,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=31;const r=function(e){const{KeyringController:t,PreferencesController:r}=e;if(t&&r){const{vault:e}=t;r.completedOnboarding=Boolean(e)}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/031.js"}],[113,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:32,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=32;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const{betaUI:e}=t.featureFlags||{};t.completedUiMigration=e}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/032.js"}],[111,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:30,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=30;const r=function(e){const t=e;if(e.PreferencesController){const{frequentRpcListDetail:e}=t.PreferencesController;e&&(e.forEach(((t,r)=>{Boolean(t.chainId)&&Number.isNaN(parseInt(t.chainId))&&delete e[r].chainId})),t.PreferencesController.frequentRpcListDetail=e)}e.NetworkController&&(t.NetworkController.network&&Number.isNaN(parseInt(t.NetworkController.network))&&delete t.NetworkController.network,t.NetworkController.provider&&t.NetworkController.provider.chainId&&Number.isNaN(parseInt(t.NetworkController.provider.chainId))&&delete t.NetworkController.provider.chainId);return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/030.js"}],[114,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:33,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=33;const r=function(e){const t=e;e.NoticeController&&delete t.NoticeController;return t}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/033.js"}],[115,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:34,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=34;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};e.privacyMode||void 0!==t.migratedPrivacyMode||(t.migratedPrivacyMode=!0,e.privacyMode=!0)}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/034.js"}],[116,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:35,async migrate(e){const t=(0,s.cloneDeep)(e);return t.meta.version=35,t.data=function(e){e.PreferencesController&&e.PreferencesController.seedWords!==undefined&&delete e.PreferencesController.seedWords;return e}(t.data),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/035.js"}],[117,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:36,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=36;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.featureFlags||{};void 0!==e.privacyMode&&delete e.privacyMode}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/036.js"}],[120,{"../../../shared/modules/hexstring-utils":6276,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/modules/hexstring-utils");const a="SAI";function o(e={}){return e&&"object"==typeof e&&"DAI"===e.symbol&&"0x89d24A6b4CcB1B6fAA2625fE562bDD9a23260359"===(0,n.toChecksumHexAddress)(e.address)}var i={version:39,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=39;const r=t.data;return t.data=function(e){const{PreferencesController:t}=e;if(t){const e=t.tokens||[];if(Array.isArray(e))for(const t of e)o(t)&&(t.symbol=a);const r=t.accountTokens||{};if(r&&"object"==typeof r)for(const e of Object.keys(r)){const t=r[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=t[e];if(Array.isArray(r))for(const e of r)o(e)&&(e.symbol=a)}}}return e}(r),t}};r.default=i}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/039.js"}],[121,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:40,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=40;const r=t.data;return t.data=function(e){return delete e.ProviderApprovalController,e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/040.js"}],[123,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:42,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=42;const r=t.data;return t.data=function(e){e.AppStateController?e.AppStateController.connectedStatusPopoverHasBeenShown=!1:e.AppStateController={connectedStatusPopoverHasBeenShown:!1};return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/042.js"}],[124,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:43,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=43;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.PreferencesController)&&void 0!==t&&t.currentAccountTab&&delete e.PreferencesController.currentAccountTab;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/043.js"}],[125,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:44,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=44;const r=t.data;return t.data=function(e){var t;void 0!==(null==e||null===(t=e.AppStateController)||void 0===t?void 0:t.mkrMigrationReminderTimestamp)&&delete e.AppStateController.mkrMigrationReminderTimestamp;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/044.js"}],[122,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:41,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=41;const r=t.data;return t.data=function(e){e.PreferencesController&&e.PreferencesController.preferences&&(e.PreferencesController.preferences.autoLockTimeLimit=e.PreferencesController.preferences.autoLogoutTimeLimit,delete e.PreferencesController.preferences.autoLogoutTimeLimit);return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/041.js"}],[126,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:45,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=45;const r=t.data;return t.data=function(e){var t;a.includes(null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.ipfsGateway)&&(e.PreferencesController.ipfsGateway="dweb.link");return e}(r),t}};r.default=n;const a=["ipfs.io","ipfs.dweb.link"]}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/045.js"}],[127,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:46,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=46;const r=t.data;return t.data=function(e){void 0!==(null==e?void 0:e.ABTestController)&&delete e.ABTestController;return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/046.js"}],[128,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:47,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=47;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;Array.isArray(r)&&r.forEach((e=>{"number"==typeof e.metamaskNetworkId&&(e.metamaskNetworkId=e.metamaskNetworkId.toString())}));return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/047.js"}],[130,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:49,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=49;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){var t;const{metaMetricsId:r,participateInMetaMetrics:s,metaMetricsSendCount:n}=e.PreferencesController;e.MetaMetricsController=null!==(t=e.MetaMetricsController)&&void 0!==t?t:{},r!==undefined&&(e.MetaMetricsController.metaMetricsId=r,delete e.PreferencesController.metaMetricsId),s!==undefined&&(e.MetaMetricsController.participateInMetaMetrics=s,delete e.PreferencesController.participateInMetaMetrics),n!==undefined&&(e.MetaMetricsController.metaMetricsSendCount=n,delete e.PreferencesController.metaMetricsSendCount)}return e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/049.js"}],[131,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");const n=["METASWAP_GAS_PRICE_ESTIMATES_LAST_RETRIEVED","METASWAP_GAS_PRICE_ESTIMATES","cachedFetch","BASIC_PRICE_ESTIMATES_LAST_RETRIEVED","BASIC_PRICE_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES"];var a={version:50,async migrate(e){const t=(0,s.cloneDeep)(e);return t.meta.version=50,n.forEach((e=>{var t;return null===(t=window.localStorage)||void 0===t?void 0:t.removeItem(e)})),t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/050.js"}],[132,{"../../../shared/constants/network":6266,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var a={version:51,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=51;const r=t.data;return t.data=function(e){var t,r;const{chainId:s,type:a}=(null==e||null===(t=e.NetworkController)||void 0===t?void 0:t.provider)||{},o=null===(r=n.NETWORK_TYPE_TO_ID_MAP[a])||void 0===r?void 0:r.chainId;o&&s!==o&&(e.NetworkController.provider.chainId=o);return e}(r),t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/051.js"}],[135,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");function n(e){return"number"==typeof e||"string"==typeof e&&e.match(/^(0x)?\d+$/u)}var a={version:54,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=54;const r=function(e){const t=e;if(!t.PreferencesController)return t;const r=(t.PreferencesController.tokens||[]).filter((({decimals:e})=>n(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t.PreferencesController.tokens=r;const{accountTokens:s}=t.PreferencesController;if(s&&"object"==typeof s)for(const e of Object.keys(s)){const t=s[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=(t[e]||[]).filter((({decimals:e})=>n(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t[e]=r}}return t.PreferencesController.accountTokens=s,t}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/054.js"}],[136,{"../../../shared/constants/network":6266,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var a={version:55,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=55;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.IncomingTransactionsController)&&void 0!==t&&t.incomingTxLastFetchedBlocksByNetwork&&(e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId=(0,s.mapKeys)(e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork,((e,t)=>{var r,s;return null!==(r=null===(s=n.NETWORK_TYPE_TO_ID_MAP[t])||void 0===s?void 0:s.chainId)&&void 0!==r?r:o})),delete e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId.UNKNOWN,delete e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork);return e}(r),t}};r.default=a;const o="UNKNOWN"}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/055.js"}],[133,{"../../../shared/constants/network":6266,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/network");var a={version:52,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=52;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){const{accountTokens:t,accountHiddenTokens:r,frequentRpcListDetail:s}=e.PreferencesController,a={},o={};if(t&&Object.keys(t).length>0){for(const e of Object.keys(t)){a[e]={},t[e][n.NETWORK_TYPE_RPC]&&s.forEach((r=>{a[e][r.chainId]=t[e][n.NETWORK_TYPE_RPC]}));for(const r of Object.keys(t[e]))switch(r){case n.MAINNET:a[e][n.MAINNET_CHAIN_ID]=t[e][n.MAINNET];break;case n.ROPSTEN:a[e][n.ROPSTEN_CHAIN_ID]=t[e][n.ROPSTEN];break;case n.RINKEBY:a[e][n.RINKEBY_CHAIN_ID]=t[e][n.RINKEBY];break;case n.GOERLI:a[e][n.GOERLI_CHAIN_ID]=t[e][n.GOERLI];break;case n.KOVAN:a[e][n.KOVAN_CHAIN_ID]=t[e][n.KOVAN]}}e.PreferencesController.accountTokens=a}if(r&&Object.keys(r).length>0){for(const e of Object.keys(r)){o[e]={},r[e][n.NETWORK_TYPE_RPC]&&s.forEach((t=>{o[e][t.chainId]=r[e][n.NETWORK_TYPE_RPC]}));for(const t of Object.keys(r[e]))switch(t){case n.MAINNET:o[e][n.MAINNET_CHAIN_ID]=r[e][n.MAINNET];break;case n.ROPSTEN:o[e][n.ROPSTEN_CHAIN_ID]=r[e][n.ROPSTEN];break;case n.RINKEBY:o[e][n.RINKEBY_CHAIN_ID]=r[e][n.RINKEBY];break;case n.GOERLI:o[e][n.GOERLI_CHAIN_ID]=r[e][n.GOERLI];break;case n.KOVAN:o[e][n.KOVAN_CHAIN_ID]=r[e][n.KOVAN]}}e.PreferencesController.accountHiddenTokens=o}}return e}(r),t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/052.js"}],[137,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:56,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=56;const{PreferencesController:r}=t.data;return Array.isArray(null==r?void 0:r.tokens)&&(r.tokens=r.tokens.filter((({address:e})=>e))),null!=r&&r.accountTokens&&"object"==typeof r.accountTokens&&Object.keys(r.accountTokens).forEach((e=>{Object.keys(r.accountTokens[e]).forEach((t=>{r.accountTokens[e][t]=r.accountTokens[e][t].filter((({address:e})=>e))}))})),null!=r&&r.assetImages&&"undefined"in r.assetImages&&delete r.assetImages.undefined,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/056.js"}],[139,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:58,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=58;const r=t.data;return t.data=function(e){var t;return null===(t=e.AppStateController)||void 0===t||delete t.swapsWelcomeMessageHasBeenShown,e}(r),t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/058.js"}],[142,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:61,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=61;const r=function(e){const t=(new Date).getTime();e.AppStateController?(e.AppStateController.recoveryPhraseReminderHasBeenShown=!1,e.AppStateController.recoveryPhraseReminderLastShown=t):e.AppStateController={recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:t};return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/061.js"}],[141,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");const n="2020-08-31";var a={version:60,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=60;const r=function(e){var t;const r=null==e||null===(t=e.NotificationController)||void 0===t?void 0:t.notifications;var a;(0,s.isPlainObject)(r)&&(null===(a=r[2])||void 0===a?void 0:a.date)===n&&delete e.NotificationController.notifications[2];return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/060.js"}],[143,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:62,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=62;const r=function(e){if(e.MetaMetricsController){const{metaMetricsSendCount:t}=e.MetaMetricsController;t!==undefined&&delete e.MetaMetricsController.metaMetricsSendCount}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/062.js"}],[140,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");var a={version:59,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=59;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,s.isPlainObject)(r)){const t=(0,s.groupBy)(Object.values(r),(e=>{var t,r;return`${null===(t=e.txParams)||void 0===t?void 0:t.nonce}-${null!==(r=e.chainId)&&void 0!==r?r:e.metamaskNetworkId}`})),a=(0,s.pickBy)(t,(e=>e.some((e=>e.type!==n.TRANSACTION_TYPES.CANCEL&&e.type!==n.TRANSACTION_TYPES.RETRY))));e.TransactionController.transactions=(0,s.keyBy)((0,s.concat)(...Object.values(a)),(e=>e.id))}return e}(r),t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/059.js"}],[145,{"../../../shared/constants/transaction":6270,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/transaction");const a="sentEther";var o={version:64,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=64;const r=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,s.isPlainObject)(r))for(const e of Object.values(r))e.type===a&&(e.type=n.TRANSACTION_TYPES.SIMPLE_SEND),e.history&&e.history.map((e=>(e.type&&e.type===a&&(e.type=n.TRANSACTION_TYPES.SIMPLE_SEND),e)));return e}(t.data);return t.data=r,t}};r.default=o}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/064.js"}],[146,{lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash");var n={version:65,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=65;const r=function(e){if(e.PreferencesController){var t;const{completedOnboarding:r,firstTimeFlowType:s}=e.PreferencesController;e.OnboardingController=null!==(t=e.OnboardingController)&&void 0!==t?t:{},r!==undefined&&(e.OnboardingController.completedOnboarding=r,delete e.PreferencesController.completedOnboarding),s!==undefined&&(e.OnboardingController.firstTimeFlowType=s,delete e.PreferencesController.firstTimeFlowType)}return e}(t.data);return t.data=r,t}};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/065.js"}],[150,{"../../../shared/constants/app":6261,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../../../shared/constants/app");var a={version:69,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=69;const r=function(e){var t;if("object"==typeof(null==e||null===(t=e.SubjectMetadataController)||void 0===t?void 0:t.subjectMetadata)){const{SubjectMetadataController:{subjectMetadata:t}}=e;Object.values(t).forEach((e=>{e&&"object"==typeof e&&!Array.isArray(e)&&(e.subjectType=e.extensionId?n.SUBJECT_TYPES.EXTENSION:n.SUBJECT_TYPES.WEBSITE)}))}return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/069.js"}],[118,{"@metamask/controllers":1042,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("@metamask/controllers");var a={version:37,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=37;const r=t.data;return t.data=function(e){if(e.AddressBookController){const t=e.AddressBookController.addressBook,r=new Set,s={};Object.values(t).forEach((e=>{r.add(e.chainId)}));for(const e of r.values()){s[e]={};for(const r in t)t[r].chainId===e&&(t[r].isEns=!1,n.util.normalizeEnsName(t[r].name)&&(t[r].isEns=!0),s[e][r]=t[r])}e.AddressBookController.addressBook=s}return e}(r),t}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/037.js"}],[86,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:5,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=5;try{const e=function(e){const{config:t}=e,r=i(i({},e),{},{KeyringController:{vault:e.vault,selectedAccount:t.selectedAccount,walletNicknames:e.walletNicknames}});return delete r.vault,delete r.walletNicknames,delete r.config.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #5${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/005.js"}],[87,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:6,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=6;try{const e=function(e){const t=e.KeyringController,r=i(i({},e),{},{PreferencesController:{selectedAddress:t.selectedAccount}});return delete r.KeyringController.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #6${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/006.js"}],[88,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:7,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=7;try{const e=function(e){const t=i(i({},e),{},{TransactionManager:{transactions:e.transactions||[],gasMultiplier:e.gasMultiplier||1}});return delete t.transactions,delete t.gasMultiplier,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #7${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/007.js"}],[89,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:8,migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=8;try{const e=function(e){const t=i(i({},e),{},{NoticeController:{noticesList:e.noticesList||[]}});return delete t.noticesList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #8${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/008.js"}],[110,{"../../../shared/constants/transaction":6270,"./fail-tx":151,"@babel/runtime/helpers/interopRequireDefault":195},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../../../shared/constants/transaction"),a=s(e("./fail-tx"));var o={version:29,migrate:(0,a.default)(29,"Stuck in approved state for too long.",(e=>{const t=e.status===n.TRANSACTION_STATUSES.APPROVED,r=e.submittedTime,s=Date.now();return t&&s-r>432e5}))};r.default=o}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/029.js"}],[119,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:38,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=38;const r=t.data;return t.data=function(e){const{ABTestController:t={}}=e,{abTests:r={}}=t;if(r.fullScreenVsPopup)return e;return i(i({},e),{},{ABTestController:i(i({},t),{},{abTests:i(i({},r),{},{fullScreenVsPopup:"control"})})})}(r),t}};r.default=c}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/038.js"}],[129,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:48,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=48;const r=t.data;return t.data=function(e={}){var t,r,s,n,a,o,c,u,h;null===(t=e.NetworkController)||void 0===t||delete t.settings;const p=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{};if(("rpc"!==p.type||"string"==typeof p.chainId&&d.test(p.chainId))&&"localhost"!==p.type){if(null!==(s=e.NetworkController)&&void 0!==s&&s.provider){var f,g;if("rpcTarget"in e.NetworkController.provider){const t=e.NetworkController.provider.rpcTarget;e.NetworkController.provider.rpcUrl=t}null===(f=e.NetworkController)||void 0===f||(null===(g=f.provider)||void 0===g||delete g.rpcTarget)}}else e.NetworkController.provider={type:"rinkeby",rpcUrl:"",chainId:"0x4",nickname:"",rpcPrefs:{},ticker:"ETH"};e.PreferencesController||(e.PreferencesController={});e.PreferencesController.frequentRpcListDetail||(e.PreferencesController.frequentRpcListDetail=[]);e.PreferencesController.frequentRpcListDetail.unshift({rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}),null===(n=e.CachedBalancesController)||void 0===n||delete n.cachedBalances;const m=null===(a=e.TransactionController)||void 0===a?void 0:a.transactions;Array.isArray(m)&&m.forEach((e=>{const t=null==e?void 0:e.metamaskNetworkId;"string"==typeof t&&l.test(t)&&(e.metamaskNetworkId=parseInt(t,16).toString(10))}));const b=(null===(o=e.AddressBookController)||void 0===o?void 0:o.addressBook)||{};Object.keys(b).forEach((e=>{if(/^\d+$/iu.test(e)){const t=`0x${parseInt(e,10).toString(16)}`;!function(e,t){Object.values(e).forEach((e=>{e&&"object"==typeof e&&(e.chainId=t)}))}(b[e],t),b[t]?function(e,t,r){const s=e[t]||{},n=i({},e[r]);Object.keys(s).forEach((e=>{if(n[e]&&"object"==typeof n[e]){const t={};new Set([...Object.keys(n[e]),...Object.keys(s[e]||{})]).forEach((r=>{var a;t[r]=n[e][r]||(null===(a=s[e])||void 0===a?void 0:a[r])||""})),n[e]=t}else s[e]&&"object"==typeof s[e]&&(n[e]=s[e])})),e[r]=n}(b,e,t):b[t]=b[e],delete b[e]}})),null===(c=e.IncomingTransactionsController)||void 0===c||null===(u=c.incomingTxLastFetchedBlocksByNetwork)||void 0===u||delete u.localhost;const v=null===(h=e.PreferencesController)||void 0===h?void 0:h.accountTokens;v&&Object.keys(v).forEach((e=>{var t,r;const s=(null===(t=v[e])||void 0===t?void 0:t.localhost)||[];if(s.length>0){const t=v[e].rpc||[];t.length>0?v[e].rpc=function(e,t){const r=a(e),s=a(t),n=[];return new Set([...Object.keys(r),...Object.keys(s)]).forEach((e=>{n.push(i(i({},r[e]),s[e]))})),n;function a(e){return e.reduce(((e,t)=>(null!=t&&t.address&&"string"==typeof(null==t?void 0:t.address)&&(e[t.address]=t),e)),{})}}(s,t):v[e].rpc=s}null===(r=v[e])||void 0===r||delete r.localhost}));return e}(r),t}};r.default=c;const l=/^0x[0-9a-f]+$/iu,d=/^0x[1-9a-f]+[0-9a-f]*$/iu}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/048.js"}],[134,{"../../../shared/constants/transaction":6270,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=e("../../../shared/constants/transaction");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={version:53,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=53;const r=t.data;return t.data=function(e){var t,r;const s=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions,n=null==e||null===(r=e.IncomingTransactionsController)||void 0===r?void 0:r.incomingTransactions;Array.isArray(s)&&s.forEach((e=>{e&&(e.type!==o.TRANSACTION_TYPES.RETRY&&e.type!==o.TRANSACTION_TYPES.CANCEL&&(e.type=e.transactionCategory),delete e.transactionCategory)}));if(n){Object.entries(n).forEach((([t,r])=>{r&&(delete r.transactionCategory,e.IncomingTransactionsController.incomingTransactions[t]=c(c({},r),{},{type:o.TRANSACTION_TYPES.INCOMING}))}))}return e}(r),t}};r.default=l}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/053.js"}],[138,{"../../../shared/modules/random-id":6278,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),a=s(e("../../../shared/modules/random-id"));var o={version:57,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=57;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.TransactionController)&&void 0!==t&&t.transactions&&Array.isArray(e.TransactionController.transactions)&&!e.TransactionController.transactions.some((e=>"object"!=typeof e||void 0===e.txParams))&&(e.TransactionController.transactions=(0,n.keyBy)(e.TransactionController.transactions,(e=>(void 0!==e.id&&null!==e.id||(e.id=(0,a.default)()),e.id))));return e}(r),t}};r.default=o}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/057.js"}],[144,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:63,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=63;const r=function(e){var t,r,s,n,a,o,c,l;const d=null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.accountTokens,u=null==e||null===(r=e.PreferencesController)||void 0===r?void 0:r.accountHiddenTokens,h={};d&&Object.keys(d).forEach((e=>{Object.keys(d[e]).forEach((t=>{const r=d[e][t];h[t]===undefined?h[t]={[e]:r}:h[t]=i(i({},h[t]),{},{[e]:r})}))}));const p={};u&&Object.keys(u).forEach((e=>{Object.keys(u[e]).forEach((t=>{const r=u[e][t];p[t]===undefined?p[t]={[e]:r}:p[t]=i(i({},p[t]),{},{[e]:r})}))}));e.TokensController?(e.TokensController.allTokens=h,e.TokensController.allIgnoredTokens=p):e.TokensController={allTokens:h,allIgnoredTokens:p};return null==e||(null===(s=e.PreferencesController)||void 0===s||delete s.accountHiddenTokens),null==e||null===(n=e.PreferencesController)||void 0===n||delete n.accountTokens,null==e||null===(a=e.PreferencesController)||void 0===a||delete a.assetImages,null==e||null===(o=e.PreferencesController)||void 0===o||delete o.hiddenTokens,null==e||null===(c=e.PreferencesController)||void 0===c||delete c.tokens,null==e||null===(l=e.PreferencesController)||void 0===l||delete l.suggestedTokens,e}(t.data);return t.data=r,t}};r.default=c}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/063.js"}],[147,{"../../../shared/constants/hardware-wallets":6263,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=e("../../../shared/constants/hardware-wallets");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={version:66,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=66;const r=function(e){var t;const r=window.navigator.hid?o.LEDGER_TRANSPORT_TYPES.WEBHID:o.LEDGER_TRANSPORT_TYPES.U2F,s=Boolean(null===(t=e.PreferencesController)||void 0===t?void 0:t.useLedgerLive),n=c(c({},e),{},{PreferencesController:c(c({},null==e?void 0:e.PreferencesController),{},{ledgerTransportType:s?o.LEDGER_TRANSPORT_TYPES.LIVE:r})});return delete n.PreferencesController.useLedgerLive,n}(t.data);return t.data=r,t}};r.default=l}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/066.js"}],[148,{"../../../shared/constants/network":6266,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"bignumber.js":2036,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=s(e("bignumber.js")),i=e("../../../shared/constants/network");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const d=e=>new o.default(e||"0x0",16).gt(0);var u={version:67,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=67;const r=function(e){var t,r,s;const n=(null==e?void 0:e.PreferencesController)||{},a=n.preferences||{};if(a.showTestNetworks)return e;const o=(null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions)||{},c=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{},u=(null===(s=e.CachedBalancesController)||void 0===s?void 0:s.cachedBalances)||{},h=i.TEST_CHAINS.includes(null==c?void 0:c.chainId),p=Object.values(o).some((({chainId:e})=>i.TEST_CHAINS.includes(e))),f=i.TEST_CHAINS.some((e=>Object.values(u[e]||{}).some(d))),g=h||p||f;return l(l({},e),{},{PreferencesController:l(l({},n),{},{preferences:l(l({},a),{},{showTestNetworks:g})})})}(t.data);return t.data=r,t}};r.default=u}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/067.js"}],[149,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@babel/runtime/helpers/objectWithoutProperties":204,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("@babel/runtime/helpers/objectWithoutProperties")),o=e("lodash");const i=["PermissionsController","PermissionsMetadata"],c=["name","icon","extensionId"];function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={version:68,async migrate(e){const t=(0,o.cloneDeep)(e);t.meta.version=68;const r=function(e){const{PermissionsController:t={},PermissionsMetadata:r={}}=e,s=(0,a.default)(e,i),{domainMetadata:n={},permissionsHistory:o={},permissionsLog:c=[]}=r;return d(d({},s),{},{PermissionController:h(t),PermissionLogController:{permissionActivityLog:c,permissionHistory:o},SubjectMetadataController:p(n)})}(t.data);return t.data=r,t}};function h(e){const{domains:t={}}=e;return{subjects:Object.entries(t).reduce(((e,[t,r])=>{const{permissions:[s]}=r,n=s.caveats.find((e=>"exposedAccounts"===e.name)),a=d(d({},s),{},{caveats:[{type:"restrictReturnedAccounts",value:n.value}]});return delete a["@context"],e[t]={origin:t,permissions:{eth_accounts:a}},e}),{})}}function p(e){return{subjectMetadata:Object.entries(e).reduce(((e,[t,r])=>{const{name:s=null,icon:n=null,extensionId:o=null}=r,i=(0,a.default)(r,c);return delete i.lastUpdated,delete i.host,t&&(e[t]=d(d({name:s,iconUrl:n,extensionId:o},i),{},{origin:t})),e}),{})}}r.default=u}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/068.js"}],[99,{"../controllers/transactions/lib/tx-state-history-helpers":33,lodash:5250},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("lodash"),n=e("../controllers/transactions/lib/tx-state-history-helpers");var a={version:18,migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=18;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>{if(!e.history||0===e.history.length){const t=(0,n.snapshotFromTxMeta)(e);return e.history=[t],e}const t=(0,n.migrateFromSnapshotsToDiffs)(e.history).filter((e=>!Array.isArray(e)||e.length>0));return e.history=t,e}))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #18${e.stack}`)}return Promise.resolve(t)}};r.default=a}}},{package:"<root>",file:"/home/circleci/project/app/scripts/migrations/018.js"}],[2027,{"to-data-view":6019},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("to-data-view");t.exports=function(e,t,r){var n,a;switch(r=r||{},t){case"RFC3548":case"RFC4648":n="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",a=!0;break;case"RFC4648-HEX":n="0123456789ABCDEFGHIJKLMNOPQRSTUV",a=!0;break;case"Crockford":n="0123456789ABCDEFGHJKMNPQRSTVWXYZ",a=!1;break;default:throw new Error("Unknown base32 variant: "+t)}for(var o=r.padding!==undefined?r.padding:a,i=s(e),c=0,l=0,d="",u=0;u<i.byteLength;u++)for(l=l<<8|i.getUint8(u),c+=8;c>=5;)d+=n[l>>>c-5&31],c-=5;if(c>0&&(d+=n[l<<5-c&31]),o)for(;d.length%8!=0;)d+="=";return d}}}},{package:"base32-encode",file:"/home/circleci/project/node_modules/base32-encode/index.js"}],[53,{"./contracts/registry":51,"./contracts/resolver":52,"@babel/runtime/helpers/interopRequireDefault":195,"@ensdomains/content-hash":264,"eth-ens-namehash":2444,"ethjs-contract":2629,"ethjs-query":2646},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function({provider:e,name:t}){const r=new a.default(e),s=n.default.hash(t),u=new o.default(r),h=Number.parseInt(await r.net_version(),10),p=function(e){switch(e){case 1:case 3:case 4:case 5:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(h);if(!p)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${h}"`);const f=u(c.default).at(p),g=(await f.resolver(s))[0];if(d(g))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const m=u(l.default).at(g),b=await m.supportsInterface("0xbc1c58d1"),v=await m.supportsInterface("0xd8389dc5");if(b[0]){const e=(await m.contenthash(s))[0];let t=i.default.decode(e);const r=i.default.getCodec(e);return"ipfs-ns"!==r&&"ipns-ns"!==r||(t=i.default.helpers.cidV0ToV1Base32(t)),{type:r,hash:t}}if(v[0]){const e=(await m.content(s))[0];if(d(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var n=s(e("eth-ens-namehash")),a=s(e("ethjs-query")),o=s(e("ethjs-contract")),i=s(e("@ensdomains/content-hash")),c=s(e("./contracts/registry")),l=s(e("./contracts/resolver"));function d(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/ens-ipfs/resolver.js"}],[46,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){t.origin=e.origin,s()}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/createOriginMiddleware.js"}],[48,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){t.tabId=e.tabId,s()}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/createTabIdMiddleware.js"}],[5335,{},function(){with(this)return function(){"use strict";return function(e,t,r){for(var s=self.crypto||self.msCrypto,n="-_",a=36;a--;)n+=a.toString(36);for(a=36;a---10;)n+=a.toString(36).toUpperCase();t.exports=function(e){var t="",r=s.getRandomValues(new Uint8Array(e||21));for(a=e||21;a--;)t+=n[63&r[a]];return t}}}},{package:"nanoid",file:"/home/circleci/project/node_modules/nanoid/index.browser.js"}],[44,{"eth-rpc-errors":2531},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("eth-rpc-errors");var n=(e,t)=>async r=>{if(t._writableState.ended)return;if(!e[r.method])return void t.write({jsonrpc:"2.0",error:s.ethErrors.rpc.methodNotFound({message:`${r.method} not found`}),id:r.id});let n,a;try{n=await e[r.method](...r.params)}catch(e){a=e}t._writableState.ended?a&&console.error(a):a?t.write({jsonrpc:"2.0",error:(0,s.serializeError)(a,{shouldIncludeStack:!0}),id:r.id}):t.write({jsonrpc:"2.0",result:n,id:r.id})};r.default=n}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/createMetaRPCHandler.js"}],[4807,{"readable-stream":5778},function(){with(this)return function(){"use strict";return function(e,t,r){const s=e("readable-stream").Duplex;t.exports=function({engine:e}){if(!e)throw new Error("Missing engine parameter!");const t=new s({objectMode:!0,read:function(){return!1},write:function(t,r,s){e.handle(t,((e,t)=>{this.push(t)})),s()}});e.on&&e.on("notification",(e=>{t.push(e)}));return t}}}},{package:"json-rpc-middleware-stream",file:"/home/circleci/project/node_modules/json-rpc-middleware-stream/engineStream.js"}],[39,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/controllers":1042,"@metamask/obs-store":1193},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=e("@metamask/controllers");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class l extends a.ObservableStore{constructor({config:e,controllerMessenger:t,state:r,persist:s}){super(r),(0,n.default)(this,"config",{}),this.persist=s,this.controllerMessenger=t,e&&this.updateStructure(e)}updateStructure(e){this.config=e,this.removeAllListeners();for(const t of Object.keys(e)){if(!e[t])throw new Error(`Undefined '${t}'`);const r=e[t];r.subscribe?e[t].subscribe((e=>{this.updateState({[t]:e})})):this.controllerMessenger.subscribe(`${r.name}:stateChange`,(r=>{let s=r;this.persist&&(s=(0,o.getPersistentState)(r,e[t].metadata)),this.updateState({[t]:s})}))}}getFlatState(){if(!this.config)return{};let e={};for(const t of Object.keys(this.config)){const r=this.config[t],s=r.getState?r.getState():r.state;e=c(c({},e),s)}return e}}r.default=l}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/ComposableObservableStore.js"}],[43,{"@babel/runtime/helpers/interopRequireDefault":195,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,s){s((s=>{r.error&&n.default.error("Error in RPC response:\n",r),t.isMetamaskInternal||(n.default.info(`RPC (${e.origin}):`,t,"->",r),s())}))}};var n=s(e("loglevel"))}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/createLoggerMiddleware.js"}],[45,{"@babel/runtime/helpers/interopRequireDefault":195,extensionizer:2663,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({location:e,registerOnboarding:t}){return async function(r,s,o,i){try{if("wallet_registerOnboarding"!==r.method)return void o();r.tabId&&r.tabId!==a.default.tabs.TAB_ID_NONE?await t(e,r.tabId):n.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),s.result=!0,i()}catch(e){i(e)}}};var n=s(e("loglevel")),a=s(e("extensionizer"))}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/createOnboardingMiddleware.js"}],[29,{"../../../shared/constants/hardware-wallets":6263,"../../../shared/constants/network":6266,"../../../shared/modules/network.utils":6277,"./network":17,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,assert:1776,"eth-sig-util":2533,ethers:2621,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("assert"),o=e("@metamask/obs-store"),i=e("eth-sig-util"),c=e("ethers"),l=s(e("loglevel")),d=e("../../../shared/constants/network"),u=e("../../../shared/modules/network.utils"),h=e("../../../shared/constants/hardware-wallets"),p=e("./network");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){const t=g({frequentRpcListDetail:[],useBlockie:!1,useNonceField:!1,usePhishDetect:!0,dismissSeedBackUpReminder:!1,useTokenDetection:!1,useCollectibleDetection:!1,openSeaEnabled:!1,advancedGasFee:null,featureFlags:{showIncomingTransactions:!0},knownMethodData:{},currentLocale:e.initLangCode,identities:{},lostIdentities:{},forgottenPassword:!1,preferences:{autoLockTimeLimit:undefined,showFiatInTestnets:!1,showTestNetworks:!1,useNativeCurrencyAsPrimaryCurrency:!0,hideZeroBalanceTokens:!1},ipfsGateway:d.IPFS_DEFAULT_GATEWAY_URL,infuraBlocked:null,ledgerTransportType:window.navigator.hid?h.LEDGER_TRANSPORT_TYPES.WEBHID:h.LEDGER_TRANSPORT_TYPES.U2F,theme:"default"},e.initState);this.network=e.network,this.ethersProvider=new c.ethers.providers.Web3Provider(e.provider),this.store=new o.ObservableStore(t),this.store.setMaxListeners(12),this.openPopup=e.openPopup,this.migrateAddressBookState=e.migrateAddressBookState,this._subscribeToInfuraAvailability(),global.setPreference=(e,t)=>this.setFeatureFlag(e,t)}setPasswordForgotten(e){this.store.updateState({forgottenPassword:e})}setUseBlockie(e){this.store.updateState({useBlockie:e})}setUseNonceField(e){this.store.updateState({useNonceField:e})}setUsePhishDetect(e){this.store.updateState({usePhishDetect:e})}setUseTokenDetection(e){this.store.updateState({useTokenDetection:e})}setUseCollectibleDetection(e){this.store.updateState({useCollectibleDetection:e})}setOpenSeaEnabled(e){this.store.updateState({openSeaEnabled:e})}setAdvancedGasFee(e){this.store.updateState({advancedGasFee:e})}setEIP1559V2Enabled(e){this.store.updateState({eip1559V2Enabled:e})}setTheme(e){this.store.updateState({theme:e})}addKnownMethodData(e,t){const{knownMethodData:r}=this.store.getState();r[e]=t,this.store.updateState({knownMethodData:r})}setCurrentLocale(e){const t=["ar","dv","fa","he","ku"].includes(e)?"rtl":"auto";return this.store.updateState({currentLocale:e,textDirection:t}),t}setAddresses(e){const t=this.store.getState().identities,r=e.reduce(((e,r,s)=>{const n=t[r]||{};return e[r]=g({name:`Account ${s+1}`,address:r},n),e}),{});this.store.updateState({identities:r})}removeAddress(e){const{identities:t}=this.store.getState();if(!t[e])throw new Error(`${e} can't be deleted cause it was not found`);if(delete t[e],this.store.updateState({identities:t}),e===this.getSelectedAddress()){const e=Object.keys(t)[0];this.setSelectedAddress(e)}return e}addAddresses(e){const{identities:t}=this.store.getState();e.forEach((e=>{if(t[e])return;const r=Object.keys(t).length;t[e]={name:`Account ${r+1}`,address:e}})),this.store.updateState({identities:t})}syncAddresses(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array of addresses. Error #11201");const{identities:t,lostIdentities:r}=this.store.getState(),s={};Object.keys(t).forEach((r=>{e.includes(r)||(s[r]=t[r],delete t[r])})),Object.keys(s).length>0&&Object.keys(s).forEach((e=>{r[e]=s[e]})),this.store.updateState({identities:t,lostIdentities:r}),this.addAddresses(e);let n=this.getSelectedAddress();return e.includes(n)||(n=e[0],this.setSelectedAddress(n)),n}setSelectedAddress(e){const t=(0,i.normalize)(e),{identities:r}=this.store.getState(),s=r[t];if(!s)throw new Error(`Identity for '${t} not found`);s.lastSelected=Date.now(),this.store.updateState({identities:r,selectedAddress:t})}getSelectedAddress(){return this.store.getState().selectedAddress}setAccountLabel(e,t){if(!e)throw new Error(`setAccountLabel requires a valid address, got ${String(e)}`);const r=(0,i.normalize)(e),{identities:s}=this.store.getState();return s[r]=s[r]||{},s[r].name=t,this.store.updateState({identities:s}),Promise.resolve(t)}async updateRpc(e){const t=this.getFrequentRpcListDetail(),r=t.findIndex((t=>t.rpcUrl===e.rpcUrl));if(r>-1){const s=t[r],n=g(g({},s),e);if(s.chainId!==n.chainId){let r=s.chainId;if(!r)try{r=await this.ethersProvider.send("net_version"),(0,a.strict)("string"==typeof r)}catch(e){l.default.debug(e),l.default.warn(`Failed to get networkId from ${s.rpcUrl}; skipping address book migration`)}let o=!1;const i=Object.values(d.NETWORK_TYPE_TO_ID_MAP).map((e=>e.networkId)),c=t.filter((t=>t.rpcUrl!==e.rpcUrl));(i.includes(r)||c.some((e=>e.chainId===r)))&&(o=!0),this.migrateAddressBookState(r,n.chainId,o)}t[r]=n,this.store.updateState({frequentRpcListDetail:t})}else{const{rpcUrl:t,chainId:r,ticker:s,nickname:n,rpcPrefs:a={}}=e;this.addToFrequentRpcList(t,r,s,n,a)}}addToFrequentRpcList(e,t,r="ETH",s="",n={}){const a=this.getFrequentRpcListDetail(),o=a.findIndex((t=>t.rpcUrl===e));if(-1!==o&&a.splice(o,1),!(0,u.isPrefixedFormattedHexString)(t))throw new Error(`Invalid chainId: "${t}"`);a.push({rpcUrl:e,chainId:t,ticker:r,nickname:s,rpcPrefs:n}),this.store.updateState({frequentRpcListDetail:a})}removeFromFrequentRpcList(e){const t=this.getFrequentRpcListDetail(),r=t.findIndex((t=>t.rpcUrl===e));return-1!==r&&t.splice(r,1),this.store.updateState({frequentRpcListDetail:t}),Promise.resolve(t)}getFrequentRpcListDetail(){return this.store.getState().frequentRpcListDetail}setFeatureFlag(e,t){const r=g(g({},this.store.getState().featureFlags),{},{[e]:t});return this.store.updateState({featureFlags:r}),Promise.resolve(r)}setPreference(e,t){const r=g(g({},this.getPreferences()),{},{[e]:t});return this.store.updateState({preferences:r}),Promise.resolve(r)}getPreferences(){return this.store.getState().preferences}getIpfsGateway(){return this.store.getState().ipfsGateway}setIpfsGateway(e){return this.store.updateState({ipfsGateway:e}),Promise.resolve(e)}setLedgerTransportPreference(e){return this.store.updateState({ledgerTransportType:e}),e}getLedgerTransportPreference(){return this.store.getState().ledgerTransportType}async setDismissSeedBackUpReminder(e){await this.store.updateState({dismissSeedBackUpReminder:e})}_subscribeToInfuraAvailability(){this.network.on(p.NETWORK_EVENTS.INFURA_IS_BLOCKED,(()=>{this._setInfuraBlocked(!0)})),this.network.on(p.NETWORK_EVENTS.INFURA_IS_UNBLOCKED,(()=>{this._setInfuraBlocked(!1)}))}_setInfuraBlocked(e){const{infuraBlocked:t}=this.store.getState();t!==e&&this.store.updateState({infuraBlocked:e})}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/preferences.js"}],[7,{"../../../shared/constants/time":6269,"../metamask-controller":82,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,events:2158},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("events")),o=e("@metamask/obs-store"),i=e("../metamask-controller"),c=e("../../../shared/constants/time");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class u extends a.default{constructor(e={}){const{addUnlockListener:t,isUnlocked:r,initState:s,onInactiveTimeout:n,showUnlockRequest:a,preferencesStore:i,qrHardwareStore:c}=e;super(),this.onInactiveTimeout=n||(()=>undefined),this.store=new o.ObservableStore(d(d({timeoutMinutes:0,connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,browserEnvironment:{},popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[],recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),collectiblesDetectionNoticeDismissed:!1,enableEIP1559V2NoticeDismissed:!1,showTestnetMessageInDropdown:!0,trezorModel:null},s),{},{qrHardware:{},collectiblesDropdownState:{}})),this.timer=null,this.isUnlocked=r,this.waitingForUnlock=[],t(this.handleUnlock.bind(this)),this._showUnlockRequest=a,i.subscribe((({preferences:e})=>{this.store.getState().timeoutMinutes!==e.autoLockTimeLimit&&this._setInactiveTimeout(e.autoLockTimeLimit)})),c.subscribe((e=>{this.store.updateState({qrHardware:e})}));const{preferences:l}=i.getState();this._setInactiveTimeout(l.autoLockTimeLimit)}getUnlockPromise(e){return new Promise((t=>{this.isUnlocked()?t():this.waitForUnlock(t,e)}))}waitForUnlock(e,t){this.waitingForUnlock.push({resolve:e}),this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE),t&&this._showUnlockRequest()}handleUnlock(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;)this.waitingForUnlock.shift().resolve();this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}setDefaultHomeActiveTabName(e){this.store.updateState({defaultHomeActiveTabName:e})}setConnectedStatusPopoverHasBeenShown(){this.store.updateState({connectedStatusPopoverHasBeenShown:!0})}setRecoveryPhraseReminderHasBeenShown(){this.store.updateState({recoveryPhraseReminderHasBeenShown:!0})}setRecoveryPhraseReminderLastShown(e){this.store.updateState({recoveryPhraseReminderLastShown:e})}setLastActiveTime(){this._resetTimer()}_setInactiveTimeout(e){this.store.updateState({timeoutMinutes:e}),this._resetTimer()}_resetTimer(){const{timeoutMinutes:e}=this.store.getState();this.timer&&clearTimeout(this.timer),e&&(this.timer=setTimeout((()=>this.onInactiveTimeout()),e*c.MINUTE))}setBrowserEnvironment(e,t){this.store.updateState({browserEnvironment:{os:e,browser:t}})}addPollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:[...r,e]})}removePollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:r.filter((t=>t!==e))})}clearPollingTokens(){this.store.updateState({popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[]})}setShowTestnetMessageInDropdown(e){this.store.updateState({showTestnetMessageInDropdown:e})}setTrezorModel(e){this.store.updateState({trezorModel:e})}setCollectiblesDetectionNoticeDismissed(e){this.store.updateState({collectiblesDetectionNoticeDismissed:e})}setEnableEIP1559V2NoticeDismissed(e){this.store.updateState({enableEIP1559V2NoticeDismissed:e})}updateCollectibleDropDownState(e){this.store.updateState({collectiblesDropdownState:e})}}r.default=u}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/app-state.js"}],[8,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){const{accountTracker:t,getCurrentChainId:r}=e;this.accountTracker=t,this.getCurrentChainId=r;const s=i({cachedBalances:{}},e.initState);this.store=new a.ObservableStore(s),this._registerUpdates()}async updateCachedBalances({accounts:e}){const t=this.getCurrentChainId(),r=await this._generateBalancesToCache(e,t);this.store.updateState({cachedBalances:r})}_generateBalancesToCache(e,t){const{cachedBalances:r}=this.store.getState(),s=i({},r[t]);Object.keys(e).forEach((t=>{const r=e[t];r.balance&&(s[t]=r.balance)}));return i(i({},r),{},{[t]:s})}clearCachedBalances(){this.store.updateState({cachedBalances:{}})}_registerUpdates(){const e=this.updateCachedBalances.bind(this);this.accountTracker.store.subscribe(e)}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/cached-balances.js"}],[6,{"../../../shared/constants/alerts":6260,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=e("../../../shared/constants/alerts");function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const l={alertEnabledness:o.TOGGLEABLE_ALERT_TYPES.reduce(((e,t)=>(e[t]=!0,e)),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}};r.default=class{constructor(e={}){const{initState:t={},preferencesStore:r}=e,s=c(c({},l),{},{alertEnabledness:c(c({},l.alertEnabledness),t.alertEnabledness)});this.store=new a.ObservableStore(s),this.selectedAddress=r.getState().selectedAddress,r.subscribe((({selectedAddress:e})=>{this.store.getState().unconnectedAccountAlertShownOrigins&&this.selectedAddress!==e&&(this.selectedAddress=e,this.store.updateState({unconnectedAccountAlertShownOrigins:{}}))}))}setAlertEnabledness(e,t){let{alertEnabledness:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({alertEnabledness:r})}setUnconnectedAccountAlertShown(e){let{unconnectedAccountAlertShownOrigins:t}=this.store.getState();t=c({},t),t[e]=!0,this.store.updateState({unconnectedAccountAlertShownOrigins:t})}getWeb3ShimUsageState(e){return this.store.getState().web3ShimUsageOrigins[e]}setWeb3ShimUsageRecorded(e){this._setWeb3ShimUsageState(e,o.WEB3_SHIM_USAGE_ALERT_STATES.RECORDED)}setWeb3ShimUsageAlertDismissed(e){this._setWeb3ShimUsageState(e,o.WEB3_SHIM_USAGE_ALERT_STATES.DISMISSED)}_setWeb3ShimUsageState(e,t){let{web3ShimUsageOrigins:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({web3ShimUsageOrigins:r})}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/alert.js"}],[21,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=s(e("loglevel"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){(0,n.default)(this,"registerOnboarding",(async(e,t)=>{if(this.store.getState().completedOnboarding)return void o.default.debug("Ignoring registerOnboarding; user already onboarded");const r=c({},this.store.getState().onboardingTabs);r[e]&&r[e]===t||(o.default.debug(`Registering onboarding tab at location '${e}' with tabId '${t}'`),r[e]=t,this.store.updateState({onboardingTabs:r}))}));const t=c(c({seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1},e.initState),{onboardingTabs:{}});this.store=new a.ObservableStore(t)}setSeedPhraseBackedUp(e){this.store.updateState({seedPhraseBackedUp:e})}completeOnboarding(){return this.store.updateState({completedOnboarding:!0}),Promise.resolve(!0)}setFirstTimeFlowType(e){this.store.updateState({firstTimeFlowType:e})}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/onboarding.js"}],[59,{"../../../shared/constants/app":6261,"../../../shared/modules/random-id":6278,"../metamask-controller":82,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,buffer:2157,"eth-rpc-errors":2531,"ethereumjs-util":2597,events:2158},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,r.normalizeMsgData=h;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),d=s(e("../../../shared/modules/random-id"));class u extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new a.ObservableStore({unapprovedMsgs:{},unapprovedMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}async addUnapprovedMessageAsync(e,t){const r=this.addUnapprovedMessage(e,t);return await new Promise(((t,s)=>{this.once(`${r}:finished`,(r=>{switch(r.status){case"signed":return t(r.rawSig);case"rejected":return s(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return s(new Error(`MetaMask Message Signature: ${r.error}`));default:return s(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){t&&(e.origin=t.origin),e.data=h(e.data);const r=(new Date).getTime(),s=(0,d.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_SIGN};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`MessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedMsgs:e,unapprovedMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}function h(e){return"0x"===e.slice(0,2)?e:(0,o.bufferToHex)(t.from(e,"utf8"))}r.default=u}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/message-manager.js"}],[12,{"../../../shared/constants/network":6266,"../../../shared/constants/time":6269,"../../../shared/constants/transaction":6270,"../../../shared/modules/fetch-with-timeout":6274,"../../../shared/modules/random-id":6278,"../lib/util":81,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,"bn.js":2113,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=s(e("loglevel")),i=s(e("bn.js")),c=s(e("../../../shared/modules/random-id")),l=e("../lib/util"),d=s(e("../../../shared/modules/fetch-with-timeout")),u=e("../../../shared/constants/transaction"),h=e("../../../shared/constants/network"),p=e("../../../shared/constants/time");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const m=(0,d.default)(30*p.SECOND),b=[h.GOERLI_CHAIN_ID,h.KOVAN_CHAIN_ID,h.MAINNET_CHAIN_ID,h.RINKEBY_CHAIN_ID,h.ROPSTEN_CHAIN_ID];function v(e,t){let r,s=!0;return n=>{try{return s?(s=!1,e(null!=t?t:n,n)):e(r,n)}finally{r=n}}}r.default=class{constructor(e={}){const{blockTracker:t,onNetworkDidChange:r,getCurrentChainId:s,preferencesController:n}=e;this.blockTracker=t,this.getCurrentChainId=s,this.preferencesController=n,this._onLatestBlock=async e=>{const t=this.preferencesController.getSelectedAddress(),r=parseInt(e,16);await this._update(t,r)};const o=g({incomingTransactions:{},incomingTxLastFetchedBlockByChainId:{[h.GOERLI_CHAIN_ID]:null,[h.KOVAN_CHAIN_ID]:null,[h.MAINNET_CHAIN_ID]:null,[h.RINKEBY_CHAIN_ID]:null,[h.ROPSTEN_CHAIN_ID]:null}},e.initState);this.store=new a.ObservableStore(o),this.preferencesController.store.subscribe(v(((e,t)=>{const{featureFlags:{showIncomingTransactions:r}={}}=e,{featureFlags:{showIncomingTransactions:s}={}}=t;s!==r&&(!r||s?this.start():this.stop())}),this.preferencesController.store.getState())),this.preferencesController.store.subscribe(v((async(e,t)=>{const{selectedAddress:r}=e,{selectedAddress:s}=t;s!==r&&await this._update(s)}),this.preferencesController.store.getState())),r((async()=>{const e=this.preferencesController.getSelectedAddress();await this._update(e)}))}start(){const{featureFlags:e={}}=this.preferencesController.store.getState(),{showIncomingTransactions:t}=e;t&&(this.blockTracker.removeListener("latest",this._onLatestBlock),this.blockTracker.addListener("latest",this._onLatestBlock))}stop(){this.blockTracker.removeListener("latest",this._onLatestBlock)}async _update(e,t){const r=this.getCurrentChainId();if(b.includes(r)&&e)try{var s;const n=this.store.getState(),a=parseInt(this.blockTracker.getCurrentBlock(),16),o=n.incomingTxLastFetchedBlockByChainId[r],i=null!==(s=null!=o?o:t)&&void 0!==s?s:a,c=await this._getNewIncomingTransactions(e,i,r);let l=i;c.forEach((e=>{e.blockNumber&&parseInt(l,10)<parseInt(e.blockNumber,10)&&(l=parseInt(e.blockNumber,10))})),this.store.updateState({incomingTxLastFetchedBlockByChainId:g(g({},n.incomingTxLastFetchedBlockByChainId),{},{[r]:l+1}),incomingTransactions:c.reduce(((e,t)=>(e[t.hash]=t,e)),g({},n.incomingTransactions))})}catch(e){o.default.error(e)}}async _getNewIncomingTransactions(e,t,r){let s=`${`https://${r===h.MAINNET_CHAIN_ID?"api":`api-${h.CHAIN_ID_TO_TYPE_MAP[r]}`}.etherscan.io`}/api?module=account&action=txlist&address=${e}&tag=latest&page=1`;t&&(s+=`&startBlock=${parseInt(t,10)}`);const n=await m(s),{status:a,result:o}=await n.json();let i=[];if("1"===a&&Array.isArray(o)&&o.length>0){const t={},s=[];o.forEach((e=>{t[e.hash]||(s.push(this._normalizeTxFromEtherscan(e,r)),t[e.hash]=1)})),i=s.filter((t=>{var r,s;return(null===(r=t.txParams)||void 0===r||null===(s=r.to)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()})),i.sort(((e,t)=>e.time<t.time?-1:1))}return i}_normalizeTxFromEtherscan(e,t){const r=1e3*parseInt(e.timeStamp,10),s="0"===e.isError?u.TRANSACTION_STATUSES.CONFIRMED:u.TRANSACTION_STATUSES.FAILED,n={from:e.from,gas:(0,l.bnToHex)(new i.default(e.gas)),nonce:(0,l.bnToHex)(new i.default(e.nonce)),to:e.to,value:(0,l.bnToHex)(new i.default(e.value))};return e.gasPrice?n.gasPrice=(0,l.bnToHex)(new i.default(e.gasPrice)):e.maxFeePerGas&&(n.maxFeePerGas=(0,l.bnToHex)(new i.default(e.maxFeePerGas)),n.maxPriorityFeePerGas=(0,l.bnToHex)(new i.default(e.maxPriorityFeePerGas))),{blockNumber:e.blockNumber,id:(0,c.default)(),chainId:t,metamaskNetworkId:h.CHAIN_ID_TO_NETWORK_ID_MAP[t],status:s,time:r,txParams:n,hash:e.hash,type:u.TRANSACTION_TYPES.INCOMING}}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/incoming-transactions.js"}],[49,{"../../../shared/constants/app":6261,"../../../shared/modules/random-id":6278,"../metamask-controller":82,"./util":81,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,buffer:2157,"eth-rpc-errors":2531,"ethereumjs-util":2597,events:2158,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=s(e("loglevel")),l=e("../../../shared/constants/app"),d=e("../metamask-controller"),u=s(e("../../../shared/modules/random-id")),h=e("./util");const p=/^[0-9A-Fa-f]+$/gu;class f extends n.default{constructor(e){super(),this.memStore=new a.ObservableStore({unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0}),this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedDecryptMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e.from)return void s(new Error("MetaMask Decryption: from field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"decrypted":return void r(t.rawData);case"rejected":return void s(i.ethErrors.provider.userRejectedRequest("MetaMask Decryption: User denied message decryption."));case"errored":return void s(new Error("This message cannot be decrypted"));default:s(new Error(`MetaMask Decryption: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){c.default.debug(`DecryptMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),s=(0,u.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:l.MESSAGE_TYPE.ETH_DECRYPT};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForDecryption(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusDecrypted(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"decrypted")}prepMsgForDecryption(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:"Messages",properties:{action:"Decrypt Message Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`DecryptMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"decrypted"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedDecryptMsgs:e,unapprovedDecryptMsgCount:t}),this.emit(d.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,o.stripHexPrefix)(e);if(t.match(p))return(0,h.addHexPrefix)(t)}catch(e){c.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,o.bufferToHex)(t.from(e,"utf8"))}}r.default=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/decrypt-message-manager.js"}],[64,{"../../../shared/constants/app":6261,"../../../shared/modules/random-id":6278,"../metamask-controller":82,"./util":81,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,buffer:2157,"eth-rpc-errors":2531,"ethereumjs-util":2597,events:2158,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),c=s(e("loglevel")),l=e("../../../shared/constants/app"),d=e("../metamask-controller"),u=s(e("../../../shared/modules/random-id")),h=e("./util");const p=/^[0-9A-Fa-f]+$/gu;class f extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new a.ObservableStore({unapprovedPersonalMsgs:{},unapprovedPersonalMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedPersonalMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e.from)return void s(new Error("MetaMask Message Signature: from field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"signed":return void r(t.rawSig);case"rejected":return void s(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return void s(new Error(`MetaMask Message Signature: ${t.error}`));default:s(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){c.default.debug(`PersonalMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),s=(0,u.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:l.MESSAGE_TYPE.PERSONAL_SIGN};return this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`PersonalMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedPersonalMsgs:e,unapprovedPersonalMsgCount:t}),this.emit(d.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,o.stripHexPrefix)(e);if(t.match(p))return(0,h.addHexPrefix)(t)}catch(e){c.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,o.bufferToHex)(t.from(e,"utf8"))}}r.default=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/personal-message-manager.js"}],[50,{"../../../shared/constants/app":6261,"../../../shared/modules/random-id":6278,"../metamask-controller":82,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,"eth-rpc-errors":2531,events:2158,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("@metamask/obs-store"),o=e("eth-rpc-errors"),i=s(e("loglevel")),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),d=s(e("../../../shared/modules/random-id"));class u extends n.default{constructor(e){super(),this.memStore=new a.ObservableStore({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}),this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedEncryptionPublicKeyMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,s)=>{if(!e)return void s(new Error("MetaMask Message: address field is required."));const n=this.addUnapprovedMessage(e,t);this.once(`${n}:finished`,(t=>{switch(t.status){case"received":return void r(t.rawData);case"rejected":return void s(o.ethErrors.provider.userRejectedRequest("MetaMask EncryptionPublicKey: User denied message EncryptionPublicKey."));default:s(new Error(`MetaMask EncryptionPublicKey: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){i.default.debug("EncryptionPublicKeyManager addUnapprovedMessage: address");const r=(new Date).getTime(),s=(0,d.default)(),n={id:s,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY};return t&&(n.origin=t.origin),this.addMsg(n),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForEncryptionPublicKey(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusReceived(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"received")}prepMsgForEncryptionPublicKey(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:"Messages",properties:{action:"Encryption public key Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`EncryptionPublicKeyManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"received"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedEncryptionPublicKeyMsgs:e,unapprovedEncryptionPublicKeyMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=u}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/encryption-public-key-manager.js"}],[9,{"../../../shared/constants/network":6266,"../../../shared/constants/time":6269,"../../../shared/modules/string-utils":6280,"../constants/contracts":4,"@babel/runtime/helpers/interopRequireDefault":195,loglevel:5260,"single-call-balance-checker-abi":5914,web3:6186},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("web3")),a=e("loglevel"),o=s(e("single-call-balance-checker-abi")),i=e("../constants/contracts"),c=e("../../../shared/constants/time"),l=e("../../../shared/constants/network"),d=e("../../../shared/modules/string-utils");const u=3*c.MINUTE;r.default=class{constructor({interval:e=u,preferences:t,network:r,keyringMemStore:s,tokenList:n,tokensController:a}={}){var o,i,c;this.tokensController=a,this.preferences=t,this.interval=e,this.network=r,this.keyringMemStore=s,this.tokenList=n,this.selectedAddress=null===(o=this.preferences)||void 0===o?void 0:o.store.getState().selectedAddress,this.tokenAddresses=null===(i=this.tokensController)||void 0===i?void 0:i.state.tokens.map((e=>e.address)),this.hiddenTokens=null===(c=this.tokensController)||void 0===c?void 0:c.state.ignoredTokens,null==t||t.store.subscribe((({selectedAddress:e,useTokenDetection:t})=>{this.selectedAddress===e&&this.useTokenDetection===t||(this.selectedAddress=e,this.useTokenDetection=t,this.restartTokenDetection())})),null==a||a.subscribe((({tokens:e=[],ignoredTokens:t=[]})=>{this.tokenAddresses=e.map((e=>e.address)),this.hiddenTokens=t}))}async _getTokenBalances(e){const t=this.web3.eth.contract(o.default).at(i.SINGLE_CALL_BALANCES_ADDRESS);return new Promise(((r,s)=>{t.balances([this.selectedAddress],e,((e,t)=>e?s(e):r(t)))}))}async detectNewTokens(){if(!this.isActive)return;const{tokenList:e}=this._tokenList.state;if(this._network.store.getState().provider.chainId!==l.MAINNET_CHAIN_ID||0===Object.keys(e).length)return;const t=[];this.web3.setProvider(this._network._provider);for(const r in e)this.tokenAddresses.find((e=>(0,d.isEqualCaseInsensitive)(e,r)))||this.hiddenTokens.find((e=>(0,d.isEqualCaseInsensitive)(e,r)))||t.push(r);const r=[t.slice(0,1e3),t.slice(1e3,t.length-1)];for(const t of r){let r;try{r=await this._getTokenBalances(t)}catch(e){return void(0,a.warn)("MetaMask - DetectTokensController single call balance fetch failed",e)}const s=t.filter(((e,t)=>{const s=r[t];return s&&!s.isZero()}));await Promise.all(s.map((t=>this.tokensController.addToken(t,e[t].symbol,e[t].decimals))))}}restartTokenDetection(){this.isActive&&this.selectedAddress&&(this.detectNewTokens(),this.interval=u)}set interval(e){this._handle&&clearInterval(this._handle),e&&(this._handle=setInterval((()=>{this.detectNewTokens()}),e))}set network(e){e&&(this._network=e,this.web3=new n.default(e._provider))}set keyringMemStore(e){e&&(this._keyringMemStore=e,this._keyringMemStore.subscribe((({isUnlocked:e})=>{this.isUnlocked!==e&&(this.isUnlocked=e,e&&this.restartTokenDetection())})))}set tokenList(e){e&&(this._tokenList=e)}get isActive(){return this.isOpen&&this.isUnlocked}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/detect-tokens.js"}],[76,{"@babel/runtime/helpers/interopRequireDefault":195,"eth-keyring-controller":2518,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("eth-keyring-controller")),a=s(e("loglevel"));var o={async verifyAccounts(e,t){if(!e||e.length<1)throw new Error("No created accounts defined.");const r=new(new n.default({}).getKeyringClassForType("HD Key Tree"))({mnemonic:t,numberOfAccounts:e.length}),s=await r.getAccounts();if(a.default.debug(`Created accounts: ${JSON.stringify(e)}`),a.default.debug(`Restored accounts: ${JSON.stringify(s)}`),s.length!==e.length)throw new Error("Wrong number of accounts");for(let t=0;t<s.length;t++)if(s[t].toLowerCase()!==e[t].toLowerCase())throw new Error(`Not identical accounts! Original: ${e[t]}, Restored: ${s[t]}`)}};r.default=o}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/seed-phrase-verifier.js"}],[13,{"../../../shared/constants/app":6261,"../../../shared/constants/metametrics":6265,"../../../shared/constants/time":6269,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,buffer:2157,"ethereumjs-util":2597,lodash:5250,pubnub:5526},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),o=e("@metamask/obs-store"),i=e("ethereumjs-util"),c=e("pubnub"),l=e("../../../shared/constants/app"),d=e("../../../shared/constants/metametrics"),u=e("../../../shared/constants/time");function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const f=e=>{setTimeout((()=>{throw e}))},g={'You must pass either an "anonymousId" or a "userId".':!0};r.default=class{constructor({segment:e,preferencesStore:t,onNetworkDidChange:r,getCurrentChainId:s,getNetworkIdentifier:n,version:i,environment:c,initState:l,captureException:d=f}){this._captureException=e=>{g[e.message]||d(e)};const h=t.getState();this.chainId=s(),this.network=n(),this.locale=h.currentLocale.replace("_","-"),this.version="production"===c?i:`${i}-${c}`;const m=(0,a.omitBy)(null==l?void 0:l.fragments,"persist");this.store=new o.ObservableStore(p(p({participateInMetaMetrics:null,metaMetricsId:null},l),{},{fragments:p({},null==l?void 0:l.fragments)})),t.subscribe((({currentLocale:e})=>{this.locale=e.replace("_","-")})),r((()=>{this.chainId=s(),this.network=n()})),this.segment=e,Object.values(m).forEach((e=>{this.finalizeEventFragment(e.id,{abandoned:!0})})),setInterval((()=>{Object.values(this.store.getState().fragments).forEach((e=>{e.timeout&&Date.now()-e.lastUpdated/1e3>e.timeout&&this.finalizeEventFragment(e.id,{abandoned:!0})}))}),30*u.SECOND)}generateMetaMetricsId(){return(0,i.bufferToHex)((0,i.keccak)(t.from(String(Date.now())+String(Math.round(Math.random()*Number.MAX_SAFE_INTEGER)))))}createEventFragment(e){var t;if(!e.successEvent||!e.category)throw new Error(`Must specify success event and category. Success event was: ${e.event}. Category was: ${e.category}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`);const{fragments:r}=this.store.getState(),s=null!==(t=e.uniqueIdentifier)&&void 0!==t?t:(0,c.generateUUID)(),n=p(p({id:s},e),{},{lastUpdated:Date.now()});return this.store.updateState({fragments:p(p({},r),{},{[s]:n})}),e.initialEvent&&this.trackEvent({event:n.initialEvent,category:n.category,properties:n.properties,sensitiveProperties:n.sensitiveProperties,page:n.page,referrer:n.referrer,revenue:n.revenue,value:n.value,currency:n.currency,environmentType:n.environmentType}),n}getEventFragmentById(e){const{fragments:t}=this.store.getState();return t[e]}updateEventFragment(e,t){const{fragments:r}=this.store.getState();if(!r[e])throw new Error(`Event fragment with id ${e} does not exist.`);this.store.updateState({fragments:p(p({},r),{},{[e]:(0,a.merge)(r[e],p(p({},t),{},{lastUpdated:Date.now()}))})})}finalizeEventFragment(e,{abandoned:t=!1,page:r,referrer:s}={}){var n;const a=this.store.getState().fragments[e];if(!a)throw new Error(`Funnel with id ${e} does not exist.`);const o=t?a.failureEvent:a.successEvent;this.trackEvent({event:o,category:a.category,properties:a.properties,sensitiveProperties:a.sensitiveProperties,page:null!=r?r:a.page,referrer:null!==(n=a.referrer)&&void 0!==n?n:s,revenue:a.revenue,value:a.value,currency:a.currency,environmentType:a.environmentType});const{fragments:i}=this.store.getState();delete i[e],this.store.updateState({fragments:i})}setParticipateInMetaMetrics(e){let{metaMetricsId:t}=this.state;return e&&!t?t=this.generateMetaMetricsId():!1===e&&(t=null),this.store.updateState({participateInMetaMetrics:e,metaMetricsId:t}),t}get state(){return this.store.getState()}_buildContext(e,t=d.METAMETRICS_BACKGROUND_PAGE_OBJECT){return{app:{name:"MetaMask Extension",version:this.version},userAgent:window.navigator.userAgent,page:t,referrer:e}}_buildEventPayload(e){var t,r;const{event:s,properties:n,revenue:o,value:i,currency:c,category:d,page:u,referrer:h,environmentType:f=l.ENVIRONMENT_TYPE_BACKGROUND}=e;return{event:s,properties:p(p({},(0,a.omit)(n,["revenue","locale","currency","value"])),{},{revenue:o,value:i,currency:c,category:d,network:null!==(t=null==n?void 0:n.network)&&void 0!==t?t:this.network,locale:this.locale,chain_id:null!==(r=null==n?void 0:n.chain_id)&&void 0!==r?r:this.chainId,environment_type:f}),context:this._buildContext(h,u)}}_track(e,t){var r;const{isOptIn:s,metaMetricsId:n,matomoEvent:a,flushImmediately:o}=t||{};let i="userId",c=this.state.metaMetricsId,l=null!==(r=null==t?void 0:t.excludeMetaMetricsId)&&void 0!==r&&r;return Boolean(e.event.match(/^send|^confirm/iu))&&(l=!0),l||s&&!n?(i="anonymousId",c=d.METAMETRICS_ANONYMOUS_ID):s&&n&&(c=n),e[i]=c,!0===a&&(e.properties.legacy_event=!0),new Promise(((t,r)=>{this.segment.track(e,(e=>{if(e){const t=new Error(e.message);return t.stack=e.stack,r(t)}return t()})),o&&this.segment.flush()}))}trackPage({name:e,params:t,environmentType:r,page:s,referrer:n},a){try{if(!1===this.state.participateInMetaMetrics)return;if(null===this.state.participateInMetaMetrics&&(null==a||!a.isOptInPath))return;const{metaMetricsId:o}=this.state,i=o?"userId":"anonymousId",c=null!=o?o:d.METAMETRICS_ANONYMOUS_ID;this.segment.page({[i]:c,name:e,properties:{params:t,locale:this.locale,network:this.network,chain_id:this.chainId,environment_type:r},context:this._buildContext(n,s)})}catch(e){this._captureException(e)}}trackEvent(e,t){this.validatePayload(e),this.submitEvent(e,t).catch((e=>this._captureException(e)))}async submitEvent(e,t){if(this.validatePayload(e),!(this.state.participateInMetaMetrics||null!=t&&t.isOptIn))return;const r=[];if(e.sensitiveProperties){if(!0===(null==t?void 0:t.excludeMetaMetricsId))throw new Error("sensitiveProperties was specified in an event payload that also set the excludeMetaMetricsId flag");const s=(0,a.merge)(e.sensitiveProperties,e.properties);r.push(this._track(this._buildEventPayload(p(p({},e),{},{properties:s})),p(p({},t),{},{excludeMetaMetricsId:!0})))}r.push(this._track(this._buildEventPayload(e),t)),await Promise.all(r)}validatePayload(e){if(!e.event||!e.category)throw new Error(`Must specify event and category. Event was: ${e.event}. Category was: ${e.category}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`)}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/metametrics.js"}],[80,{"../../../shared/constants/app":6261,"../../../shared/modules/hexstring-utils":6276,"../../../shared/modules/random-id":6278,"../metamask-controller":82,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,assert:1776,"eth-rpc-errors":2531,"eth-sig-util":2533,events:2158,jsonschema:4818,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("events")),a=e("assert"),o=e("@metamask/obs-store"),i=e("eth-rpc-errors"),c=e("eth-sig-util"),l=s(e("loglevel")),d=s(e("jsonschema")),u=e("../../../shared/constants/app"),h=e("../metamask-controller"),p=s(e("../../../shared/modules/random-id")),f=e("../../../shared/modules/hexstring-utils");class g extends n.default{constructor({getCurrentChainId:e,metricsEvent:t}){super(),this._getCurrentChainId=e,this.memStore=new o.ObservableStore({unapprovedTypedMessages:{},unapprovedTypedMessagesCount:0}),this.messages=[],this.metricsEvent=t}get unapprovedTypedMessagesCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t,r){return new Promise(((s,n)=>{const a=this.addUnapprovedMessage(e,t,r);this.once(`${a}:finished`,(t=>{switch(t.status){case"signed":return s(t.rawSig);case"rejected":return n(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return n(new Error(`MetaMask Message Signature: ${t.error}`));default:return n(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t,r){e.version=r,t&&(e.origin=t.origin),this.validateParams(e),l.default.debug(`TypedMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`);const s=(new Date).getTime(),n=(0,p.default)(),a={id:n,msgParams:e,time:s,status:"unapproved",type:u.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA};return this.addMsg(a),this.emit("update"),n}validateParams(e){switch(a.strict.ok(e&&"object"==typeof e,"Params must be an object."),a.strict.ok("data"in e,'Params must include a "data" field.'),a.strict.ok("from"in e,'Params must include a "from" field.'),a.strict.ok("string"==typeof e.from&&(0,f.isValidHexAddress)(e.from,{allowNonPrefixed:!1}),'"from" field must be a valid, lowercase, hexadecimal Ethereum address string.'),e.version){case"V1":a.strict.ok(Array.isArray(e.data),'"params.data" must be an array.'),a.strict.doesNotThrow((()=>{(0,c.typedSignatureHash)(e.data)}),"Signing data must be valid EIP-712 typed data.");break;case"V3":case"V4":{let t;a.strict.equal(typeof e.data,"string",'"params.data" must be a string.'),a.strict.doesNotThrow((()=>{t=JSON.parse(e.data)}),'"data" must be a valid JSON string.');const r=d.default.validate(t,c.TYPED_MESSAGE_SCHEMA);a.strict.ok(t.primaryType in t.types,`Primary type of "${t.primaryType}" has no type definition.`),a.strict.equal(r.errors.length,0,"Signing data must conform to EIP-712 schema. See https://git.io/fNtcx.");let{chainId:s}=t.domain;if(s){const e=parseInt(this._getCurrentChainId(),16);a.strict.ok(!Number.isNaN(e),`Cannot sign messages for chainId "${s}", because MetaMask is switching networks.`),"string"==typeof s&&(s=parseInt(s,s.startsWith("0x")?16:10)),a.strict.equal(s,e,`Provided chainId "${s}" must match the active chainId "${e}"`)}break}default:a.strict.fail(`Unknown typed data version "${e.version}"`)}}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,delete e.version,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:"Transactions",properties:{action:"Sign Request",version:r.msgParams.version,type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`TypedMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedTypedMessages:e,unapprovedTypedMessagesCount:t}),this.emit(h.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=g}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/typed-message-manager.js"}],[11,{"../../../../shared/constants/network":6266,"../../../../shared/modules/hexstring-utils":6276,"./ens":10,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,loglevel:5260,"punycode/punycode":5598},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("punycode/punycode")),o=e("@metamask/obs-store"),i=s(e("loglevel")),c=e("../../../../shared/constants/network"),l=e("../../../../shared/modules/hexstring-utils"),d=s(e("./ens"));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor({ens:e,provider:t,onNetworkDidChange:r,getCurrentChainId:s}={}){const n={ensResolutionsByAddress:{}};if(this._ens=e,!this._ens){const e=s(),r=c.CHAIN_ID_TO_NETWORK_ID_MAP[e];d.default.getNetworkEnsSupport(r)&&(this._ens=new d.default({network:r,provider:t}))}this.store=new o.ObservableStore(n),r((()=>{this.store.putState(n);const e=s(),r=c.CHAIN_ID_TO_NETWORK_ID_MAP[e];d.default.getNetworkEnsSupport(r)?this._ens=new d.default({network:r,provider:t}):delete this._ens}))}reverseResolveAddress(e){return this._reverseResolveAddress((0,l.toChecksumHexAddress)(e))}async _reverseResolveAddress(e){if(!this._ens)return undefined;const t=this.store.getState();if(t.ensResolutionsByAddress[e])return t.ensResolutionsByAddress[e];let r,s;try{r=await this._ens.reverse(e)}catch(e){return i.default.debug(e),undefined}try{s=await this._ens.lookup(r)}catch(e){return i.default.debug(e),undefined}return"0x0000000000000000000000000000000000000000"===s||"0x"===s||(0,l.toChecksumHexAddress)(s)!==e?undefined:(this._updateResolutionsByAddress(e,a.default.toASCII(r)),r)}_updateResolutionsByAddress(e,t){const r=this.store.getState();this.store.putState({ensResolutionsByAddress:h(h({},r.ensResolutionsByAddress),{},{[e]:t})})}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/ens/index.js"}],[25,{"./background-api":22,"./caveat-mutators":23,"./enums":24,"./permission-log":26,"./selectors":27,"./specifications":28},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var s=e("./caveat-mutators");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}}))}));var n=e("./background-api");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))}));var a=e("./enums");Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}}))}));var o=e("./permission-log");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}}))}));var i=e("./specifications");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}}))}));var c=e("./selectors");Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===c[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}}))}))}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/permissions/index.js"}],[32,{"../../../../shared/constants/gas":6262,"../../../../shared/constants/network":6266,"../../../../shared/constants/transaction":6270,"../../../../shared/modules/conversion.utils":6273,"../../../../shared/modules/transaction.utils":6282,"../../../../ui/helpers/constants/error-keys":6779,"../../../../ui/helpers/constants/transactions":6783,"../../../../ui/helpers/utils/conversions.util":6797,"../../../../ui/pages/swaps/swaps.util":7160,"../../lib/cleanErrorStack":42,"../../lib/util":81,"../../metamask-controller":82,"./lib/util":34,"./pending-tx-tracker":35,"./tx-gas-utils":36,"./tx-state-manager":37,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@ethereumjs/common":401,"@ethereumjs/tx":405,"@metamask/obs-store":1193,"bignumber.js":2036,"eth-rpc-errors":2531,"ethereumjs-util":2597,"ethjs-query":2646,lodash:5250,loglevel:5260,"nonce-tracker":5374,"safe-event-emitter":5818},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=s(e("safe-event-emitter")),o=e("@metamask/obs-store"),i=e("ethereumjs-util"),c=s(e("ethjs-query")),l=e("eth-rpc-errors"),d=s(e("@ethereumjs/common")),u=e("@ethereumjs/tx"),h=s(e("nonce-tracker")),p=s(e("loglevel")),f=s(e("bignumber.js")),g=e("lodash"),m=s(e("../../lib/cleanErrorStack")),b=e("../../lib/util"),v=e("../../../../ui/helpers/constants/error-keys"),y=e("../../../../ui/pages/swaps/swaps.util"),w=e("../../../../ui/helpers/utils/conversions.util"),S=e("../../../../shared/constants/transaction"),T=e("../../../../ui/helpers/constants/transactions"),k=e("../../metamask-controller"),P=e("../../../../shared/constants/gas"),C=e("../../../../shared/modules/conversion.utils"),E=e("../../../../shared/constants/network"),_=e("../../../../shared/modules/transaction.utils"),M=s(e("./tx-state-manager")),O=s(e("./tx-gas-utils")),A=s(e("./pending-tx-tracker")),I=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=x(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}s.default=e,r&&r.set(e,s);return s}(e("./lib/util"));function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(x=function(e){return e?r:t})(e)}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const N=[S.TRANSACTION_TYPES.SWAP,S.TRANSACTION_TYPES.SWAP_APPROVAL],R="failed on-chain";class F extends a.default{constructor(e){super(),this.networkStore=e.networkStore||new o.ObservableStore({}),this._getCurrentChainId=e.getCurrentChainId,this.getProviderConfig=e.getProviderConfig,this._getCurrentNetworkEIP1559Compatibility=e.getCurrentNetworkEIP1559Compatibility,this._getCurrentAccountEIP1559Compatibility=e.getCurrentAccountEIP1559Compatibility,this.preferencesStore=e.preferencesStore||new o.ObservableStore({}),this.provider=e.provider,this.getPermittedAccounts=e.getPermittedAccounts,this.blockTracker=e.blockTracker,this.signEthTx=e.signTransaction,this.inProcessOfSigning=new Set,this._trackMetaMetricsEvent=e.trackMetaMetricsEvent,this._getParticipateInMetrics=e.getParticipateInMetrics,this._getEIP1559GasFeeEstimates=e.getEIP1559GasFeeEstimates,this.createEventFragment=e.createEventFragment,this.updateEventFragment=e.updateEventFragment,this.finalizeEventFragment=e.finalizeEventFragment,this.getEventFragmentById=e.getEventFragmentById,this.getDeviceModel=e.getDeviceModel,this.getAccountType=e.getAccountType,this.memStore=new o.ObservableStore({}),this.query=new c.default(this.provider),this.txGasUtil=new O.default(this.provider),this._mapMethods(),this.txStateManager=new M.default({initState:e.initState,txHistoryLimit:e.txHistoryLimit,getNetwork:this.getNetwork.bind(this),getCurrentChainId:e.getCurrentChainId}),this._onBootCleanUp(),this.store=this.txStateManager.store,this.nonceTracker=new h.default({provider:this.provider,blockTracker:this.blockTracker,getPendingTransactions:(...t)=>[...this.txStateManager.getPendingTransactions(...t),...e.getExternalPendingTransactions(...t)],getConfirmedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.pendingTxTracker=new A.default({provider:this.provider,nonceTracker:this.nonceTracker,publishTransaction:e=>this.query.sendRawTransaction(e),getPendingTransactions:()=>[...this.txStateManager.getPendingTransactions(),...this.txStateManager.getApprovedTransactions()],approveTransaction:this.approveTransaction.bind(this),getCompletedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.txStateManager.store.subscribe((()=>this.emit(k.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE))),this._setupListeners(),this._updateMemstore(),this.txStateManager.store.subscribe((()=>this._updateMemstore())),this.networkStore.subscribe((()=>{this._onBootCleanUp(),this._updateMemstore()})),this._updatePendingTxsAfterFirstBlock()}getChainId(){const e=this.networkStore.getState(),t=this._getCurrentChainId(),r=parseInt(t,16);return"loading"===e||Number.isNaN(r)?0:r}async getEIP1559Compatibility(e){const t=await this._getCurrentNetworkEIP1559Compatibility(),r=await this._getCurrentAccountEIP1559Compatibility(e);return t&&r}async getCommonConfiguration(e){const{type:t,nickname:r}=this.getProviderConfig(),s=await this.getEIP1559Compatibility(e)?E.HARDFORKS.LONDON:E.HARDFORKS.BERLIN;if(t!==E.NETWORK_TYPE_RPC)return new d.default({chain:t,hardfork:s});const n=parseInt(this._getCurrentChainId(),16),a=this.networkStore.getState(),o={name:r,chainId:n,networkId:"loading"===a?0:parseInt(a,10)};return d.default.forCustomChain(E.MAINNET,o,s)}addTransaction(e){this.txStateManager.addTransaction(e),this.emit(`${e.id}:unapproved`,e),this._trackTransactionMetricsEvent(e,S.TRANSACTION_EVENTS.ADDED)}wipeTransactions(e){this.txStateManager.wipeTransactions(e)}async newUnapprovedTransaction(e,t={}){p.default.debug(`MetaMaskController newUnapprovedTransaction ${JSON.stringify(e)}`);const r=await this.addUnapprovedTransaction(e,t.origin);return new Promise(((e,t)=>{this.txStateManager.once(`${r.id}:finished`,(r=>{switch(r.status){case S.TRANSACTION_STATUSES.SUBMITTED:return e(r.hash);case S.TRANSACTION_STATUSES.REJECTED:return t((0,m.default)(l.ethErrors.provider.userRejectedRequest("MetaMask Tx Signature: User denied transaction signature.")));case S.TRANSACTION_STATUSES.FAILED:return t((0,m.default)(l.ethErrors.rpc.internal(r.err.message)));default:return t((0,m.default)(l.ethErrors.rpc.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(r.txParams)}`)))}}))}))}_getTransaction(e){const{transactions:t}=this.store.getState();return t[e]}_checkIfTxStatusIsUnapproved(e){return this.txStateManager.getTransaction(e).status===S.TRANSACTION_STATUSES.UNAPPROVED}_updateTransaction(e,t,r){const s=this.txStateManager.getTransaction(e),n=(0,g.merge)(s,t);this.txStateManager.updateTransaction(n,r)}updateEditableParams(e,{data:t,from:r,to:s,value:n}){if(!this._checkIfTxStatusIsUnapproved(e))throw new Error("Cannot call updateEditableParams on a transaction that is not in an unapproved state");const a={txParams:{data:t,from:r,to:s,value:n}};a.txParams=(0,g.pickBy)(a.txParams);const o=`Update Editable Params for ${e}`;return this._updateTransaction(e,a,o),this._getTransaction(e)}updateTransactionGasFees(e,{gas:t,gasLimit:r,gasPrice:s,maxPriorityFeePerGas:n,maxFeePerGas:a,estimateUsed:o,estimateSuggested:i,defaultGasEstimates:c,originalGasEstimate:l}){if(!this._checkIfTxStatusIsUnapproved(e))throw new Error("Cannot call updateTransactionGasFees on a transaction that is not in an unapproved state");let d={txParams:{gas:t,gasLimit:r,gasPrice:s,maxPriorityFeePerGas:n,maxFeePerGas:a},estimateUsed:o,estimateSuggested:i,defaultGasEstimates:c,originalGasEstimate:l};d.txParams=(0,g.pickBy)(d.txParams),d=(0,g.pickBy)(d);const u=`Update Transaction Gas Fees for ${e}`;return this._updateTransaction(e,d,u),this._getTransaction(e)}updateTransactionEstimatedBaseFee(e,{estimatedBaseFee:t,decEstimatedBaseFee:r}){if(!this._checkIfTxStatusIsUnapproved(e))throw new Error("Cannot call updateTransactionEstimatedBaseFee on a transaction that is not in an unapproved state");let s={estimatedBaseFee:t,decEstimatedBaseFee:r};s=(0,g.pickBy)(s);const n=`Update Transaction Estimated Base Fees for ${e}`;return this._updateTransaction(e,s,n),this._getTransaction(e)}updateSwapApprovalTransaction(e,{type:t,sourceTokenSymbol:r}){if(!this._checkIfTxStatusIsUnapproved(e))throw new Error("Cannot call updateSwapApprovalTransaction on a transaction that is not in an unapproved state");let s={type:t,sourceTokenSymbol:r};s=(0,g.pickBy)(s);const n=`Update Swap Approval Transaction for ${e}`;return this._updateTransaction(e,s,n),this._getTransaction(e)}updateSwapTransaction(e,{sourceTokenSymbol:t,destinationTokenSymbol:r,type:s,destinationTokenDecimals:n,destinationTokenAddress:a,swapMetaData:o,swapTokenValue:i,estimatedBaseFee:c,approvalTxId:l}){if(!this._checkIfTxStatusIsUnapproved(e))throw new Error("Cannot call updateSwapTransaction on a transaction that is not in an unapproved state");let d={sourceTokenSymbol:t,destinationTokenSymbol:r,type:s,destinationTokenDecimals:n,destinationTokenAddress:a,swapMetaData:o,swapTokenValue:i,estimatedBaseFee:c,approvalTxId:l};d=(0,g.pickBy)(d);const u=`Update Swap Transaction for ${e}`;return this._updateTransaction(e,d,u),this._getTransaction(e)}updateTransactionUserSettings(e,{userEditedGasLimit:t,userFeeLevel:r}){if(!this._checkIfTxStatusIsUnapproved(e))throw new Error("Cannot call updateTransactionUserSettings on a transaction that is not in an unapproved state");let s={userEditedGasLimit:t,userFeeLevel:r};s=(0,g.pickBy)(s);const n=`Update User Settings for ${e}`;return this._updateTransaction(e,s,n),this._getTransaction(e)}async addUnapprovedTransaction(e,t,r){if(r!==undefined&&!N.includes(r))throw new Error(`TransactionController - invalid transactionType value: ${r}`);const s=I.normalizeTxParams(e),n=await this.getEIP1559Compatibility();I.validateTxParams(s,n);let a=this.txStateManager.generateTxMeta({txParams:s,origin:t});if("metamask"===t){if(s.from!==this.getSelectedAddress())throw l.ethErrors.rpc.internal({message:"Internally initiated transaction is using invalid account.",data:{origin:t,fromAddress:s.from,selectedAddress:this.getSelectedAddress()}})}else{if(!(await this.getPermittedAccounts(t)).includes(s.from))throw l.ethErrors.provider.unauthorized({data:{origin:t}})}const{type:o,getCodeResponse:i}=await(0,_.determineTransactionType)(e,this.query);a.type=r||o,a.txParams.value=a.txParams.value?(0,b.addHexPrefix)(a.txParams.value):"0x0",this.addTransaction(a),this.emit("newUnapprovedTx",a);try{a=await this.addTxGasDefaults(a,i)}catch(e){throw p.default.warn(e),a=this.txStateManager.getTransaction(a.id),a.loadingDefaults=!1,this.txStateManager.updateTransaction(a,"Failed to calculate gas defaults."),e}return a.loadingDefaults=!1,this.txStateManager.updateTransaction(a,"Added new unapproved transaction."),a}async addTxGasDefaults(e,t){const r=e.txParams.type!==S.TRANSACTION_ENVELOPE_TYPES.LEGACY&&await this.getEIP1559Compatibility(),{gasPrice:s,maxFeePerGas:n,maxPriorityFeePerGas:a}=await this._getDefaultGasFees(e,r),{gasLimit:o,simulationFails:i}=await this._getDefaultGasLimit(e,t);if(e=this.txStateManager.getTransaction(e.id),i&&(e.simulationFails=i),r){const{eip1559V2Enabled:t}=this.preferencesStore.getState(),r=this.getAdvancedGasFee();t&&Boolean(r)&&!N.includes(e.type)?(e.userFeeLevel=P.CUSTOM_GAS_ESTIMATE,e.txParams.maxFeePerGas=(0,C.decGWEIToHexWEI)(r.maxBaseFee),e.txParams.maxPriorityFeePerGas=(0,C.decGWEIToHexWEI)(r.priorityFee)):!e.txParams.gasPrice||e.txParams.maxFeePerGas||e.txParams.maxPriorityFeePerGas?(n&&a&&!e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas||"metamask"===e.origin?e.userFeeLevel=P.GAS_RECOMMENDATIONS.MEDIUM:e.userFeeLevel=t?P.PRIORITY_LEVELS.DAPP_SUGGESTED:P.CUSTOM_GAS_ESTIMATE,n&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=n),a&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=a),s&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=s),e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=e.txParams.maxFeePerGas)):(e.txParams.maxFeePerGas=e.txParams.gasPrice,e.txParams.maxPriorityFeePerGas=e.txParams.gasPrice,t&&"metamask"!==e.origin?e.userFeeLevel=P.PRIORITY_LEVELS.DAPP_SUGGESTED:e.userFeeLevel=P.CUSTOM_GAS_ESTIMATE),delete e.txParams.gasPrice}else delete e.txParams.maxPriorityFeePerGas,delete e.txParams.maxFeePerGas;return!s||e.txParams.gasPrice||e.txParams.maxPriorityFeePerGas||e.txParams.maxFeePerGas||(e.txParams.gasPrice=s),o&&!e.txParams.gas&&(e.txParams.gas=o,e.originalGasEstimate=o),e.defaultGasEstimates={estimateType:e.userFeeLevel,gas:e.txParams.gas,gasPrice:e.txParams.gasPrice,maxFeePerGas:e.txParams.maxFeePerGas,maxPriorityFeePerGas:e.txParams.maxPriorityFeePerGas},e}async _getDefaultGasFees(e,t){if(!t&&e.txParams.gasPrice||t&&e.txParams.maxFeePerGas&&e.txParams.maxPriorityFeePerGas)return{};try{const{gasFeeEstimates:e,gasEstimateType:r}=await this._getEIP1559GasFeeEstimates();if(t&&r===P.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:r}={}}=e;if(t&&r)return{maxFeePerGas:(0,C.decGWEIToHexWEI)(r),maxPriorityFeePerGas:(0,C.decGWEIToHexWEI)(t)}}else{if(r===P.GAS_ESTIMATE_TYPES.LEGACY)return{gasPrice:(0,C.decGWEIToHexWEI)(e.medium)};if(r===P.GAS_ESTIMATE_TYPES.ETH_GASPRICE)return{gasPrice:(0,C.decGWEIToHexWEI)(e.gasPrice)}}}catch(e){console.error(e)}const r=await this.query.gasPrice();return{gasPrice:r&&(0,b.addHexPrefix)(r.toString(16))}}async _getDefaultGasLimit(e,t){const r=this._getCurrentChainId(),s=E.CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP[r],n=(0,b.getChainType)(r);if(e.txParams.gas)return{};if(e.txParams.to&&e.type===S.TRANSACTION_TYPES.SIMPLE_SEND&&"custom"!==n){if(e.txParams.data){const e=new Error("TxGasUtil - Trying to call a function on a non-contract address");throw e.errorKey=v.TRANSACTION_NO_CONTRACT_ERROR_KEY,e.getCodeResponse=t,e}return{gasLimit:P.GAS_LIMITS.SIMPLE}}const{blockGasLimit:a,estimatedGasHex:o,simulationFails:i}=await this.txGasUtil.analyzeGasUsage(e);return{gasLimit:this.txGasUtil.addGasBuffer((0,b.addHexPrefix)(o),a,s),simulationFails:i}}generateNewGasParams(e,t={},r=11){const{txParams:s}=e,n={},a={};var o;t.gasLimit&&(a.gas=null!==(o=null==t?void 0:t.gas)&&void 0!==o?o:P.GAS_LIMITS.SIMPLE);return t.estimateSuggested&&(a.estimateSuggested=t.estimateSuggested),t.estimateUsed&&(a.estimateUsed=t.estimateUsed),(0,_.isEIP1559Transaction)(e)?(n.maxFeePerGas=s.maxFeePerGas,n.maxPriorityFeePerGas=s.maxPriorityFeePerGas,a.maxFeePerGas=(null==t?void 0:t.maxFeePerGas)||(0,b.bnToHex)((0,b.BnMultiplyByFraction)((0,b.hexToBn)(s.maxFeePerGas),r,10)),a.maxPriorityFeePerGas=(null==t?void 0:t.maxPriorityFeePerGas)||(0,b.bnToHex)((0,b.BnMultiplyByFraction)((0,b.hexToBn)(s.maxPriorityFeePerGas),r,10))):(n.gasPrice=s.gasPrice,a.gasPrice=(null==t?void 0:t.gasPrice)||(0,b.bnToHex)((0,b.BnMultiplyByFraction)((0,b.hexToBn)(s.gasPrice),r,10))),{previousGasParams:n,newGasParams:a}}async createCancelTransaction(e,t,{estimatedBaseFee:r}={}){const s=this.txStateManager.getTransaction(e),{txParams:n}=s,{from:a,nonce:o}=n,{previousGasParams:i,newGasParams:c}=this.generateNewGasParams(s,D(D({},t),{},{gasLimit:t.gasLimit||P.GAS_LIMITS.SIMPLE})),l=this.txStateManager.generateTxMeta({txParams:D({from:a,to:a,nonce:o,value:"0x0"},c),previousGasParams:i,loadingDefaults:!1,status:S.TRANSACTION_STATUSES.APPROVED,type:S.TRANSACTION_TYPES.CANCEL});return r&&(l.estimatedBaseFee=r),this.addTransaction(l),await this.approveTransaction(l.id),l}async createSpeedUpTransaction(e,t,{estimatedBaseFee:r}={}){const s=this.txStateManager.getTransaction(e),{txParams:n}=s,{previousGasParams:a,newGasParams:o}=this.generateNewGasParams(s,t),i=this.txStateManager.generateTxMeta({txParams:D(D({},n),o),previousGasParams:a,loadingDefaults:!1,status:S.TRANSACTION_STATUSES.APPROVED,type:S.TRANSACTION_TYPES.RETRY});return r&&(i.estimatedBaseFee=r),this.addTransaction(i),await this.approveTransaction(i.id),i}async updateTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user updated transaction")}async updateAndApproveTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user approved transaction"),await this.approveTransaction(e.id)}async approveTransaction(e){if(this.inProcessOfSigning.has(e))return;let t;this.inProcessOfSigning.add(e);try{this.txStateManager.setTxStatusApproved(e);const r=this.txStateManager.getTransaction(e),s=r.txParams.from;let{customNonceValue:n}=r;n=Number(n),t=await this.nonceTracker.getNonceLock(s);const a=r.previousGasParams?r.txParams.nonce:t.nextNonce,o=0===n?n:n||a;r.txParams.nonce=(0,b.addHexPrefix)(o.toString(16)),r.nonceDetails=t.nonceDetails,n&&(r.nonceDetails.customNonceValue=n),this.txStateManager.updateTransaction(r,"transactions#approveTransaction");const i=await this.signTransaction(e);await this.publishTransaction(e,i),this._trackTransactionMetricsEvent(r,S.TRANSACTION_EVENTS.APPROVED),t.releaseLock()}catch(r){try{this._failTransaction(e,r)}catch(e){p.default.error(e)}throw t&&t.releaseLock(),r}finally{this.inProcessOfSigning.delete(e)}}async approveTransactionsWithSameNonce(e=[]){if(0===e.length)return"";const t=e[0],r=await this.getCommonConfiguration(t.from),s=u.TransactionFactory.fromTxData(t,{common:r}),n=(0,i.bufferToHex)(s.serialize());if(this.inProcessOfSigning.has(n))return"";let a,o;this.inProcessOfSigning.add(n);try{const r=t.from;o=await this.nonceTracker.getNonceLock(r);const s=o.nextNonce;a=await Promise.all(e.map((e=>(e.nonce=(0,b.addHexPrefix)(s.toString(16)),this.signExternalTransaction(e)))))}catch(e){throw p.default.error(e),e}finally{o&&o.releaseLock(),this.inProcessOfSigning.delete(n)}return a}async signExternalTransaction(e){const t=I.normalizeTxParams(e),r=this.getChainId(),s=(0,_.isEIP1559Transaction)({txParams:t})?S.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:S.TRANSACTION_ENVELOPE_TYPES.LEGACY,n=D(D({},t),{},{type:s,gasLimit:t.gas,chainId:(0,b.addHexPrefix)((0,w.decimalToHex)(r))}),a=n.from,o=await this.getCommonConfiguration(a),c=u.TransactionFactory.fromTxData(n,{common:o}),l=await this.signEthTx(c,a);return(0,i.bufferToHex)(l.serialize())}async signTransaction(e){const t=this.txStateManager.getTransaction(e),r=this.getChainId(),s=(0,_.isEIP1559Transaction)(t)?S.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:S.TRANSACTION_ENVELOPE_TYPES.LEGACY,n=D(D({},t.txParams),{},{type:s,chainId:r,gasLimit:t.txParams.gas}),a=n.from,o=await this.getCommonConfiguration(n.from),c=u.TransactionFactory.fromTxData(n,{common:o}),l=await this.signEthTx(c,a);t.r=(0,i.bufferToHex)(l.r),t.s=(0,i.bufferToHex)(l.s),t.v=(0,i.bufferToHex)(l.v),this.txStateManager.updateTransaction(t,"transactions#signTransaction: add r, s, v values"),this.txStateManager.setTxStatusSigned(t.id);return(0,i.bufferToHex)(l.serialize())}async publishTransaction(e,t){const r=this.txStateManager.getTransaction(e);if(r.rawTx=t,r.type===S.TRANSACTION_TYPES.SWAP){const e=await this.query.getBalance(r.txParams.from);r.preTxBalance=e.toString(16)}let s;this.txStateManager.updateTransaction(r,"transactions#publishTransaction");try{s=await this.query.sendRawTransaction(t)}catch(e){if(!e.message.toLowerCase().includes("known transaction"))throw e;s=(0,i.keccak)((0,i.toBuffer)((0,b.addHexPrefix)(t),"hex")).toString("hex"),s=(0,b.addHexPrefix)(s)}this.setTxHash(e,s),this.txStateManager.setTxStatusSubmitted(e),this._trackTransactionMetricsEvent(r,S.TRANSACTION_EVENTS.SUBMITTED)}async confirmTransaction(e,t,r,s){const n=this.txStateManager.getTransaction(e);if(n)try{const a=I.normalizeTxReceiptGasUsed(t.gasUsed);n.txReceipt=D(D({},t),{},{gasUsed:a}),r&&(n.baseFeePerGas=r),s&&(n.blockTimestamp=s),this.txStateManager.setTxStatusConfirmed(e),this._markNonceDuplicatesDropped(e);const{submittedTime:o}=n,i={gas_used:a};if(o&&(i.completion_time=this._getTransactionCompletionTime(o)),"0x0"===t.status&&(i.status=R),this._trackTransactionMetricsEvent(n,S.TRANSACTION_EVENTS.FINALIZED,i),this.txStateManager.updateTransaction(n,"transactions#confirmTransaction - add txReceipt"),n.type===S.TRANSACTION_TYPES.SWAP){const t=await this.query.getBalance(n.txParams.from),r=this.txStateManager.getTransaction(e),s=r.approvalTxId?this.txStateManager.getTransaction(r.approvalTxId):null;r.postTxBalance=t.toString(16),this.txStateManager.updateTransaction(r,"transactions#confirmTransaction - add postTxBalance"),this._trackSwapsMetrics(r,s)}}catch(e){p.default.error(e)}}async confirmExternalTransaction(e,t,r){if(await this.txStateManager.addExternalTransaction(e),!e)return;const s=e.id;try{const n=I.normalizeTxReceiptGasUsed(t.gasUsed);e.txReceipt=D(D({},t),{},{gasUsed:n}),r&&(e.baseFeePerGas=r),this.txStateManager.setTxStatusConfirmed(s),this._markNonceDuplicatesDropped(s);const{submittedTime:a}=e,o={gas_used:n};if(a&&(o.completion_time=this._getTransactionCompletionTime(a)),"0x0"===t.status&&(o.status=R),this._trackTransactionMetricsEvent(e,S.TRANSACTION_EVENTS.FINALIZED,o),this.txStateManager.updateTransaction(e,"transactions#confirmTransaction - add txReceipt"),e.type===S.TRANSACTION_TYPES.SWAP){const t=await this.query.getBalance(e.txParams.from),r=this.txStateManager.getTransaction(s),n=r.approvalTxId?this.txStateManager.getTransaction(r.approvalTxId):null;r.postTxBalance=t.toString(16),this.txStateManager.updateTransaction(r,"transactions#confirmTransaction - add postTxBalance"),this._trackSwapsMetrics(r,n)}}catch(e){p.default.error(e)}}async cancelTransaction(e){const t=this.txStateManager.getTransaction(e);this.txStateManager.setTxStatusRejected(e),this._trackTransactionMetricsEvent(t,S.TRANSACTION_EVENTS.REJECTED)}setTxHash(e,t){const r=this.txStateManager.getTransaction(e);r.hash=t,this.txStateManager.updateTransaction(r,"transactions#setTxHash")}async createTransactionEventFragment(e,t){const r=this.txStateManager.getTransaction(e),{properties:s,sensitiveProperties:n}=await this._buildEventFragmentProperties(r);this._createTransactionEventFragment(r,t,s,n)}_mapMethods(){this.getState=()=>this.memStore.getState(),this.getNetwork=()=>this.networkStore.getState(),this.getSelectedAddress=()=>this.preferencesStore.getState().selectedAddress,this.getUnapprovedTxCount=()=>Object.keys(this.txStateManager.getUnapprovedTxList()).length,this.getPendingTxCount=e=>this.txStateManager.getPendingTransactions(e).length,this.getTransactions=e=>this.txStateManager.getTransactions(e),this.getAdvancedGasFee=()=>this.preferencesStore.getState().advancedGasFee}async _updatePendingTxsAfterFirstBlock(){await this.blockTracker.getLatestBlock(),await this.pendingTxTracker.updatePendingTxs()}_onBootCleanUp(){this.txStateManager.getTransactions({searchCriteria:{status:S.TRANSACTION_STATUSES.UNAPPROVED,loadingDefaults:!0}}).forEach((e=>{this.addTxGasDefaults(e).then((e=>{e.loadingDefaults=!1,this.txStateManager.updateTransaction(e,"transactions: gas estimation for tx on boot")})).catch((t=>{const r=this.txStateManager.getTransaction(e.id);r.loadingDefaults=!1,this.txStateManager.updateTransaction(r,"failed to estimate gas during boot cleanup."),this._failTransaction(r.id,t)}))})),this.txStateManager.getTransactions({searchCriteria:{status:S.TRANSACTION_STATUSES.APPROVED}}).forEach((e=>{const t=new Error('Transaction found as "approved" during boot - possibly stuck during signing');this._failTransaction(e.id,t)}))}_setupListeners(){this.txStateManager.on("tx:status-update",this.emit.bind(this,"tx:status-update")),this._setupBlockTrackerListener(),this.pendingTxTracker.on("tx:warning",(e=>{this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:warning")})),this.pendingTxTracker.on("tx:failed",((e,t)=>{this._failTransaction(e,t)})),this.pendingTxTracker.on("tx:confirmed",((e,t,r,s)=>this.confirmTransaction(e,t,r,s))),this.pendingTxTracker.on("tx:dropped",(e=>{this._dropTransaction(e)})),this.pendingTxTracker.on("tx:block-update",((e,t)=>{e.firstRetryBlockNumber||(e.firstRetryBlockNumber=t,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:block-update"))})),this.pendingTxTracker.on("tx:retry",(e=>{"retryCount"in e||(e.retryCount=0),e.retryCount+=1,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:retry")}))}_markNonceDuplicatesDropped(e){const t=this.txStateManager.getTransaction(e),{nonce:r,from:s}=t.txParams,n=this.txStateManager.getTransactions({searchCriteria:{nonce:r,from:s}});n.length&&n.forEach((r=>{r.id!==e&&(r.replacedBy=t.hash,this.txStateManager.updateTransaction(t,"transactions/pending-tx-tracker#event: tx:confirmed reference to confirmed txHash with same nonce"),this._dropTransaction(r.id))}))}_setupBlockTrackerListener(){let e=!1;const t=this._onLatestBlock.bind(this),{blockTracker:r,txStateManager:s}=this;function n(){const n=s.getPendingTransactions();!e&&n.length>0?(r.on("latest",t),e=!0):e&&!n.length&&(r.removeListener("latest",t),e=!1)}s.on("tx:status-update",n),n()}async _onLatestBlock(e){try{await this.pendingTxTracker.updatePendingTxs()}catch(e){p.default.error(e)}try{await this.pendingTxTracker.resubmitPendingTxs(e)}catch(e){p.default.error(e)}}_updateMemstore(){const e=this.txStateManager.getUnapprovedTxList(),t=this.txStateManager.getTransactions({limit:100});this.memStore.updateState({unapprovedTxs:e,currentNetworkTxList:t})}_trackSwapsMetrics(e,t){if(this._getParticipateInMetrics()&&e.swapMetaData)if("0x0"===e.txReceipt.status)this._trackMetaMetricsEvent({event:"Swap Failed",sensitiveProperties:D({},e.swapMetaData),category:"swaps"});else{const r=(0,y.getSwapsTokensReceivedFromTxMeta)(e.destinationTokenSymbol,e,e.destinationTokenAddress,e.txParams.from,e.destinationTokenDecimals,t,e.chainId),s=r?`${new f.default(r,10).div(e.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,n=e.txReceipt.gasUsed&&e.swapMetaData.estimated_gas?`${new f.default(e.txReceipt.gasUsed,16).div(e.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null;this._trackMetaMetricsEvent({event:"Swap Completed",category:"swaps",sensitiveProperties:D(D({},e.swapMetaData),{},{token_to_amount_received:r,quote_vs_executionRatio:s,estimated_vs_used_gasRatio:n})})}}async _buildEventFragmentProperties(e,t){const{type:r,time:s,status:n,chainId:a,origin:o,txParams:{gasPrice:i,gas:c,maxFeePerGas:l,maxPriorityFeePerGas:d,estimateSuggested:u,estimateUsed:h},defaultGasEstimates:p,metamaskNetworkId:f}=e,g="metamask"===o?"user":"dapp",m={};if((0,_.isEIP1559Transaction)(e)?(m.max_fee_per_gas=l,m.max_priority_fee_per_gas=d):m.gas_price=i,p){const{estimateType:t}=p;if(t){m.default_estimate=t;let r=e.defaultGasEstimates.maxFeePerGas,s=e.defaultGasEstimates.maxPriorityFeePerGas;if([P.GAS_RECOMMENDATIONS.LOW,P.GAS_RECOMMENDATIONS.MEDIUM,P.GAS_RECOMMENDATIONS.MEDIUM.HIGH].includes(t)){var b,v;const{gasFeeEstimates:e}=await this._getEIP1559GasFeeEstimates();var y,w;if(null!=e&&null!==(b=e[t])&&void 0!==b&&b.suggestedMaxFeePerGas)r=null===(y=e[t])||void 0===y?void 0:y.suggestedMaxFeePerGas,m.default_max_fee_per_gas=r;if(null!=e&&null!==(v=e[t])&&void 0!==v&&v.suggestedMaxPriorityFeePerGas)s=null===(w=e[t])||void 0===w?void 0:w.suggestedMaxPriorityFeePerGas,m.default_max_priority_fee_per_gas=s}}e.defaultGasEstimates.gas&&(m.default_gas=e.defaultGasEstimates.gas),e.defaultGasEstimates.gasPrice&&(m.default_gas_price=e.defaultGasEstimates.gasPrice)}u&&(m.estimate_suggested=u),h&&(m.estimate_used=h);const S=this._getGasValuesInGWEI(m);let k="0";if(e.txParams.maxFeePerGas){const{eip1559V2Enabled:e}=this.preferencesStore.getState();k=e?"2":"1"}return{properties:{chain_id:a,referrer:o,source:g,network:f,type:r,eip_1559_version:k,gas_edit_type:"none",gas_edit_attempted:"none",account_type:await this.getAccountType(this.getSelectedAddress()),device_model:await this.getDeviceModel(this.getSelectedAddress())},sensitiveProperties:D(D({status:n,transaction_envelope_type:(0,_.isEIP1559Transaction)(e)?T.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:T.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:s,gas_limit:c},S),t)}}_createTransactionEventFragment(e,t,r,s){const n=`transaction-${[S.TRANSACTION_EVENTS.FINALIZED,S.TRANSACTION_EVENTS.SUBMITTED].includes(t)?"submitted":"added"}-${e.id}`;if(void 0===this.getEventFragmentById(n))switch(t){case S.TRANSACTION_EVENTS.ADDED:this.createEventFragment({category:"Transactions",initialEvent:S.TRANSACTION_EVENTS.ADDED,successEvent:S.TRANSACTION_EVENTS.APPROVED,failureEvent:S.TRANSACTION_EVENTS.REJECTED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n});break;case S.TRANSACTION_EVENTS.APPROVED:case S.TRANSACTION_EVENTS.REJECTED:this.createEventFragment({category:"Transactions",successEvent:S.TRANSACTION_EVENTS.APPROVED,failureEvent:S.TRANSACTION_EVENTS.REJECTED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n});break;case S.TRANSACTION_EVENTS.SUBMITTED:this.createEventFragment({category:"Transactions",initialEvent:S.TRANSACTION_EVENTS.SUBMITTED,successEvent:S.TRANSACTION_EVENTS.FINALIZED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n});break;case S.TRANSACTION_EVENTS.FINALIZED:this.createEventFragment({category:"Transactions",successEvent:S.TRANSACTION_EVENTS.FINALIZED,properties:r,sensitiveProperties:s,persist:!0,uniqueIdentifier:n})}}async _trackTransactionMetricsEvent(e,t,r={}){if(!e)return;const{properties:s,sensitiveProperties:n}=await this._buildEventFragmentProperties(e,r);let a;switch(this._createTransactionEventFragment(e,t,s,n),t){case S.TRANSACTION_EVENTS.APPROVED:a=`transaction-added-${e.id}`,this.updateEventFragment(a,{properties:s,sensitiveProperties:n}),this.finalizeEventFragment(a);break;case S.TRANSACTION_EVENTS.REJECTED:a=`transaction-added-${e.id}`,this.updateEventFragment(a,{properties:s,sensitiveProperties:n}),this.finalizeEventFragment(a,{abandoned:!0});break;case S.TRANSACTION_EVENTS.FINALIZED:a=`transaction-submitted-${e.id}`,this.updateEventFragment(a,{properties:s,sensitiveProperties:n}),this.finalizeEventFragment(`transaction-submitted-${e.id}`)}}_getTransactionCompletionTime(e){return Math.round((Date.now()-e)/1e3).toString()}_getGasValuesInGWEI(e){const t={};for(const r in e)(0,i.isHexString)(e[r])?t[r]=(0,w.hexWEIToDecGWEI)(e[r]):t[r]=e[r];return t}_failTransaction(e,t){this.txStateManager.setTxStatusFailed(e,t);const r=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(r,S.TRANSACTION_EVENTS.FINALIZED,{error:t.message})}_dropTransaction(e){this.txStateManager.setTxStatusDropped(e);const t=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(t,S.TRANSACTION_EVENTS.FINALIZED)}}r.default=F}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/transactions/index.js"}],[77,{"../../../shared/constants/time":6269,"@babel/runtime/helpers/interopRequireDefault":195,_process:5498,"analytics-node":1753},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.segment=r.createSegmentMock=void 0;var n,a,o=s(e("analytics-node")),i=e("../../../shared/constants/time");const c=Boolean(t.env.METAMASK_DEBUG&&!t.env.IN_TEST),l=null!==(n="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP")?n:null,d=null!==(a=t.env.SEGMENT_HOST)&&void 0!==a?a:null,u=undefined,h=5*i.SECOND,p=(e=u)=>{const t={queue:[],flush(){t.queue.forEach((([e,t])=>{t()})),t.queue=[]},track(r,s=(()=>undefined)){t.queue.push([r,s]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};r.createSegmentMock=p;const f=!l||c&&!d?p(u):new o.default(l,{host:d,flushAt:u,flushInterval:h});r.segment=f}).call(this)}).call(this,e("_process"))}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/segment.js"}],[2,{"../lib/util":81,"@babel/runtime/helpers/interopRequireDefault":195,"ethereumjs-util":2597,"ethereumjs-wallet":2603,"ethereumjs-wallet/thirdparty":2618,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("loglevel")),a=s(e("ethereumjs-wallet")),o=s(e("ethereumjs-wallet/thirdparty")),i=e("ethereumjs-util"),c=e("../lib/util");var l={importAccount(e,t){try{const r=(0,this.strategies[e])(...t);return Promise.resolve(r)}catch(e){return Promise.reject(e)}},strategies:{"Private Key":e=>{if(!e)throw new Error("Cannot import an empty key.");const t=(0,c.addHexPrefix)(e),r=(0,i.toBuffer)(t);if(!(0,i.isValidPrivate)(r))throw new Error("Cannot import invalid private key.");return(0,i.stripHexPrefix)(t)},"JSON File":(e,t)=>{let r;try{r=o.default.fromEtherWallet(e,t)}catch(s){n.default.debug("Attempt to import as EtherWallet format failed, trying V3"),r=a.default.fromV3(e,t,!0)}return function(e){const t=e.getPrivateKey();return(0,i.bufferToHex)(t)}(r)}}};r.default=l}}},{package:"<root>",file:"/home/circleci/project/app/scripts/account-import-strategies/index.js"}],[17,{"./network":19},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NETWORK_EVENTS",{enumerable:!0,get:function(){return s.NETWORK_EVENTS}}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s.default}});var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=a?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(s,o,i):s[o]=e[o]}s.default=e,r&&r.set(e,s);return s}(e("./network"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/network/index.js"}],[30,{"../../../shared/constants/gas":6262,"../../../shared/constants/swaps":6268,"../../../shared/constants/time":6269,"../../../shared/modules/conversion.utils":6273,"../../../shared/modules/string-utils":6280,"../../../shared/modules/swaps.utils":6281,"../../../ui/helpers/utils/fetch-with-cache":6798,"../../../ui/helpers/utils/token-util":6811,"../../../ui/pages/send/send.utils":7051,"../../../ui/pages/swaps/swaps.util":7160,"./network":17,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,"bignumber.js":2036,ethers:2621,"human-standard-token-abi":4463,lodash:5250,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.utils=r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("ethers"),o=s(e("loglevel")),i=s(e("bignumber.js")),c=e("@metamask/obs-store"),l=e("lodash"),d=s(e("human-standard-token-abi")),u=e("../../../ui/helpers/utils/token-util"),h=e("../../../ui/pages/send/send.utils"),p=e("../../../shared/modules/conversion.utils"),f=e("../../../shared/constants/swaps"),g=e("../../../shared/constants/gas"),m=e("../../../shared/modules/swaps.utils"),b=e("../../../ui/pages/swaps/swaps.util"),v=s(e("../../../ui/helpers/utils/fetch-with-cache")),y=e("../../../shared/constants/time"),w=e("../../../shared/modules/string-utils"),S=e("./network");function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const P=25e5,C=y.MINUTE,E=10*y.SECOND;function _(e=25e5,t=0,r=0){const s=new i.default(e,10).minus(t,10);return!s.lt(0)&&s.lt(r,16)?`0x${s.toString(16)}`:r}const M={swapsState:{quotes:{},quotesPollingLimitEnabled:!1,fetchParams:null,tokens:null,tradeTxId:null,approveTxId:null,quotesLastFetched:null,customMaxGas:"",customGasPrice:null,customMaxFeePerGas:null,customMaxPriorityFeePerGas:null,swapsUserFeeLevel:"",selectedAggId:null,customApproveTxData:"",errorKey:"",topAggId:null,routeState:"",swapsFeatureIsLive:!0,saveFetchedQuotes:!1,swapsQuoteRefreshTime:C,swapsQuotePrefetchingRefreshTime:C,swapsStxBatchStatusRefreshTime:E,swapsStxGetTransactionsRefreshTime:E,swapsFeatureFlags:{}}};function O(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array param.");const t=[...e];if(t.sort(((e,t)=>{const r=new i.default(e.overallValueOfQuote,10),s=new i.default(t.overallValueOfQuote,10);return r.equals(s)?0:r.lessThan(s)?-1:1})),t.length%2==1){const e=t[(t.length-1)/2].overallValueOfQuote;return A(t.filter((t=>e===t.overallValueOfQuote)))}const r=t.length/2,s=r-1,n=t[r].overallValueOfQuote,a=t[s].overallValueOfQuote,o=t.filter((e=>n===e.overallValueOfQuote)),c=t.filter((e=>a===e.overallValueOfQuote)),l=A(o),d=A(c);return{ethFee:new i.default(l.ethFee,10).plus(d.ethFee,10).dividedBy(2).toString(10),metaMaskFeeInEth:new i.default(l.metaMaskFeeInEth,10).plus(d.metaMaskFeeInEth,10).dividedBy(2).toString(10),ethValueOfTokens:new i.default(l.ethValueOfTokens,10).plus(d.ethValueOfTokens,10).dividedBy(2).toString(10)}}function A(e){const t=e.reduce(((e,t)=>({ethFee:e.ethFee.plus(t.ethFee,10),metaMaskFeeInEth:e.metaMaskFeeInEth.plus(t.metaMaskFeeInEth,10),ethValueOfTokens:e.ethValueOfTokens.plus(t.ethValueOfTokens,10)})),{ethFee:new i.default(0,10),metaMaskFeeInEth:new i.default(0,10),ethValueOfTokens:new i.default(0,10)});return{ethFee:t.ethFee.div(e.length,10).toString(10),metaMaskFeeInEth:t.metaMaskFeeInEth.div(e.length,10).toString(10),ethValueOfTokens:t.ethValueOfTokens.div(e.length,10).toString(10)}}r.default=class{constructor({getBufferedGasLimit:e,networkController:t,provider:r,getProviderConfig:s,getTokenRatesState:n,fetchTradesInfo:o=b.fetchTradesInfo,getCurrentChainId:i,getEIP1559GasFeeEstimates:l}){this.store=new c.ObservableStore({swapsState:k({},M.swapsState)}),this._fetchTradesInfo=o,this._getCurrentChainId=i,this._getEIP1559GasFeeEstimates=l,this.getBufferedGasLimit=e,this.getTokenRatesState=n,this.pollCount=0,this.getProviderConfig=s,this.indexOfNewestCallInFlight=0,this.ethersProvider=new a.ethers.providers.Web3Provider(r),this._currentNetwork=t.store.getState().network,t.on(S.NETWORK_EVENTS.NETWORK_DID_CHANGE,(e=>{"loading"!==e&&e!==this._currentNetwork&&(this._currentNetwork=e,this.ethersProvider=new a.ethers.providers.Web3Provider(r))}))}async fetchSwapsRefreshRates(e){const t=await(0,v.default)((0,b.getBaseApi)("network",e),{method:"GET"},{cacheRefreshTime:6e5}),{refreshRates:r}=t||{};if(!r||"number"!=typeof r.quotes||"number"!=typeof r.quotesPrefetching||"number"!=typeof r.stxGetTransactions||"number"!=typeof r.stxBatchStatus)throw new Error(`MetaMask - invalid response for refreshRates: ${t}`);return{quotes:1e3*r.quotes,quotesPrefetching:1e3*r.quotesPrefetching,stxGetTransactions:1e3*r.stxGetTransactions,stxBatchStatus:1e3*r.stxBatchStatus,stxStatusDeadline:r.stxStatusDeadline}}async _setSwapsRefreshRates(){var e,t,r,s,n;const a=this._getCurrentChainId();let o;try{o=await this.fetchSwapsRefreshRates(a)}catch(e){console.error("Request for swaps quote refresh time failed: ",e)}const{swapsState:i}=this.store.getState();this.store.updateState({swapsState:k(k({},i),{},{swapsQuoteRefreshTime:(null===(e=o)||void 0===e?void 0:e.quotes)||C,swapsQuotePrefetchingRefreshTime:(null===(t=o)||void 0===t?void 0:t.quotesPrefetching)||C,swapsStxGetTransactionsRefreshTime:(null===(r=o)||void 0===r?void 0:r.stxGetTransactions)||E,swapsStxBatchStatusRefreshTime:(null===(s=o)||void 0===s?void 0:s.stxBatchStatus)||E,swapsStxStatusDeadline:(null===(n=o)||void 0===n?void 0:n.stxStatusDeadline)||180})})}pollForNewQuotes(){const{swapsState:{swapsQuoteRefreshTime:e,swapsQuotePrefetchingRefreshTime:t,quotesPollingLimitEnabled:r}}=this.store.getState(),s=r?e:t;this.pollingTimeout=setTimeout((()=>{var e;const{swapsState:t}=this.store.getState();this.fetchAndSetQuotes(t.fetchParams,null===(e=t.fetchParams)||void 0===e?void 0:e.metaData,!0)}),s)}stopPollingForQuotes(){this.pollingTimeout&&clearTimeout(this.pollingTimeout)}async fetchAndSetQuotes(e,t={},r){const{chainId:s}=t,{swapsState:{quotesPollingLimitEnabled:n,saveFetchedQuotes:a}}=this.store.getState();if(!e)return null;r||(this.pollCount=0),clearTimeout(this.pollingTimeout),r||this.setSwapsErrorKey("");const o=this.indexOfNewestCallInFlight+1;this.indexOfNewestCallInFlight=o,a||this.setSaveFetchedQuotes(!0);let[i]=await Promise.all([this._fetchTradesInfo(e,k({},t)),this._setSwapsRefreshRates()]);const{swapsState:{saveFetchedQuotes:c}}=this.store.getState();if(!c)return[{},null];i=(0,l.mapValues)(i,(e=>k(k({},e),{},{sourceTokenInfo:t.sourceTokenInfo,destinationTokenInfo:t.destinationTokenInfo})));const d=Date.now();let u=!1;if(!(0,m.isSwapsDefaultTokenAddress)(e.sourceToken,s)&&Object.values(i).length){const t=await this._getERC20Allowance(e.sourceToken,e.fromAddress,s),[n]=Object.values(i);if(u=n.approvalNeeded&&t.eq(0)&&"wrappedNative"!==n.aggregator,u){if(!r){const{gasLimit:e}=await this.timedoutGasReturn(n.approvalNeeded);i=(0,l.mapValues)(i,(t=>k(k({},t),{},{approvalNeeded:k(k({},t.approvalNeeded),{},{gas:e||f.DEFAULT_ERC20_APPROVE_GAS})})))}}else i=(0,l.mapValues)(i,(e=>k(k({},e),{},{approvalNeeded:null})))}let h=null;if(u||null!=e&&e.balanceError||(i=await this.getAllQuotesWithGasEstimates(i)),0===Object.values(i).length)this.setSwapsErrorKey(f.QUOTES_NOT_AVAILABLE_ERROR);else{const[e,t]=await this._findTopQuoteAndCalculateSavings(i);h=e,i=t}if(this.indexOfNewestCallInFlight!==o)throw new Error(f.SWAPS_FETCH_ORDER_CONFLICT);const{swapsState:p}=this.store.getState();let{selectedAggId:g}=p;return i[g]||(g=null),this.store.updateState({swapsState:k(k({},p),{},{quotes:i,fetchParams:k(k({},e),{},{metaData:t}),quotesLastFetched:d,selectedAggId:g,topAggId:h})}),n&&(this.pollCount+=1),!n||this.pollCount<4?(this.pollForNewQuotes(),[i,h]):(this.resetPostFetchState(),this.setSwapsErrorKey(f.QUOTES_EXPIRED_ERROR),null)}safeRefetchQuotes(){const{swapsState:e}=this.store.getState();!this.pollingTimeout&&e.fetchParams&&this.fetchAndSetQuotes(e.fetchParams)}setSelectedQuoteAggId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{selectedAggId:e})})}setSwapsTokens(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{tokens:e})})}clearSwapsQuotes(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:k(k({},e),{},{quotes:{}})})}setSwapsErrorKey(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{errorKey:e})})}async getAllQuotesWithGasEstimates(e){const t=await Promise.all(Object.values(e).map((async e=>{const{gasLimit:t,simulationFails:r}=await this.timedoutGasReturn(e.trade);return[t,r,e.aggregator]}))),r={};return t.forEach((([t,s,n])=>{if(t&&!s){const s=_(e[n].maxGas,e[n].estimatedRefund,t);r[n]=k(k({},e[n]),{},{gasEstimate:t,gasEstimateWithRefund:s})}else e[n].approvalNeeded&&(r[n]=e[n])})),r}timedoutGasReturn(e){return new Promise((t=>{let r=!1;const s=setTimeout((()=>{r=!0,t({gasLimit:null,simulationFails:!0})}),5*y.SECOND),n={data:e.data,from:e.from,to:e.to,value:e.value};this.getBufferedGasLimit({txParams:n},1).then((({gasLimit:e,simulationFails:n})=>{r||(clearTimeout(s),t({gasLimit:e,simulationFails:n}))})).catch((e=>{o.default.error(e),r||(clearTimeout(s),t({gasLimit:null,simulationFails:!0}))}))}))}async setInitialGasEstimate(e){const{swapsState:t}=this.store.getState(),r=k({},t.quotes[e]),{gasLimit:s,simulationFails:n}=await this.timedoutGasReturn(r.trade);if(s&&!n){const e=_(r.maxGas,r.estimatedRefund,s);r.gasEstimate=s,r.gasEstimateWithRefund=e}this.store.updateState({swapsState:k(k({},t),{},{quotes:k(k({},t.quotes),{},{[e]:r})})})}setApproveTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{approveTxId:e})})}setTradeTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{tradeTxId:e})})}setQuotesLastFetched(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{quotesLastFetched:e})})}setSwapsTxGasPrice(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{customGasPrice:e})})}setSwapsTxMaxFeePerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{customMaxFeePerGas:e})})}setSwapsUserFeeLevel(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{swapsUserFeeLevel:e})})}setSwapsQuotesPollingLimitEnabled(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{quotesPollingLimitEnabled:e})})}setSwapsTxMaxFeePriorityPerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{customMaxPriorityFeePerGas:e})})}setSwapsTxGasLimit(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{customMaxGas:e})})}setCustomApproveTxData(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{customApproveTxData:e})})}setBackgroundSwapRouteState(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{routeState:e})})}setSaveFetchedQuotes(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{saveFetchedQuotes:e})})}setSwapsLiveness(e){const{swapsState:t}=this.store.getState(),{swapsFeatureIsLive:r}=e;this.store.updateState({swapsState:k(k({},t),{},{swapsFeatureIsLive:r})})}setSwapsFeatureFlags(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:k(k({},t),{},{swapsFeatureFlags:e})})}resetPostFetchState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:k(k({},M.swapsState),{},{tokens:e.tokens,fetchParams:e.fetchParams,swapsFeatureIsLive:e.swapsFeatureIsLive,swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime,swapsFeatureFlags:e.swapsFeatureFlags})}),clearTimeout(this.pollingTimeout)}resetSwapsState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:k(k({},M.swapsState),{},{swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime})}),clearTimeout(this.pollingTimeout)}async _findTopQuoteAndCalculateSavings(e={}){const{contractExchangeRates:t}=this.getTokenRatesState(),{swapsState:{customGasPrice:r,customMaxPriorityFeePerGas:s}}=this.store.getState(),n=this._getCurrentChainId();if(!Object.keys(e).length)return{};const a=(0,l.cloneDeep)(e),{gasFeeEstimates:o,gasEstimateType:c}=await this._getEIP1559GasFeeEstimates();let d="0x0";if(c===g.GAS_ESTIMATE_TYPES.FEE_MARKET){const{high:{suggestedMaxPriorityFeePerGas:e},estimatedBaseFee:t}=o;d=(0,p.addCurrencies)(s||(0,p.decGWEIToHexWEI)(e),(0,p.decGWEIToHexWEI)(t),{aBase:16,bBase:16,toNumericBase:"hex",numberOfDecimals:6})}else c===g.GAS_ESTIMATE_TYPES.LEGACY?d=r||(0,p.decGWEIToHexWEI)(o.high):c===g.GAS_ESTIMATE_TYPES.ETH_GASPRICE&&(d=r||(0,p.decGWEIToHexWEI)(o.gasPrice));let f=null,b=null;Object.values(a).forEach((e=>{const{aggregator:r,approvalNeeded:s,averageGas:a,destinationAmount:o=0,destinationToken:c,destinationTokenInfo:l,gasEstimate:g,sourceAmount:v,sourceToken:y,trade:S,fee:T}=e,k=(g?new i.default(g,16):new i.default(a||P,10)).plus((null==s?void 0:s.gas)||"0x0",16).toString(16),C=(0,h.calcGasTotal)(k,d),E=new i.default(C,16).plus(S.value,16),_=(0,p.conversionUtil)(E,{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}),M=(0,m.isSwapsDefaultTokenAddress)(y,n)?(0,p.conversionUtil)(E.minus(v,10),{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}):_,O=(0,u.calcTokenAmount)(o,l.decimals),A=new i.default(100,10).minus(T,10).div(100),I=O.div(A).minus(O),x=t[Object.keys(t).find((e=>(0,w.isEqualCaseInsensitive)(e,c)))],j=x||1,D=O.times(j.toString(10),10),N=(0,m.isSwapsDefaultTokenAddress)(c,n)?1:x,R=N===undefined?D:D.minus(M,10);e.ethFee=M.toString(10),N!==undefined&&(e.ethValueOfTokens=D.toString(10),e.overallValueOfQuote=R.toString(10),e.metaMaskFeeInEth=I.times(N.toString(10)).toString(10)),(null===b||R.gt(b))&&(f=r,b=R)}));let v=null;if((0,m.isSwapsDefaultTokenAddress)(a[f].destinationToken,n)||Boolean(t[Object.keys(t).find((e=>{var t;return(0,w.isEqualCaseInsensitive)(e,null===(t=a[f])||void 0===t?void 0:t.destinationToken)}))])){const e=a[f];v={};const{ethFee:t,metaMaskFeeInEth:r,ethValueOfTokens:s}=O(Object.values(a));v.performance=new i.default(e.ethValueOfTokens,10).minus(s,10),v.fee=new i.default(t).minus(e.ethFee,10),v.metaMaskFee=e.metaMaskFeeInEth,v.total=v.performance.plus(v.fee).minus(v.metaMaskFee).toString(10),v.performance=v.performance.toString(10),v.fee=v.fee.toString(10),v.medianMetaMaskFee=r,a[f].isBestQuote=!0,a[f].savings=v}return[f,a]}async _getERC20Allowance(e,t,r){const s=new a.ethers.Contract(e,d.default,this.ethersProvider);return await s.allowance(t,f.SWAPS_CHAINID_CONTRACT_ADDRESS_MAP[r])}};const I={getMedianEthValueQuote:O,meansOfQuotesFeesAndValue:A};r.utils=I}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/swaps.js"}],[1093,{"@ethereumjs/tx":405,buffer:2157,"eth-sig-util":1094,"ethereumjs-util":2597,events:2158,hdkey:1097},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const{EventEmitter:s}=e("events"),n=e("hdkey"),a=e("ethereumjs-util"),o=e("eth-sig-util"),{TransactionFactory:i}=e("@ethereumjs/tx"),c="m",l="Ledger Hardware",d={ropsten:"http://api-ropsten.etherscan.io",kovan:"http://api-kovan.etherscan.io",rinkeby:"https://api-rinkeby.etherscan.io",mainnet:"https://api.etherscan.io"};class u extends s{constructor(e={}){super(),this.accountDetails={},this.bridgeUrl=null,this.type=l,this.page=0,this.perPage=5,this.unlockedAccount=0,this.hdk=new n,this.paths={},this.iframe=null,this.network="mainnet",this.implementFullBIP44=!1,this.deserialize(e),this.iframeLoaded=!1,this._setupIframe()}serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,accountDetails:this.accountDetails,bridgeUrl:this.bridgeUrl,implementFullBIP44:!1})}deserialize(e={}){return this.hdPath=e.hdPath||"m/44'/60'/0'",this.bridgeUrl=e.bridgeUrl||"https://metamask.github.io/eth-ledger-bridge-keyring",this.accounts=e.accounts||[],this.accountDetails=e.accountDetails||{},e.accountDetails||this._migrateAccountDetails(e),this.implementFullBIP44=e.implementFullBIP44||!1,this.accounts=this.accounts.filter((e=>Object.keys(this.accountDetails).includes(a.toChecksumAddress(e)))),Promise.resolve()}_migrateAccountDetails(e){if(this._isLedgerLiveHdPath()&&e.accountIndexes)for(const t of Object.keys(e.accountIndexes))this.accountDetails[t]={bip44:!0,hdPath:this._getPathForIndex(e.accountIndexes[t])};this._isLedgerLiveHdPath()||this.accounts.filter((e=>!Object.keys(this.accountDetails).includes(a.toChecksumAddress(e)))).forEach((e=>{try{this.accountDetails[a.toChecksumAddress(e)]={bip44:!1,hdPath:this._pathFromAddress(e)}}catch(t){console.log(`failed to migrate account ${e}`)}}))}isUnlocked(){return Boolean(this.hdk&&this.hdk.publicKey)}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}setHdPath(e){this.hdPath!==e&&(this.hdk=new n),this.hdPath=e}unlock(e){if(this.isUnlocked()&&!e)return Promise.resolve("already unlocked");const t=e?this._toLedgerPath(e):this.hdPath;return new Promise(((e,s)=>{this._sendMessage({action:"ledger-unlock",params:{hdPath:t}},(({success:t,payload:n})=>{t?(this.hdk.publicKey=r.from(n.publicKey,"hex"),this.hdk.chainCode=r.from(n.chainCode,"hex"),e(n.address)):s(n.error||new Error("Unknown error"))}))}))}addAccounts(e=1){return new Promise(((t,r)=>{this.unlock().then((async r=>{const s=this.unlockedAccount,n=s+e;for(let e=s;e<n;e++){const t=this._getPathForIndex(e);let r;r=this._isLedgerLiveHdPath()?await this.unlock(t):this._addressFromIndex(c,e),this.accountDetails[a.toChecksumAddress(r)]={bip44:this._isLedgerLiveHdPath(),hdPath:t},this.accounts.includes(r)||this.accounts.push(r),this.page=0}t(this.accounts)})).catch(r)}))}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase())),delete this.accountDetails[a.toChecksumAddress(e)]}attemptMakeApp(){return new Promise(((e,t)=>{this._sendMessage({action:"ledger-make-app"},(({success:r,error:s})=>{r?e(!0):t(s)}))}))}updateTransportMethod(e){return new Promise(((t,r)=>{this.iframeLoaded?this._sendMessage({action:"ledger-update-transport",params:{transportType:e}},(({success:e})=>{e?t(!0):r(new Error("Ledger transport could not be updated"))})):this.delayedPromise={resolve:t,reject:r,transportType:e}}))}signTransaction(e,t){let s;if("function"==typeof t.getChainId)return t.v=a.bufferToHex(t.getChainId()),t.r="0x00",t.s="0x00",s=t.serialize().toString("hex"),this._signTransaction(e,s,(e=>(t.v=r.from(e.v,"hex"),t.r=r.from(e.r,"hex"),t.s=r.from(e.s,"hex"),t)));const n=t.getMessageToSign(!1);return s=r.isBuffer(n)?n.toString("hex"):a.rlp.encode(n).toString("hex"),this._signTransaction(e,s,(e=>{const r=t.toJSON();return r.type=t.type,r.v=a.addHexPrefix(e.v),r.r=a.addHexPrefix(e.r),r.s=a.addHexPrefix(e.s),i.fromTxData(r,{common:t.common,freeze:Object.isFrozen(t)})}))}_signTransaction(e,t,r){return new Promise(((s,n)=>{this.unlockAccountByAddress(e).then((e=>{this._sendMessage({action:"ledger-sign-transaction",params:{tx:t,hdPath:e}},(({success:e,payload:t})=>{if(e){const e=r(t);e.verifySignature()?s(e):n(new Error("Ledger: The transaction signature is not valid"))}else n(t.error||new Error("Ledger: Unknown error while signing transaction"))}))})).catch(n)}))}signMessage(e,t){return this.signPersonalMessage(e,t)}signPersonalMessage(e,t){return new Promise(((r,s)=>{this.unlockAccountByAddress(e).then((n=>{this._sendMessage({action:"ledger-sign-personal-message",params:{hdPath:n,message:a.stripHexPrefix(t)}},(({success:n,payload:i})=>{if(n){let n=i.v-27;n=n.toString(16),n.length<2&&(n=`0${n}`);const c=`0x${i.r}${i.s}${n}`,l=o.recoverPersonalSignature({data:t,sig:c});a.toChecksumAddress(l)!==a.toChecksumAddress(e)&&s(new Error("Ledger: The signature doesnt match the right address")),r(c)}else s(i.error||new Error("Ledger: Unknown error while signing message"))}))})).catch(s)}))}async unlockAccountByAddress(e){const t=a.toChecksumAddress(e);if(!Object.keys(this.accountDetails).includes(t))throw new Error(`Ledger: Account for address '${t}' not found`);const{hdPath:r}=this.accountDetails[t];if((await this.unlock(r)).toLowerCase()!==e.toLowerCase())throw new Error(`Ledger: Account ${e} does not belong to the connected device`);return r}async signTypedData(e,t,r={}){const s="V4"===r.version;if(!s)throw new Error("Ledger: Only version 4 of typed data signing is supported");const{domain:n,types:i,primaryType:c,message:l}=o.TypedDataUtils.sanitizeData(t),d=o.TypedDataUtils.hashStruct("EIP712Domain",n,i,s).toString("hex"),u=o.TypedDataUtils.hashStruct(c,l,i,s).toString("hex"),h=await this.unlockAccountByAddress(e),{success:p,payload:f}=await new Promise((e=>{this._sendMessage({action:"ledger-sign-typed-data",params:{hdPath:h,domainSeparatorHex:d,hashStructMessageHex:u}},(t=>e(t)))}));if(p){let r=f.v-27;r=r.toString(16),r.length<2&&(r=`0${r}`);const s=`0x${f.r}${f.s}${r}`,n=o.recoverTypedSignature_v4({data:t,sig:s});if(a.toChecksumAddress(n)!==a.toChecksumAddress(e))throw new Error("Ledger: The signature doesnt match the right address");return s}throw f.error||new Error("Ledger: Unknown error while signing message")}exportAccount(){throw new Error("Not supported on this device")}forgetDevice(){this.accounts=[],this.page=0,this.unlockedAccount=0,this.paths={},this.accountDetails={},this.hdk=new n}_setupIframe(){this.iframe=document.createElement("iframe"),this.iframe.src=this.bridgeUrl,this.iframe.allow="hid 'src'",this.iframe.onload=async()=>{if(this.iframeLoaded=!0,this.delayedPromise)try{const e=await this.updateTransportMethod(this.delayedPromise.transportType);this.delayedPromise.resolve(e)}catch(e){this.delayedPromise.reject(e)}finally{delete this.delayedPromise}},document.head.appendChild(this.iframe)}_getOrigin(){const e=this.bridgeUrl.split("/");return e.splice(-1,1),e.join("/")}_sendMessage(e,t){e.target="LEDGER-IFRAME",this.iframe.contentWindow.postMessage(e,"*");const r=({origin:s,data:n})=>s===this._getOrigin()&&(n&&n.action&&n.action===`${e.action}-reply`&&t?(t(n),undefined):(window.removeEventListener("message",r),undefined));window.addEventListener("message",r)}async __getPage(e){this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,r=t+this.perPage;let s;return await this.unlock(),s=this._isLedgerLiveHdPath()?await this._getAccountsBIP44(t,r):this._getAccountsLegacy(t,r),s}async _getAccountsBIP44(e,t){const r=[];for(let s=e;s<t;s++){const e=this._getPathForIndex(s),t=await this.unlock(e),n=!this.implementFullBIP44||await this._hasPreviousTransactions(t);if(r.push({address:t,balance:null,index:s}),!n)break}return r}_getAccountsLegacy(e,t){const r=[];for(let s=e;s<t;s++){const e=this._addressFromIndex(c,s);r.push({address:e,balance:null,index:s}),this.paths[a.toChecksumAddress(e)]=s}return r}_padLeftEven(e){return e.length%2==0?e:`0${e}`}_normalize(e){return this._padLeftEven(a.bufferToHex(e).toLowerCase())}_addressFromIndex(e,t){const r=this.hdk.derive(`${e}/${t}`),s=a.publicToAddress(r.publicKey,!0).toString("hex");return a.toChecksumAddress(`0x${s}`)}_pathFromAddress(e){const t=a.toChecksumAddress(e);let r=this.paths[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===this._addressFromIndex(c,e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return this._getPathForIndex(r)}_toAscii(e){let t="",r=0;const s=e.length;for("0x"===e.substring(0,2)&&(r=2);r<s;r+=2){const s=parseInt(e.substr(r,2),16);t+=String.fromCharCode(s)}return t}_getPathForIndex(e){return this._isLedgerLiveHdPath()?`m/44'/60'/${e}'/0/0`:`${this.hdPath}/${e}`}_isLedgerLiveHdPath(){return"m/44'/60'/0'/0/0"===this.hdPath}_toLedgerPath(e){return e.toString().replace("m/","")}async _hasPreviousTransactions(e){const t=this._getApiUrl(),r=await window.fetch(`${t}/api?module=account&action=txlist&address=${e}&tag=latest&page=1&offset=1`),s=await r.json();return"0"!==s.status&&s.result.length>0}_getApiUrl(){return d[this.network]||d.mainnet}}u.type=l,t.exports=u}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"/home/circleci/project/node_modules/@metamask/eth-ledger-bridge-keyring/index.js"}],[2482,{"./block-cache":2477,"./block-ref":2479,"./block-ref-rewrite":2478,"./block-tracker-inspector":2480,"./fetch":2481,"./inflight-cache":2483,"./providerAsMiddleware":2484,"./providerFromEngine":2485,"./providerFromMiddleware":2486,"./retryOnEmpty":2487,"./wallet":2489},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){s===undefined&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){s===undefined&&(s=r),e[s]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),n(e("./block-cache"),r),n(e("./block-ref-rewrite"),r),n(e("./block-ref"),r),n(e("./block-tracker-inspector"),r),n(e("./fetch"),r),n(e("./inflight-cache"),r),n(e("./providerAsMiddleware"),r),n(e("./providerFromEngine"),r),n(e("./providerFromMiddleware"),r),n(e("./retryOnEmpty"),r),n(e("./wallet"),r)}}},{package:"eth-json-rpc-middleware",file:"/home/circleci/project/node_modules/eth-json-rpc-middleware/dist/index.js"}],[2519,{"@ethereumjs/common":401,"@ethereumjs/tx":405,"bn.js":2520,buffer:2157,crypto:2267,"ethereumjs-util":2597,events:2158,"gridplus-sdk":4405,secp256k1:5828},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const s=e("crypto"),n=e("events").EventEmitter,a=e("bn.js"),o=e("gridplus-sdk"),i=e("@ethereumjs/tx"),c=(e("@ethereumjs/common").default,e("ethereumjs-util")),l=e("secp256k1"),d="Lattice Hardware",u=12e4;class h extends n{constructor(e={}){super(),this.type=d,this._resetDefaults(),this.deserialize(e)}async deserialize(e={}){e.hdPath&&(this.hdPath=e.hdPath),e.creds&&(this.creds=e.creds),e.accounts&&(this.accounts=e.accounts),e.accountIndices&&(this.accountIndices=e.accountIndices),e.accountOpts&&(this.accountOpts=e.accountOpts),e.walletUID&&(this.walletUID=e.walletUID),e.name&&(this.appName=e.name),e.appName&&(this.appName=e.appName),e.network&&(this.network=e.network),e.page&&(this.page=e.page),e.sdkState&&(this.sdkState=e.sdkState)}setHdPath(e){this.hdPath=e}async serialize(){return{creds:this.creds,accounts:this.accounts,accountIndices:this.accountIndices,accountOpts:this.accountOpts,walletUID:this.walletUID,appName:this.appName,name:this.name,network:this.network,page:this.page,hdPath:this.hdPath,sdkState:this.sdkSession?this.sdkSession.getStateData():null}}isUnlocked(){return!!this._getCurrentWalletUID()&&!!this.sdkSession}async unlock(e=!1){if(!this.accountOpts||this.accounts.length>0&&this.accountOpts.length!=this.accounts.length)throw this.forgetDevice(),new Error("You can now add multiple Lattice and SafeCard accounts at the same time! "+"Your accounts have been cleared. Please press Continue to add them back in.");if(this.isUnlocked())return"Unlocked";const t=await this._getCreds();t&&(this.creds.deviceID=t.deviceID,this.creds.password=t.password,this.creds.endpoint=t.endpoint||null);return await this._initSession()&&e||await this._connect(),"Unlocked"}async addAccounts(e=1){if(-1e3===e)return this.forgetDevice(),[];if(e<=0)throw new Error("Number of accounts to add must be a positive number.");await this.unlock();const t=await this._fetchAddresses(e,this.unlockedAccount),r=this._getCurrentWalletUID();if(!r)throw await this._connect(),new Error("No active wallet found in Lattice. Please retry.");return t.forEach(((e,t)=>{let s=!1;for(let t=0;t<this.accounts.length;t++)this.accounts[t]===e&&this.accountOpts[t].walletUID===r&&this.accountOpts[t].hdPath===this.hdPath&&(s=!0);s||(this.accounts.push(e),this.accountIndices.push(this.unlockedAccount+t),this.accountOpts.push({walletUID:r,hdPath:this.hdPath}))})),this.accounts}async getAccounts(){return this.accounts?[...this.accounts]:[]}async signTransaction(e,t){let r,s;const n=t.toJSON();n.type=t._type||null;const a=await this._findSignerIdx(e),l=f(t).toNumber(),d=this.sdkSession.getFwVersion(),u=this.accountIndices[a],{hdPath:h}=this.accountOpts[a];if(d.major>0||d.minor>=15){const e={payload:t._type?t.getMessageToSign(!1):rlp.encode(t.getMessageToSign(!1)),curveType:o.Constants.SIGNING.CURVES.SECP256K1,hashType:o.Constants.SIGNING.HASHES.KECCAK256,encodingType:o.Constants.SIGNING.ENCODINGS.EVM,signerPath:this._getHDPathIndices(h,u)};r=await this.sdkSession.sign({data:e}),s=p(t,r)}else{let e;try{switch(e={chainId:l,nonce:`0x${t.nonce.toString("hex")}`||0,gasLimit:`0x${t.gasLimit.toString("hex")}`,to:t.to?t.to.toString("hex"):null,value:`0x${t.value.toString("hex")}`,data:0===t.data.length?null:`0x${t.data.toString("hex")}`,signerPath:this._getHDPathIndices(h,u)},t._type){case 2:if(null===t.maxPriorityFeePerGas||null===t.maxFeePerGas||t.maxPriorityFeePerGas===undefined||t.maxFeePerGas===undefined)throw new Error("`maxPriorityFeePerGas` and `maxFeePerGas` must be included for EIP1559 transactions.");e.maxPriorityFeePerGas=`0x${t.maxPriorityFeePerGas.toString("hex")}`,e.maxFeePerGas=`0x${t.maxFeePerGas.toString("hex")}`,e.accessList=t.accessList||[],e.type=2;break;case 1:e.accessList=t.accessList||[],e.gasPrice=`0x${t.gasPrice.toString("hex")}`,e.type=1;break;default:e.gasPrice=`0x${t.gasPrice.toString("hex")}`,e.type=null}if(0===d.major&&d.minor<=11&&e.type)throw new Error("Please update Lattice firmware.")}catch(e){throw new Error("Failed to build transaction.")}if(r=await this.sdkSession.sign({currency:"ETH",data:e}),!r.sig||!r.sig.r||!r.sig.s)throw new Error("No signature returned.");s=r.sig.v===undefined?p(t,r):0===r.sig.v.length?"0":r.sig.v.toString("hex")}n.r=c.addHexPrefix(r.sig.r.toString("hex")),n.s=c.addHexPrefix(r.sig.s.toString("hex")),n.v=c.addHexPrefix(s);if(null===await this._accountIdxInCurrentWallet(e))throw new Error("Wrong account. Please change your Lattice wallet or "+"switch to an account on your current active wallet.");return i.TransactionFactory.fromTxData(n,{common:t.common,freeze:Object.isFrozen(t)})}async signPersonalMessage(e,t){return this.signMessage(e,{payload:t,protocol:"signPersonal"})}async signTypedData(e,t,r){if(r.version&&"V4"!==r.version&&"V3"!==r.version)throw new Error(`Only signTypedData V3 and V4 messages (EIP712) are supported. Got version ${r.version}`);return this.signMessage(e,{payload:t,protocol:"eip712"})}async signMessage(e,t){const r=await this._findSignerIdx(e);let{payload:s,protocol:n}=t;s&&n||(s=t,n="signPersonal");const a=this.accountIndices[r],o=this.accountOpts[r].hdPath,i={currency:"ETH_MSG",data:{protocol:n,payload:s,signerPath:this._getHDPathIndices(o,a)}},c=await this.sdkSession.sign(i);if(!c.sig)throw new Error("No signature returned");let l;try{l=c.sig.v.toString("hex"),l.length<2&&(l=`0${l}`)}catch(e){throw new Error("Invalid signature format returned.")}if(null===await this._accountIdxInCurrentWallet(e))throw new Error("Wrong account. Please change your Lattice wallet or "+"switch to an account on your current active wallet.");return`0x${c.sig.r}${c.sig.s}${l}`}async exportAccount(e){throw new Error("exportAccount not supported by this device")}removeAccount(e){this.accounts.forEach(((t,r)=>{if(t.toLowerCase()===e.toLowerCase())return this.accounts.splice(r,1),this.accountIndices.splice(r,1),void this.accountOpts.splice(r,1)}))}async getFirstPage(){return this.page=0,this._getPage(0)}async getNextPage(){return this._getPage(1)}async getPreviousPage(){return this._getPage(-1)}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}forgetDevice(){this._resetDefaults()}async _findSignerIdx(e){const t=this.isUnlocked();await this.unlock(!0);let r=await this._accountIdxInCurrentWallet(e);if(null!==r)return r;if(t&&(await this._connect(),r=await this._accountIdxInCurrentWallet(e),null!==r))return r;throw new Error("Account not found in active Lattice wallet. Please switch.")}async _accountIdxInCurrentWallet(e){const t=await this._findAccountByAddress(e),{walletUID:r}=this.accountOpts[t],s=this.sdkSession.getActiveWallet();if(!s)throw this._connect(),new Error("No active wallet in Lattice.");const n=s.uid.toString("hex");return r.toString("hex")===n?t:null}async _findAccountByAddress(e){const t=await this.getAccounts();let r=-1;if(t.forEach(((t,s)=>{e.toLowerCase()===t.toLowerCase()&&(r=s)})),r<0)throw new Error("Signer not present");return r}_getHDPathIndices(e,t=0){const r=e.split("/").slice(1),s=[];let n=!1;if(r.forEach((e=>{const r="'"===e[e.length-1];let a=r?2147483648:0;e.indexOf("x")>-1?(a+=t,n=!0):a+=Number(r?e.slice(0,e.length-1):e),s.push(a)})),!1===n&&s.push(t),s.length>5)throw new Error("Only HD paths with up to 5 indices are allowed.");return s}_resetDefaults(){this.accounts=[],this.accountIndices=[],this.accountOpts=[],this.isLocked=!0,this.creds={deviceID:null,password:null,endpoint:null},this.walletUID=null,this.sdkSession=null,this.page=0,this.unlockedAccount=0,this.network=null,this.hdPath="m/44'/60'/0'/0/x"}async _openConnectorTab(e){try{const t=window.open(e);if(t)return{chromium:t};if(browser&&browser.tabs&&browser.tabs.create){return{firefox:await browser.tabs.create({url:e})}}throw new Error("Unknown browser context. Cannot open Lattice connector.")}catch(e){throw new Error("Failed to open Lattice connector.")}}async _findTabById(e){return browser.tabs.query({}).forEach((t=>{if(t.id===e)return t})),null}_getCreds(){return new Promise(((e,t)=>{if(this._hasCreds())return e();const s=this.appName?this.appName:"Unknown",n="https://lattice.gridplus.io",a=`${n}?keyring=${s}&forceLogin=true`;let o;function i(r){if(r.origin===n)try{clearInterval(o);const s=JSON.parse(r.data);return s.deviceID&&s.password?e(s):t(new Error("Invalid credentials returned from Lattice."))}catch(e){return t(e)}}this._openConnectorTab(a).then((s=>{if(s.chromium)window.addEventListener("message",i,!1),o=setInterval((()=>{if(s.chromium.closed)return clearInterval(o),t(new Error("Lattice connector closed."))}),500);else if(s.firefox){const n="&loginCache=";o=setInterval((()=>{this._findTabById(s.firefox.id).then((s=>{if(!s||!s.url)return t(new Error("Lattice connector closed."));const a=s.url.indexOf(n);if(a<0)return;const i=a+n.length;clearInterval(o);try{const n=r.from(s.url.slice(i),"base64").toString();browser.tabs.remove(s.id).then((()=>{const r=JSON.parse(n);return r.deviceID&&r.password?e(r):t(new Error("Invalid credentials returned from Lattice."))}))}catch(e){return t("Failed to get login data from Lattice. Please try again.")}}))}),500)}}))}))}async _connect(){try{this.sdkSession.timeout=2e4,await this.sdkSession.connect(this.creds.deviceID)}finally{this.sdkSession.timeout=u}}async _initSession(){if(this.isUnlocked())return;let e="https://signing.gridpl.us";this.creds.endpoint&&(e=this.creds.endpoint);let t={name:this.appName,baseUrl:e,timeout:u,privKey:this._genSessionKey(),network:this.network,skipRetryOnWrongWallet:!0};return this.sdkSession=new o.Client(t),!!t.stateData}async _fetchAddresses(e=1,t=0,r=[]){if(!this.isUnlocked())throw new Error("No connection to Lattice. Cannot fetch addresses.");return this.__fetchAddresses(e,t)}async __fetchAddresses(e=1,t=0,r=[]){if(0===e)return r;const s=this._hdPathHasInternalVarIdx(),n={currency:"ETH",startPath:this._getHDPathIndices(this.hdPath,t),n:s?1:e},a=await this.sdkSession.getAddresses(n);if(a.length<1)throw new Error("No addresses returned");return s?await this.__fetchAddresses(e-1,t+1,r.concat(a)):a}async _getPage(e=0){try{this.page+=e,this.page<0&&(this.page=0);const t=5*this.page;await this.unlock();const r=await this._fetchAddresses(5,t);return r.map(((e,r)=>({address:e,balance:null,index:t+r})))}catch(e){try{await this._connect();return await this._getPage(0)}catch(e){throw new Error("Failed to get accounts. Please forget the device and try again. "+"Make sure you do not have a locked SafeCard inserted.")}}}_hasCreds(){return null!==this.creds.deviceID&&null!==this.creds.password&&this.appName}_genSessionKey(){if(this.name&&!this.appName&&(this.appName=this.name),!this._hasCreds())throw new Error("No credentials -- cannot create session key!");const e=r.concat([r.from(this.creds.password),r.from(this.creds.deviceID),r.from(this.appName)]);return s.createHash("sha256").update(e).digest()}_hdPathHasInternalVarIdx(){const e=this.hdPath.split("/").slice(1);for(let t=0;t<e.length-1;t++)if(e[t].indexOf("x")>-1)return!0;return!1}_getCurrentWalletUID(){if(!this.sdkSession)return null;const e=this.sdkSession.getActiveWallet();return e&&e.uid?e.uid.toString("hex"):null}}function p(e,t){const s=e.getMessageToSign(!0),n=new Uint8Array(r.concat([t.sig.r,t.sig.s])),o=new Uint8Array(t.pubkey),c=l.ecdsaRecover(n,0,s,!1),d=l.ecdsaRecover(n,1,s,!1),u=r.from(o).toString("hex"),h=r.from(c).toString("hex"),p=r.from(d).toString("hex");let g;if(u===h)g=0;else{if(u!==p)return null;g=1}if(e._type)return g.toString(16);const m=f(e);return e.supports(i.Capability.EIP155ReplayProtection)||e.common&&e.common.gteHardfork("spuriousDragon")?m.muln(2).addn(35).addn(g).toString("hex"):new a(g).addn(27).toString("hex")}function f(e){return e&&e.common&&"function"==typeof e.common.chainIdBN?e.common.chainIdBN():e&&e.chainId?new a(e.chainId):new a(1)}h.type=d,t.exports=h}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring",file:"/home/circleci/project/node_modules/eth-lattice-keyring/index.js"}],[40,{"../../../shared/constants/network":6266,"../constants/contracts":4,"./util":81,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,"eth-query":2527,loglevel:5260,pify:5492,"single-call-balance-checker-abi":5914,web3:6186},function(){with(this)return function(){"use strict";return function(e,t,r){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("eth-query")),a=e("@metamask/obs-store"),o=s(e("loglevel")),i=s(e("pify")),c=s(e("web3")),l=s(e("single-call-balance-checker-abi")),d=e("../../../shared/constants/network"),u=e("../constants/contracts"),h=e("./util");r.default=class{constructor(e={}){this.store=new a.ObservableStore({accounts:{},currentBlockGasLimit:""}),this._provider=e.provider,this._query=(0,i.default)(new n.default(this._provider)),this._blockTracker=e.blockTracker,this._currentBlockNumber=this._blockTracker.getCurrentBlock(),this._blockTracker.once("latest",(e=>{this._currentBlockNumber=e})),this._updateForBlock=this._updateForBlock.bind(this),this.getCurrentChainId=e.getCurrentChainId,this.web3=new c.default(this._provider)}start(){this._blockTracker.removeListener("latest",this._updateForBlock),this._blockTracker.addListener("latest",this._updateForBlock),this._updateAccounts()}stop(){this._blockTracker.removeListener("latest",this._updateForBlock)}syncWithAddresses(e){const{accounts:t}=this.store.getState(),r=Object.keys(t),s=[];e.forEach((e=>{r.includes(e)||s.push(e)}));const n=[];r.forEach((t=>{e.includes(t)||n.push(t)})),this.addAccounts(s),this.removeAccount(n)}addAccounts(e){const{accounts:t}=this.store.getState();e.forEach((e=>{t[e]={}})),this.store.updateState({accounts:t}),this._currentBlockNumber&&this._updateAccounts()}removeAccount(e){const{accounts:t}=this.store.getState();e.forEach((e=>{delete t[e]})),this.store.updateState({accounts:t})}clearAccounts(){this.store.updateState({accounts:{}})}async _updateForBlock(e){this._currentBlockNumber=e;const t=await this._query.getBlockByNumber(e,!1);if(!t)return;const r=t.gasLimit;this.store.updateState({currentBlockGasLimit:r});try{await this._updateAccounts()}catch(e){o.default.error(e)}}async _updateAccounts(){const{accounts:e}=this.store.getState(),t=Object.keys(e);switch(this.getCurrentChainId()){case d.MAINNET_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS);break;case d.RINKEBY_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY);break;case d.ROPSTEN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN);break;case d.KOVAN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,u.SINGLE_CALL_BALANCES_ADDRESS_KOVAN);break;default:await Promise.all(t.map(this._updateAccount.bind(this)))}}async _updateAccount(e){const t={address:e,balance:await this._query.getBalance(e)},{accounts:r}=this.store.getState();r[e]&&(r[e]=t,this.store.updateState({accounts:r}))}async _updateAccountsViaBalanceChecker(e,t){const{accounts:r}=this.store.getState();this.web3.setProvider(this._provider);this.web3.eth.contract(l.default).at(t).balances(e,["0x0"],((t,s)=>{if(t)return o.default.warn("MetaMask - Account Tracker single call balance fetch failed",t),void Promise.all(e.map(this._updateAccount.bind(this)));e.forEach(((e,t)=>{const n=s[t]?(0,h.bnToHex)(s[t]):"0x0";r[e]={address:e,balance:n}})),this.store.updateState({accounts:r})}))}}}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/account-tracker.js"}],[2555,{"@ethereumjs/tx":405,buffer:2157,"ethereumjs-util":2597,events:2158,hdkey:2556,"trezor-connect":6036,"trezor-connect/lib/plugins/ethereum/typedData":6039},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const{EventEmitter:s}=e("events"),n=e("ethereumjs-util"),a=e("hdkey"),o=e("trezor-connect").default,{TransactionFactory:i}=e("@ethereumjs/tx"),c=e("trezor-connect/lib/plugins/ethereum/typedData"),l="m/44'/60'/0'/0",d={[l]:!0,"m/44'/1'/0'/0":!0},u="Trezor Hardware",h=1e3,p={email:"support@metamask.io",appUrl:"https://metamask.io"};function f(e){return new Promise((t=>setTimeout(t,e)))}function g(e){return"function"==typeof e.getChainId}class m extends s{constructor(e={}){super(),this.type=u,this.accounts=[],this.hdk=new a,this.page=0,this.perPage=5,this.unlockedAccount=0,this.paths={},this.deserialize(e),o.on("DEVICE_EVENT",(e=>{e&&e.payload&&e.payload.features&&(this.model=e.payload.features.model)})),o.init({manifest:p})}getModel(){return this.model}dispose(){o.dispose()}serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts,page:this.page,paths:this.paths,perPage:this.perPage,unlockedAccount:this.unlockedAccount})}deserialize(e={}){return this.hdPath=e.hdPath||l,this.accounts=e.accounts||[],this.page=e.page||0,this.perPage=e.perPage||5,Promise.resolve()}isUnlocked(){return Boolean(this.hdk&&this.hdk.publicKey)}unlock(){return this.isUnlocked()?Promise.resolve("already unlocked"):new Promise(((e,t)=>{o.getPublicKey({path:this.hdPath,coin:"ETH"}).then((s=>{s.success?(this.hdk.publicKey=r.from(s.payload.publicKey,"hex"),this.hdk.chainCode=r.from(s.payload.chainCode,"hex"),e("just unlocked")):t(new Error(s.payload&&s.payload.error||"Unknown error"))})).catch((e=>{t(new Error(e&&e.toString()||"Unknown error"))}))}))}setAccountToUnlock(e){this.unlockedAccount=parseInt(e,10)}addAccounts(e=1){return new Promise(((t,r)=>{this.unlock().then((r=>{const s=this.unlockedAccount,n=s+e;for(let e=s;e<n;e++){const t=this._addressFromIndex("m",e);this.accounts.includes(t)||this.accounts.push(t),this.page=0}t(this.accounts)})).catch((e=>{r(e)}))}))}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}__getPage(e){return this.page+=e,this.page<=0&&(this.page=1),new Promise(((e,t)=>{this.unlock().then((t=>{const r=(this.page-1)*this.perPage,s=r+this.perPage,a=[];for(let e=r;e<s;e++){const t=this._addressFromIndex("m",e);a.push({address:t,balance:null,index:e}),this.paths[n.toChecksumAddress(t)]=e}e(a)})).catch((e=>{t(e)}))}))}getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))}signTransaction(e,t){return g(t)?this._signTransaction(e,t.getChainId(),t,(e=>(t.v=r.from(e.v,"hex"),t.r=r.from(e.r,"hex"),t.s=r.from(e.s,"hex"),t))):this._signTransaction(e,t.common.chainIdBN().toNumber(),t,(e=>{const r=t.toJSON();return r.type=t.type,r.v=n.addHexPrefix(e.v),r.r=n.addHexPrefix(e.r),r.s=n.addHexPrefix(e.s),i.fromTxData(r,{common:t.common,freeze:Object.isFrozen(t)})}))}async _signTransaction(e,t,r,s){let a;a=g(r)?{to:this._normalize(r.to),value:this._normalize(r.value),data:this._normalize(r.data),chainId:t,nonce:this._normalize(r.nonce),gasLimit:this._normalize(r.gasLimit),gasPrice:this._normalize(r.gasPrice)}:{...r.toJSON(),chainId:t,to:this._normalize(r.to)};try{const t=await this.unlock();await f("just unlocked"===t?h:0);const r=await o.ethereumSignTransaction({path:this._pathFromAddress(e),transaction:a});if(r.success){const t=s(r.payload),a=n.toChecksumAddress(n.addHexPrefix(t.getSenderAddress().toString("hex")));if(a!==n.toChecksumAddress(e))throw new Error("signature doesn't match the right address");return t}throw new Error(r.payload&&r.payload.error||"Unknown error")}catch(e){throw new Error(e&&e.toString()||"Unknown error")}}signMessage(e,t){return this.signPersonalMessage(e,t)}signPersonalMessage(e,t){return new Promise(((r,s)=>{this.unlock().then((a=>{setTimeout((a=>{o.ethereumSignMessage({path:this._pathFromAddress(e),message:n.stripHexPrefix(t),hex:!0}).then((t=>{if(t.success){t.payload.address!==n.toChecksumAddress(e)&&s(new Error("signature doesnt match the right address"));const a=`0x${t.payload.signature}`;r(a)}else s(new Error(t.payload&&t.payload.error||"Unknown error"))})).catch((e=>{s(new Error(e&&e.toString()||"Unknown error"))}))}),"just unlocked"===a?h:0)})).catch((e=>{s(new Error(e&&e.toString()||"Unknown error"))}))}))}async signTypedData(e,t,{version:r}){const s=c(t,"V4"===r),{types:{EIP712Domain:a=[],...i}={},message:l={},domain:d={},primaryType:u,domain_separator_hash:p,message_hash:g}=s,m=await this.unlock();await f("just unlocked"===m?h:0);const b=await o.ethereumSignTypedData({path:this._pathFromAddress(e),data:{types:{EIP712Domain:a,...i},message:l,domain:d,primaryType:u},metamask_v4_compat:!0,domain_separator_hash:p,message_hash:g});if(b.success){if(n.toChecksumAddress(e)!==b.payload.address)throw new Error("signature doesnt match the right address");return b.payload.signature}throw new Error(b.payload&&b.payload.error||"Unknown error")}exportAccount(){return Promise.reject(new Error("Not supported on this device"))}forgetDevice(){this.accounts=[],this.hdk=new a,this.page=0,this.unlockedAccount=0,this.paths={}}setHdPath(e){if(!d[e])throw new Error(`The setHdPath method does not support setting HD Path to ${e}`);this.hdPath!==e&&(this.hdk=new a,this.accounts=[],this.page=0,this.perPage=5,this.unlockedAccount=0,this.paths={}),this.hdPath=e}_normalize(e){return n.bufferToHex(e).toString()}_addressFromIndex(e,t){const r=this.hdk.derive(`${e}/${t}`),s=n.publicToAddress(r.publicKey,!0).toString("hex");return n.toChecksumAddress(`0x${s}`)}_pathFromAddress(e){const t=n.toChecksumAddress(e);let r=this.paths[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===this._addressFromIndex("m",e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return`${this.hdPath}/${r}`}}m.type=u,t.exports=m}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-trezor-keyring",file:"/home/circleci/project/node_modules/eth-trezor-keyring/index.js"}],[1319,{"./SmartTransactionsController":1317,"isomorphic-fetch":4792},function(){with(this)return function(){"use strict";return function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),e("isomorphic-fetch");const n=s(e("./SmartTransactionsController"));r.default=n.default}}},{package:"@metamask/smart-transactions-controller",file:"/home/circleci/project/node_modules/@metamask/smart-transactions-controller/dist/index.js"}],[572,{"./metamask-airgapped-keyring.cjs.development.js":573,"./metamask-airgapped-keyring.cjs.production.min.js":574},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./metamask-airgapped-keyring.cjs.production.min.js")}}},{package:"@keystonehq/metamask-airgapped-keyring",file:"/home/circleci/project/node_modules/@keystonehq/metamask-airgapped-keyring/dist/index.js"}],[31,{"../../../development/mock-3box":156,"../lib/createOriginMiddleware":46,"../lib/migrator":61,"../migrations":152,"./network/createMetamaskMiddleware":16,"3box":162,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@metamask/obs-store":1193,_process:5498,"eth-json-rpc-middleware":2482,"json-rpc-engine":4805,loglevel:5260},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var s=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("@babel/runtime/helpers/defineProperty")),a=e("@metamask/obs-store"),o=s(e("loglevel")),i=e("json-rpc-engine"),c=e("eth-json-rpc-middleware"),l=s(e("../lib/migrator")),d=s(e("../migrations")),u=s(e("../lib/createOriginMiddleware")),h=s(e("./network/createMetamaskMiddleware"));function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const g=t.env.IN_TEST?e("../../../development/mock-3box"):e("3box");r.default=class{constructor(e={}){const{preferencesController:t,keyringController:r,addressBookController:s,version:n,getKeyringControllerState:o,trackMetaMetricsEvent:i}=e;this.preferencesController=t,this.addressBookController=s,this.keyringController=r,this.provider=this._createProvider({version:n,getAccounts:async({origin:e})=>{if("3Box"!==e)return[];const{isUnlocked:t}=o(),r=await this.keyringController.getAccounts();if(t&&r[0]){return[await this.keyringController.getAppKeyAddress(r[0],"wallet://3box.metamask.io")]}return[]},processPersonalMessage:async e=>{const t=await this.keyringController.getAccounts();return r.signPersonalMessage(f(f({},e),{},{from:t[0]}),{withAppKeyOrigin:"wallet://3box.metamask.io"})}}),this._trackMetaMetricsEvent=i;const c=f(f({threeBoxSyncingAllowed:!1,showRestorePrompt:!0,threeBoxLastUpdated:0},e.initState),{},{threeBoxAddress:null,threeBoxSynced:!1,threeBoxDisabled:!1});this.store=new a.ObservableStore(c),this.registeringUpdates=!1,this.lastMigration=d.default.sort(((e,t)=>e.version-t.version)).slice(-1)[0],c.threeBoxSyncingAllowed&&this.init()}async init(){const e=await this.keyringController.getAccounts();this.address=e[0],this._trackMetaMetricsEvent({event:"3Box Initiated",category:"3Box"}),!this.address||this.box&&this.store.getState().threeBoxSynced||await this.new3Box()}async _update3Box(){try{const{threeBoxSyncingAllowed:e,threeBoxSynced:t}=this.store.getState();if(e&&t){const e={preferences:this.preferencesController.store.getState(),addressBook:this.addressBookController.state,lastUpdated:Date.now(),lastMigration:this.lastMigration};await this.space.private.set("metamaskBackup",JSON.stringify(e)),await this.setShowRestorePromptToFalse()}}catch(e){console.error(e)}}_createProvider(e){const t=(0,h.default)(e),r=new i.JsonRpcEngine;r.push((0,u.default)({origin:"3Box"})),r.push(t);return(0,c.providerFromEngine)(r)}_waitForOnSyncDone(){return new Promise((e=>{this.box.onSyncDone((()=>(o.default.debug("3Box box sync done"),e())))}))}async new3Box(){const e=await this.keyringController.getAccounts();let t;this.address=await this.keyringController.getAppKeyAddress(e[0],"wallet://3box.metamask.io");try{const e=await g.getConfig(this.address);t=e.spaces&&e.spaces.metamask}catch(e){if(!e.message.match(/^Error: Invalid response \(404\)/u))throw this._trackMetaMetricsEvent({event:"3Box Config Error",category:"3Box"}),e;this._trackMetaMetricsEvent({event:"3Box Backup does not exist",category:"3Box"}),t=!1}if(this.getThreeBoxSyncingState()||t){this.store.updateState({threeBoxSynced:!1});let e=!1;const t=setTimeout((()=>{o.default.error("3Box sync timed out after 60000 ms"),e=!0,this.store.updateState({threeBoxDisabled:!0,threeBoxSyncingAllowed:!1})}),6e4);try{this.box=await g.openBox(this.address,this.provider),await this._waitForOnSyncDone(),this.space=await this.box.openSpace("metamask",{onSyncDone:async()=>{const r={threeBoxSynced:!0,threeBoxAddress:this.address};e&&(o.default.info("3Box sync completed after timeout; no longer disabled"),r.threeBoxDisabled=!1),clearTimeout(t),this.store.updateState(r),o.default.debug("3Box space sync done"),this._trackMetaMetricsEvent({event:"3Box Synced",category:"3Box"})}})}catch(e){throw this._trackMetaMetricsEvent({event:"3Box Initiation Error",category:"3Box"}),console.error(e),e}}}async getLastUpdated(){const e=await this.space.private.get("metamaskBackup");return JSON.parse(e||"{}").lastUpdated}async migrateBackedUpState(e){const t=new l.default({migrations:d.default}),{preferences:r,addressBook:s}=JSON.parse(e),n={PreferencesController:r,AddressBookController:s},a=t.generateInitialState(n),o=await t.migrateData(a);return{preferences:o.data.PreferencesController,addressBook:o.data.AddressBookController}}async restoreFromThreeBox(){const e=await this.space.private.get("metamaskBackup"),{preferences:t,addressBook:r}=await this.migrateBackedUpState(e);this.store.updateState({threeBoxLastUpdated:e.lastUpdated}),t&&this.preferencesController.store.updateState(t),r&&this.addressBookController.update(r,!0),this.setShowRestorePromptToFalse(),this._trackMetaMetricsEvent({event:"3Box Restored Data",category:"3Box"})}turnThreeBoxSyncingOn(){this._trackMetaMetricsEvent({event:"3Box Sync Turned On",category:"3Box"}),this._registerUpdates()}turnThreeBoxSyncingOff(){this._trackMetaMetricsEvent({event:"3Box Sync Turned Off",category:"3Box"}),this.box.logout()}setShowRestorePromptToFalse(){this.store.updateState({showRestorePrompt:!1})}setThreeBoxSyncingPermission(e){this.store.getState().threeBoxDisabled||(this.store.updateState({threeBoxSyncingAllowed:e}),e&&this.box&&this.turnThreeBoxSyncingOn(),!e&&this.box&&this.turnThreeBoxSyncingOff())}getThreeBoxSyncingState(){return this.store.getState().threeBoxSyncingAllowed}_registerUpdates(){if(!this.registeringUpdates){const e=this._update3Box.bind(this);this.preferencesController.store.subscribe(e);const t=this._update3Box.bind(this);this.addressBookController.subscribe(t),this.registeringUpdates=!0}}}}).call(this)}).call(this,e("_process"))}}},{package:"<root>",file:"/home/circleci/project/app/scripts/controllers/threebox.js"}],[75,{"./createMethodMiddleware":65},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var s=e("./createMethodMiddleware");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}}))}))}}},{package:"<root>",file:"/home/circleci/project/app/scripts/lib/rpc-method-middleware/index.js"}],[1195,{_process:5498,"readable-stream":5778,util:2163,xtend:6248},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var s=e("readable-stream").Transform,n=e("util").inherits,a=e("xtend");function o(e){s.call(this,e),this._destroyed=!1}function i(e,t,r){r(null,e)}function c(e){return function(t,r,s){return"function"==typeof t&&(s=r,r=t,t={}),"function"!=typeof r&&(r=i),"function"!=typeof s&&(s=null),e(t,r,s)}}n(o,s),o.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=c((function(e,t,r){var s=new o(e);return s._transform=t,r&&(s._flush=r),s})),t.exports.ctor=c((function(e,t,r){function s(t){if(!(this instanceof s))return new s(t);this.options=a(e,t),o.call(this,this.options)}return n(s,o),s.prototype._transform=t,r&&(s.prototype._flush=r),s})),t.exports.obj=c((function(e,t,r){var s=new o(a({objectMode:!0,highWaterMark:16},e));return s._transform=t,r&&(s._flush=r),s}))}).call(this)}).call(this,e("_process"))}}},{package:"through2",file:"/home/circleci/project/node_modules/@metamask/obs-store/node_modules/through2/through2.js"}]],[],{});